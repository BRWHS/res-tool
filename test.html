<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ResTool - TEST</title>
  <style>
    body {
      background: #0a0a0a;
      color: #fff;
      font-family: monospace;
      padding: 20px;
    }
    #log {
      background: #1a1a1a;
      padding: 20px;
      border: 2px solid #3b82f6;
      border-radius: 8px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .log-line {
      margin: 8px 0;
      padding: 4px 8px;
      border-left: 3px solid #10b981;
    }
    .log-error {
      border-left-color: #ef4444;
      color: #ef4444;
    }
    .log-warn {
      border-left-color: #f59e0b;
      color: #f59e0b;
    }
    h1 {
      color: #3b82f6;
    }
  </style>
</head>
<body>
  <h1>üîç ResTool Debug Test</h1>
  <p>Diese Seite zeigt dir GENAU wo das Problem liegt...</p>
  <div id="log"></div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const logDiv = document.getElementById('log');
    
    function log(msg, type = 'info') {
      const line = document.createElement('div');
      line.className = 'log-line' + (type === 'error' ? ' log-error' : type === 'warn' ? ' log-warn' : '');
      line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      logDiv.appendChild(line);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(msg);
    }

    log('‚úÖ HTML geladen');
    log('‚úÖ Supabase CDN geladen: ' + (typeof window.supabase !== 'undefined'));

    // Test 1: Kann Supabase initialisiert werden?
    log('üß™ Test 1: Supabase Client erstellen...');
    try {
      const SUPABASE_URL = 'https://kytuiodojfcaggkvizto.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5dHVpb2RvamZjYWdna3ZpenRvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MzA0NjgsImV4cCI6MjA3MDQwNjQ2OH0.YobQZnCQ7LihWtewynoCJ6ZTjqetkGwh82Nd2mmmhLU';
      
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      log('‚úÖ Supabase Client erstellt');

      // Test 2: Auth Session mit Timeout
      log('üß™ Test 2: Auth Session check mit Timeout...');
      
      const testAuth = async () => {
        try {
          const sessionPromise = supabase.auth.getSession();
          const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('Timeout nach 5 Sekunden')), 5000)
          );
          
          log('‚è≥ Warte auf Session oder Timeout...');
          
          const result = await Promise.race([sessionPromise, timeoutPromise])
            .catch(err => {
              log('‚ö†Ô∏è Session check fehlgeschlagen: ' + err.message, 'warn');
              return { data: { session: null }, error: err };
            });
          
          if (result.data?.session) {
            log('‚úÖ Session gefunden');
          } else {
            log('‚úÖ Keine Session (Demo-Modus m√∂glich)');
          }

          // Test 3: Database Connection mit Timeout
          log('üß™ Test 3: Database Connection mit Timeout...');
          
          const dbPromise = supabase
            .from('reservations')
            .select('count')
            .limit(1);
          
          const dbTimeout = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('DB Timeout nach 5 Sekunden')), 5000)
          );
          
          log('‚è≥ Warte auf DB oder Timeout...');
          
          const dbResult = await Promise.race([dbPromise, dbTimeout])
            .catch(err => {
              log('‚ö†Ô∏è DB check fehlgeschlagen: ' + err.message, 'warn');
              return { data: null, error: err };
            });
          
          if (dbResult.error) {
            log('‚ö†Ô∏è Datenbank nicht verbunden (Demo-Modus m√∂glich)', 'warn');
          } else {
            log('‚úÖ Datenbank verbunden');
          }

          // Test 4: Module laden
          log('üß™ Test 4: Versuche Module zu laden...');
          
          try {
            const appModule = await import('./src/app.js');
            log('‚úÖ app.js geladen');
          } catch (err) {
            log('‚ùå FEHLER beim Laden von app.js: ' + err.message, 'error');
            log('üìù Stelle sicher, dass die Dateien in src/ liegen!', 'error');
          }

          log('');
          log('üéØ ZUSAMMENFASSUNG:');
          log('Wenn alle Tests ‚úÖ sind, sollte die App funktionieren.');
          log('Wenn ‚ùå bei Module laden ‚Üí Dateien liegen nicht in src/');
          log('Wenn ‚ö†Ô∏è bei DB/Auth ‚Üí Demo-Modus sollte trotzdem funktionieren');
          
        } catch (err) {
          log('‚ùå KRITISCHER FEHLER: ' + err.message, 'error');
          log('Stack: ' + err.stack, 'error');
        }
      };

      testAuth();

    } catch (err) {
      log('‚ùå FEHLER bei Supabase Init: ' + err.message, 'error');
    }
  </script>
</body>
</html>
