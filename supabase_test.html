<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase Connection Test</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { color: #333; margin-bottom: 30px; text-align: center; }
    .test-box {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      border-left: 4px solid #6c757d;
    }
    .test-box.success { border-left-color: #28a745; background: #d4edda; }
    .test-box.error { border-left-color: #dc3545; background: #f8d7da; }
    .test-box.info { border-left-color: #17a2b8; background: #d1ecf1; }
    .test-title { font-weight: 600; margin-bottom: 10px; font-size: 1.1em; }
    .test-detail { font-size: 0.9em; color: #666; line-height: 1.6; }
    code {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.85em;
    }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s;
    }
    button:hover { background: #5568d3; }
    .spinner { 
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Supabase Verbindungstest</h1>
    
    <div id="results"></div>
    
    <button onclick="runTests()">Test starten</button>
  </div>

  <!-- Supabase laden -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    const SUPABASE_URL = 'https://kcqmcwfbapcuiatwixwm.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjcW1jd2ZiYXBjdWlhdHdpeHdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2Mzg5MTksImV4cCI6MjA3NzIxNDkxOX0.xy8Iwz1nl8kBbSQio00ogy5sU_cFI2R4CPe5HdqIFDQ';

    function addResult(title, detail, type = 'info') {
      const results = document.getElementById('results');
      results.innerHTML += `
        <div class="test-box ${type}">
          <div class="test-title">${title}</div>
          <div class="test-detail">${detail}</div>
        </div>
      `;
    }

    async function runTests() {
      document.getElementById('results').innerHTML = '<div class="spinner"></div>';
      
      // Test 1: Supabase Library geladen?
      setTimeout(() => {
        if (typeof window.supabase === 'undefined') {
          addResult(
            '‚ùå Test 1 fehlgeschlagen: Supabase Library nicht geladen',
            'Die Supabase-Library konnte nicht vom CDN geladen werden.<br>M√∂gliche Ursachen:<br>‚Ä¢ CDN nicht erreichbar<br>‚Ä¢ Firewall/AdBlocker blockiert Request<br>‚Ä¢ Internetverbindung unterbrochen',
            'error'
          );
          return;
        } else {
          addResult(
            '‚úÖ Test 1 erfolgreich: Supabase Library geladen',
            'Die JavaScript-Library wurde erfolgreich vom CDN geladen.',
            'success'
          );
        }

        // Test 2: Supabase Client erstellen
        let supabase;
        try {
          const { createClient } = window.supabase;
          supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
          addResult(
            '‚úÖ Test 2 erfolgreich: Supabase Client erstellt',
            `Client verbunden mit: <code>${SUPABASE_URL}</code>`,
            'success'
          );
        } catch (error) {
          addResult(
            '‚ùå Test 2 fehlgeschlagen: Client-Erstellung fehlgeschlagen',
            `Fehler: ${error.message}`,
            'error'
          );
          return;
        }

        // Test 3: Datenbankverbindung testen
        setTimeout(async () => {
          try {
            const { data, error, count } = await supabase
              .from('reservations')
              .select('*', { count: 'exact', head: true });
            
            if (error) throw error;
            
            addResult(
              '‚úÖ Test 3 erfolgreich: Datenbankverbindung aktiv',
              `Tabelle "reservations" gefunden mit ${count || 0} Eintr√§gen.<br>Die Datenbank ist erreichbar und funktionsf√§hig!`,
              'success'
            );

            addResult(
              'üéâ Alle Tests bestanden!',
              'Deine Supabase-Verbindung funktioniert einwandfrei. Das Problem liegt vermutlich woanders in der App.',
              'info'
            );
          } catch (error) {
            addResult(
              '‚ùå Test 3 fehlgeschlagen: Datenbankverbindung nicht m√∂glich',
              `Fehler: ${error.message}<br><br>Details:<br>‚Ä¢ Code: ${error.code}<br>‚Ä¢ Hint: ${error.hint || 'Keine'}<br><br>M√∂gliche Ursachen:<br>‚Ä¢ Falsche Anmeldedaten<br>‚Ä¢ Tabelle existiert nicht<br>‚Ä¢ Keine Berechtigung`,
              'error'
            );
          }
        }, 500);
      }, 1000);
    }

    // Automatischer Test beim Laden
    window.addEventListener('load', function() {
      setTimeout(runTests, 500);
    });
  </script>
</body>
</html>
