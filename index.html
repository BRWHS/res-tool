<!DOCTYPE html>
<html lang="de">
<head>
  
<link rel="preload" as="image" href="/assets/hotel-placeholder.png">
<link rel="preload" as="image" href="/assets/sketch-placeholder.png">
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>res-tool — Dashboard</title>

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="res-tool brand">
      <div class="logo" aria-hidden="true"></div>
      <h1 class="mono"><span>res</span>-tool<span class="cursor">_</span></h1>
    </div>

    <nav class="toolbar" aria-label="Aktionen">
      <div class="toolbar-left">
        <button class="btn primary" id="btnNew">Neue Reservierung</button>
        <button class="btn ghost"   id="btnAvail">Verfügbarkeit</button>
        <button class="btn ghost"   id="btnReporting">Reporting</button>
        <button class="btn ghost"   id="btnSettings">Einstellungen</button>
        <button class="btn ghost"   id="btnSketch">Hotelskizze</button>
      </div>

      <div class="toolbar-right mono">
        <div id="statusChips">
          <span class="pill" id="chipSb"  title="Supabase">SB</span>
          <span class="pill" id="chipHns" title="HotelNetSolutions">HNS</span>
        </div>
        <div class="clock">
          <span id="dateLocal">--.--.----</span>
          <span class="sep">·</span>
          <span id="clockLocal">--:--:--</span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Mini-Charts (YoY OTA) -->
  <aside class="analytics-dock" aria-label="Mini-Charts">
    <div class="dock-head">
      <span class="mono">YoY · OTA · 7T</span>
      <button class="btn sm" id="dockToggle" title="Ein-/Ausblenden">–</button>
    </div>
    <div id="miniAnalyticsDock" class="dock-list"></div>
  </aside>

  <main class="container" aria-live="polite">
    <!-- KPIs -->
    <section class="grid hero" aria-label="Dashboard Übersicht">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">KPI — Heute</h3>
            <div class="select-wrap">
              <select id="kpiFilterToday" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="tBookings">—</div><div class="label">Buchungen (heute eingegangen)</div></div>
            <div class="kpi"><div class="value" id="tRevenue">— €</div><div class="label">Umsatz (Anreisen heute)</div></div>
            <div class="kpi"><div class="value" id="tADR">— €</div><div class="label">ADR (heute)</div></div>
            <div class="kpi"><div class="value" id="tOcc">—%</div><div class="label">Auslastung (heute)</div></div>
          </div>
        </div>
      </article>

      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">KPI — Nächste 7 Tage</h3>
            <div class="select-wrap">
              <select id="kpiFilterNext" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="nRevenue">— €</div><div class="label">Umsatz (Anreisen +1..+7)</div></div>
            <div class="kpi"><div class="value" id="nADR">— €</div><div class="label">ADR (+1..+7)</div></div>
            <div class="kpi"><div class="value" id="nOcc">—%</div><div class="label">Ø Auslastung (+1..+7)</div></div>
          </div>
        </div>
      </article>
    </section>

    <!-- Reservierungen -->
    <section style="margin-top:16px;" aria-label="Reservierungen">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono" style="margin:0">Reservierungen</h3>
            <span></span>
          </div>

          <div class="table-tools">
            <div class="row wrap">
              <input id="searchInput" class="input" placeholder="Gastname…" />
              <select id="filterHotel" class="input theme-select" style="width:220px;"></select>
              <select id="filterStatus" class="input theme-select" style="width:170px;">
                <option value="active">Status: Active (Zukunft)</option>
                <option value="done">Status: Done (Vergangenheit)</option>
                <option value="canceled">Status: Canceled</option>
                <option value="all">Status: Alle</option>
              </select>
              <input id="filterResNo" class="input" placeholder="Res.-Nr." style="width:150px;" />
              <input id="filterFrom" type="date" class="input" style="width:170px;" />
              <input id="filterTo"   type="date" class="input" style="width:170px;" />
              <button class="btn" id="btnRefresh">Refresh</button>
            </div>
          </div>

          <div class="table-wrap">
            <table class="resv" id="resTable">
              <thead>
                <tr>
                  <th>Res.-Nr.</th>
                  <th>Hotel</th>
                  <th>Gastname</th>
                  <th>Anreise</th>
                  <th>Abreise</th>
                  <th>Kategorie</th>
                  <th>Rate</th>
                  <th>Preis</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="resvBody"></tbody>
            </table>
            <div class="pagination">
              <button class="btn" id="prevPage">Zurück</button>
              <span class="muted" id="pageInfo">Seite 1</span>
              <button class="btn" id="nextPage">Weiter</button>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <!-- Quick links -->
  <aside class="quick-links" aria-label="Tracker Shortcuts">
    <a class="btn sm" href="https://noteforms.com/forms/hotel-booking-tracker-c83eba" target="_blank" rel="noopener">Buchungs-Tracker</a>
    <a class="btn sm" href="https://noteforms.com/forms/hotel-call-tracking-form-hw2hqj" target="_blank" rel="noopener">Telefon-Tracker</a>
    <a class="btn sm" href="https://www.notion.so/11a5a3d6427580fbbb4ac3a0dcd1e209?v=35809356ec4245718f85f4a470e066d6" target="_blank" rel="noopener">Handbuch</a>
  </aside>

  <!-- Backdrop + Modals -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true"></div>

  <!-- Neue Reservierung -->
  <section class="modal" id="modalNew" role="dialog" aria-labelledby="newTitle" aria-modal="true">
    <header>
      <h3 id="newTitle" class="mono">Neue Reservierung</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="wizard-steps">
        <div class="wstep active" data-step="1"><span>1</span><b>Hotel & Daten</b></div>
        <div class="wstep" data-step="2"><span>2</span><b>Kategorie</b></div>
        <div class="wstep" data-step="3"><span>3</span><b>Rate</b></div>
        <div class="wstep" data-step="4"><span>4</span><b>Gast & Zahlung</b></div>
      </div>

     <!-- STEP 1 -->
      <div class="wpage" id="w1">
        <!-- NEW: Hotel-Preview rechts -->
        <div class="grid2">
  <label>Hotel
    <select id="newHotel" class="input theme-select"></select>
  </label>

  <!-- Bild rechts -->
  <aside class="image-box">
    <img id="hotelImg" src="/assets/hotel-placeholder.png" alt="Hotelbild" loading="lazy">
  </aside>

  <label>Anreise <input id="newArr" type="date" class="input"/></label>
  <label>Abreise <input id="newDep" type="date" class="input"/></label>
  <label>Erwachsene <input id="newAdults" type="number" min="1" value="1" class="input"/></label>
  <label>Kinder <input id="newChildren" type="number" min="0" value="0" class="input"/></label>

  <h4 class="mono section">Gastdaten</h4>
<div class="grid2">
  <label>Vorname <input id="newFname" class="input" placeholder="Max"/></label>
  <label>Nachname* <input id="newLname" class="input" placeholder="Mustermann" required/></label>
  <label>E‑Mail <input id="newEmail" class="input" placeholder="max@example.com"/></label>
  <label>Telefon <input id="newPhone" class="input" placeholder="+49 ..."/></label>
  <label>Straße <input id="newStreet" class="input" placeholder="Musterstraße 1"/></label>
  <label>PLZ <input id="newZip" class="input" placeholder="80331"/></label>
  <label>Ort <input id="newCity" class="input" placeholder="München"/></label>
</div>
      </div>

      <!-- STEP 2 -->
<div class="wpage hidden" id="w2">
  <label>Kategorie
    <select id="newCat" class="input theme-select"></select>
  </label>

  <!-- kleine Vorschau, damit das „broken image“ nicht riesig ist -->
  <div class="imgcard" style="margin-top:8px;max-width:320px;">
    <img id="imgCatPreview" alt="Zimmer/Kategorie" style="width:100%;border-radius:12px;display:block;" />   
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="wpage hidden" id="w3">
        <div class="grid2">
          <label>Rate
            <select id="newRate" class="input theme-select"></select>
          </label>
          <label>Preis <input id="newPrice" type="number" step="1" value="89" class="input"/></label>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="wpage hidden" id="w4">
        <aside class="summary box" id="summaryFinal"></aside>

        <h4 class="mono section">Gastdaten</h4>

        <details class="box">
          <summary class="mono">Firma (optional)</summary>
          <div class="grid2">
            <label>Firma <input id="newCompany" class="input" /></label>
            <label>USt-ID <input id="newVat" class="input" /></label>
            <label>PLZ <input id="newCompanyZip" class="input" /></label>
            <label>Adresse <input id="newAddress" class="input" placeholder="Straße + Ort" /></label>
          </div>
        </details>

        <h4 class="mono section">Kreditkarte</h4>
        <div class="cc-wrap">
          <div class="cc-visual">
            <div class="cc-chip"></div>
            <div class="cc-num"  id="ccNumLive">•••• •••• •••• ••••</div>
            <div class="cc-holder" id="ccHolderLive">NAME</div>
            <div class="cc-exp"    id="ccExpLive">MM/YY</div>
          </div>
          <div class="cc-form">
            <div class="grid2">
              <label>Karteninhaber <input id="ccHolder" class="input" /></label>
              <label>Kartennummer <input id="ccNumber" class="input" placeholder="•••• •••• •••• 1234" /></label>
              <label>Ablauf (MM/JJ) <input id="ccExpiry" class="input" placeholder="12/27" /></label>
            </div>
          </div>
        </div>

        <label class="section mono">Notizen
          <textarea id="newNotes" class="input" rows="3" placeholder="Besonderheiten, Wünsche …"></textarea>
        </label>
      </div>

      <div class="wizard-actions">
        <button class="btn ghost hidden" id="btnPrev">Zurück</button>
        <div style="flex:1"></div>
        <button class="btn" id="btnNext" disabled>Weiter</button>
        <button class="btn primary hidden" id="btnCreate">Reservierung abschicken</button>
      </div>

      <p class="muted" id="newInfo" style="margin-top:8px;"></p>
    </div>
  </section>

  <!-- Reservierung bearbeiten -->
  <section class="modal" id="modalEdit" role="dialog" aria-labelledby="editTitle" aria-modal="true">
    <header>
      <h3 id="editTitle" class="mono">Reservierung bearbeiten</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="tabs">
        <button class="tab active" data-tab="tabDet">Details</button>
        <button class="tab" data-tab="tabPay">Zahlung</button>
        <button class="tab" data-tab="tabAct">Aktionen</button>
      </div>

      <div class="tabpage" id="tabDet">
        <div class="grid2">
          <label>Res.-Nr. <input id="eResNo" class="input" disabled/></label>
          <label>Status
            <select id="eStatus" class="input theme-select">
              <option>active</option>
              <option>done</option>
              <option>canceled</option>
            </select>
          </label>
          <label>Hotel <input id="eHotel" class="input" disabled/></label>
          <label>Gast Nachname <input id="eLname" class="input"/></label>
          <label>Anreise <input id="eArr" type="date" class="input"/></label>
          <label>Abreise <input id="eDep" type="date" class="input"/></label>
          <label>Kategorie
            <select id="eCat" class="input theme-select"></select>
          </label>
          <label>Rate
            <select id="eRate" class="input theme-select"></select>
          </label>
          <label>Preis <input id="ePrice" type="number" step="1" class="input"/></label>
          <label>Notizen <input id="eNotes" class="input"/></label>
        </div>
        <div class="right"><button class="btn" id="btnSaveEdit">Speichern</button></div>
      </div>

      <div class="tabpage hidden" id="tabPay">
        <div class="grid2">
          <label>Karteninhaber <input id="eCcHolder" class="input"/></label>
          <label>Last4 <input id="eCcLast4" class="input"/></label>
          <label>Exp. Monat <input id="eCcExpM" type="number" min="1" max="12" class="input"/></label>
          <label>Exp. Jahr <input id="eCcExpY" type="number" min="24" max="40" class="input"/></label>
        </div>
        <div class="right"><button class="btn" id="btnSavePay">Speichern</button></div>
      </div>

      <div class="tabpage hidden" id="tabAct">
        <div class="box">
          <p class="muted">Reservierung stornieren? Status wird auf <b>canceled</b> gesetzt.</p>
          <button class="btn danger" id="btnCancelRes">Stornieren</button>
        </div>
      </div>

      <p class="muted" id="editInfo" style="margin-top:8px;"></p>
    </div>
  </section>

  <!-- Verfügbarkeit -->
  <section class="modal" id="modalAvail" role="dialog" aria-labelledby="availTitle" aria-modal="true">
    <header>
      <h3 id="availTitle" class="mono">Verfügbarkeit</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="row wrap" style="margin-bottom:8px;">
        <label>Von <input id="availFrom" type="date" class="input" style="width:170px;"></label>
        <label>Tage
          <select id="availDays" class="input theme-select" style="width:120px;">
            <option value="7">7</option>
            <option value="14" selected>14</option>
            <option value="30">30</option>
            <option value="60">60</option>
          </select>
        </label>
        <button class="btn" id="availRun">Aktualisieren</button>
        <div class="muted" style="margin-left:auto;">Legende:
          <span class="pill occ-g">≤64%</span>
          <span class="pill occ-o">65–89%</span>
          <span class="pill occ-r">≥90%</span>
        </div>
      </div>
      <div class="matrix compact">
        <table class="matrix" id="matrixTable">
          <thead><tr><th class="sticky">Hotel</th></tr></thead>
          <tbody id="matrixBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Reporting -->
  <section class="modal" id="modalReporting" role="dialog" aria-labelledby="repTitle" aria-modal="true">
    <header>
      <h3 id="repTitle" class="mono">Reporting</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="row wrap">
        <label>Von <input id="repFrom" type="date" class="input"></label>
        <label>Bis <input id="repTo" type="date" class="input"></label>
        <label>Hotel
          <select id="repHotel" class="input theme-select" style="width:260px;"></select>
        </label>
        <button class="btn" id="repRun">Aktualisieren</button>
        <div style="flex:1"></div>
        <button class="btn ghost" id="repCsv">Export CSV</button>
        <button class="btn ghost" id="repXls">Export Excel</button>
      </div>
      <div class="table-wrap">
        <table class="resv">
          <thead><tr><th>Hotel</th><th>Buchungen</th><th>Umsatz</th><th>ADR</th><th>OTA-Anteil</th></tr></thead>
          <tbody id="repBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Einstellungen -->
  <section class="modal" id="modalSettings" role="dialog" aria-labelledby="setTitle" aria-modal="true">
    <header>
      <h3 id="setTitle" class="mono">Einstellungen</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="grid2">
        <label>Sprache
          <select id="setLang" class="input theme-select"><option value="de">Deutsch</option><option value="en">English</option></select>
        </label>
        <label>Farbton (Hue)
          <input id="setHue" type="range" min="160" max="200" value="180" />
        </label>
      </div>
    </div>
  </section>

  <!-- Hotelskizze -->
<section class="modal" id="modalSketch" role="dialog" aria-labelledby="sketchTitle" aria-modal="true">
    <header>
      <h3 id="sketchTitle" class="mono">Hotelskizze</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <!-- NEW: zwei Zustände – Buttonliste und Sketch-View -->
      <div id="sketchStateList" class="row wrap"></div>
      <div id="sketchStateView" class="hidden">
        <div class="row wrap" style="margin-bottom:8px;">
          <button class="btn" id="sketchBack">← Zurück zur Auswahl</button>
          <div class="muted" id="sketchHotelLabel" style="margin-left:8px;"></div>
        </div>
        <div class="imgcard wide">
          <img id="sketchImage" alt="Hotelskizze" />
        </div>
      </div>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.5/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script src="/src/app.js"></script>
</body>
</html>
