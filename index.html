<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>res-tool — Dashboard</title>

  <!-- Preloads -->
  <link rel="preload" as="image" href="/assets/hotel-placeholder.png">
  <link rel="preload" as="image" href="/assets/sketch-placeholder.png">

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">

  
  <!-- Build erwartet /src/styles.css -->
  <link rel="stylesheet" href="/src/styles.css" />
</head>

<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="res-tool brand">
      <div class="logo" aria-hidden="true"></div>
      <h1 class="mono"><span>res</span>-tool<span class="cursor">_</span></h1>
    </div>

    <nav class="toolbar" aria-label="Aktionen">
      <div class="toolbar-left">
        <button class="btn primary" id="btnNew"        data-modal="#modalNew">Neue Reservierung</button>
        <button class="btn ghost"   id="btnAvail"      data-modal="#modalAvail">Verfügbarkeit</button>
        <button class="btn ghost"   id="btnReporting"  data-modal="#modalReporting">Reporting</button>
        <button class="btn ghost"   id="btnSettings"   data-modal="#modalSettings">Einstellungen</button>
        <button class="btn ghost"   id="btnSketch"     data-modal="#modalSketch">Hotelskizze</button>
      </div>

      <div class="toolbar-right mono">
        <div id="statusChips">
          <span class="pill" id="chipSb"  title="Supabase">SB</span>
          <span class="pill" id="chipHns" title="HotelNetSolutions">HNS</span>
        </div>
        <div class="clock">
          <span id="dateLocal">--.--.----</span>
          <span class="sep">·</span>
          <span id="clockLocal">--:--:--</span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Mini-Charts (YoY) -->
  <aside class="analytics-dock" aria-label="Mini-Charts">
    <div class="dock-head">
      <span class="mono">YoY - Daily</span>
      <button class="btn sm" id="dockToggle" title="Ein-/Ausblenden">–</button>
    </div>
    <div id="miniAnalyticsDock" class="dock-list"></div>
  </aside>

  <main class="container" aria-live="polite">
    <!-- KPIs -->
    <section class="grid hero" aria-label="Dashboard Übersicht">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">Performance - Heute</h3>
            <div class="select-wrap">
              <select id="kpiFilterToday" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="tBookings">—</div><div class="label">Buchungen (heute eingegangen)</div></div>
            <div class="kpi"><div class="value" id="tRevenue">— €</div><div class="label">Umsatz (heute)</div></div>
            <div class="kpi"><div class="value" id="tADR">— €</div><div class="label">ADR (heute)</div></div>
            <div class="kpi"><div class="value" id="tOcc">—%</div><div class="label">Auslastung (heute)</div></div>
          </div>
        </div>
      </article>

      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">Performance - Nächste 7 Tage</h3>
            <div class="select-wrap">
              <select id="kpiFilterNext" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="nRevenue">— €</div><div class="label">Umsatz (Anreisen +1..+7)</div></div>
            <div class="kpi"><div class="value" id="nADR">— €</div><div class="label">WDR (+1..+7)</div></div>
            <div class="kpi"><div class="value" id="nOcc">—%</div><div class="label">Ø Auslastung (+1..+7)</div></div>
          </div>
        </div>
      </article>
    </section>

    <!-- Reservierungen -->
    <section style="margin-top:16px;" aria-label="Reservierungen">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono" style="margin:0">Reservierungen</h3>
            <span></span>
          </div>

          <div class="table-tools">
            <div class="row wrap">
              <input id="searchInput" class="input" placeholder="Gastname…" />
              <select id="filterHotel" class="input theme-select" style="width:220px;"></select>
              <select id="filterStatus" class="input theme-select" style="width:170px;">
                <option value="active">Status: Active (Zukunft)</option>
                <option value="done">Status: Done (Vergangenheit)</option>
                <option value="canceled">Status: Canceled</option>
                <option value="all">Status: Alle</option>
              </select>
              <input id="filterResNo" class="input" placeholder="Res.-Nr." style="width:150px;" />
              <input id="filterFrom" type="date" class="input" style="width:170px;" />
              <input id="filterTo"   type="date" class="input" style="width:170px;" />
              <button class="btn" id="btnRefresh">Refresh</button>
            
<button class="btn ghost" id="btnClearFilters" title="Filter zurücksetzen">Reset</button>
</div>
          </div>

          <div class="table-wrap">
            <table class="resv" id="resTable">
              <thead>
                <tr>
                  <th>Res.-Nr.</th>
                  <th>Hotel</th>
                  <th>Gastname</th>
                  <th>Anreise</th>
                  <th>Abreise</th>
                  <th>Kategorie</th>
                  <th>Rate</th>
                  <th>Preis</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="resvBody"></tbody>
            </table>
            <div class="pagination">
              <button class="btn" id="prevPage">Zurück</button>
              <span class="muted" id="pageInfo">Seite 1</span>
              <button class="btn" id="nextPage">Weiter</button>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <!-- Quick links -->
  <aside class="quick-links" aria-label="Tracker Shortcuts">
    <a class="btn sm" href="https://noteforms.com/forms/hotel-booking-tracker-c83eba" target="_blank" rel="noopener">Buchungs-Tracker</a>
    <a class="btn sm" href="https://noteforms.com/forms/hotel-call-tracking-form-hw2hqj" target="_blank" rel="noopener">Telefon-Tracker</a>
    <a class="btn sm" href="https://www.notion.so/11a5a3d6427580fbbb4ac3a0dcd1e209?v=35809356ec4245718f85f4a470e066d6" target="_blank" rel="noopener">Handbuch</a>
  </aside>

  <!-- Rate bearbeiten -->
<section class="modal" id="modalRateEdit" role="dialog" aria-labelledby="rateEditTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="rateEditTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Rate bearbeiten</h3>
    <button class="btn" data-close>Schließen</button>
  </header>
  <div class="body">
    <div class="grid2">
      <label>Hotel
        <select id="erHotel" class="input theme-select" disabled></select>
      </label>
      <label>Ratecode
        <input id="erCode" class="input" disabled />
      </label>
      <label>Ratentyp
        <select id="erType" class="input theme-select" disabled>
          <option>Direct</option>
          <option>Corp</option>
          <option>IDS</option>
        </select>
      </label>
      <label>Ratename
        <input id="erName" class="input" placeholder="z. B. Flex exkl. Frühstück" />
      </label>
      <label style="grid-column:1 / -1">Kategorien
  <div id="erCatsWrap" class="cat-stack"></div>
  <button class="btn sm ghost" id="erAddCatRow" type="button">+ weitere Kategorie</button>
</label>
      <label style="grid-column:1 / -1">Stornobedingung
        <textarea id="erPolicy" class="input" rows="3" placeholder="z. B. Bis zum Anreisetag 18:00 Uhr kostenfrei stornierbar."></textarea>
      </label>
      <label>Preis/Nacht (€)
        <input id="erPrice" type="number" step="1" min="0" class="input" />
      </label>
      <label>Gemappt
        <select id="erMapped" class="input theme-select">
          <option value="true">ja</option>
          <option value="false">nein</option>
        </select>
      </label>
    </div>

    <div class="set-footer" style="gap:8px; justify-content:flex-end">
      <button class="btn danger" id="btnRateDelete">Rate löschen</button>
      <button class="btn primary" id="btnRateUpdate">Änderungen speichern</button>
    </div>

    <p class="muted tiny" style="margin-top:6px">Hotel, Ratecode und Ratentyp sind fix und nicht änderbar.</p>
  </div>
</section>

  <!-- Neue Rate anlegen -->
<section class="modal" id="modalRateCreate" role="dialog" aria-labelledby="rateCreateTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="rateCreateTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Neue Rate</h3>
    <button class="btn" data-close>Schließen</button>
  </header>
  <div class="body">
    <div class="grid2">
      <label>Ratecode (nur Zahlen)
        <input id="crCode" class="input" inputmode="numeric" pattern="\d+" placeholder="z. B. 100123">
      </label>
      <label>Ratentyp*
        <select id="crType" class="input theme-select">
          <option value="">Bitte wählen</option>
          <option>Direct</option><option>Corp</option><option>IDS</option>
        </select>
      </label>
      <label>Hotel*
        <select id="crHotel" class="input theme-select"></select>
      </label>
      <label>Ratename*
        <input id="crName" class="input" placeholder="z. B. Flex exkl. Frühstück">
      </label>
      <label style="grid-column:1 / -1">Kategorien
  <div id="crCatsWrap" class="cat-stack" data-disabled="true"></div>
  <button class="btn sm ghost" id="crAddCatRow" type="button" disabled>+ weitere Kategorie</button>
</label>
      <label style="grid-column:1 / -1">Stornobedingung
        <textarea id="crPolicy" class="input" rows="3" placeholder="Bis 18:00 Uhr am Anreisetag kostenfrei stornierbar."></textarea>
      </label>
      <label>Preis/Nacht (€)
        <input id="crPrice" type="number" step="1" min="0" class="input" value="0">
      </label>
      <label>Gemappt
        <select id="crMapped" class="input theme-select">
          <option value="true">ja</option>
          <option value="false" selected>nein</option>
        </select>
      </label>
    </div>

    <div class="set-footer" style="gap:8px; justify-content:flex-end">
      <button class="btn primary" id="btnRateCreate">Rate erstellen</button>
    </div>
  </div>
</section>



  <!-- Backdrop -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true"></div>

  <!-- Neue Reservierung -->
  <section class="modal" id="modalNew" role="dialog" aria-labelledby="newTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="newTitle" class="mono"><span class="newres-logo"></span> Neue Reservierung</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="wizard-steps">
        <div class="wstep active" data-step="1"><span>1</span><b>Hotel & Daten</b></div>
        <div class="wstep" data-step="2"><span>2</span><b>Kategorie</b></div>
        <div class="wstep" data-step="3"><span>3</span><b>Rate</b></div>
        <div class="wstep" data-step="4"><span>4</span><b>Gast & Zahlung</b></div>
      </div>

      <!-- STEP 1 -->
      <div class="wpage compact" id="w1">
        <div class="grid-compact-2" style="align-items:start">
          <div class="form-col">
            <h4 class="mono section" style="margin-top:0">Aufenthaltsdaten</h4>
            <div class="grid-compact">
              <label style="grid-column:1 / -1">Hotel
                <select id="newHotel" class="input theme-select" style="width:100%"></select>
              </label>
              <label>Anreise <input id="newArr" type="date" class="input"/></label>
              <label>Abreise <input id="newDep" type="date" class="input"/></label>
              <label>Erwachsene <input id="newAdults" type="number" min="1" value="1" class="input"/></label>
              <label>Kinder <input id="newChildren" type="number" min="0" value="0" class="input"/></label>
            </div>

            <h4 class="mono section">Gästedaten</h4>
            <div class="grid-compact">
              <label>Vorname <input id="newFname" class="input" placeholder="Max"/></label>
              <label>Nachname* <input id="newLname" class="input" placeholder="Mustermann" required/></label>
              <label>PLZ <input id="newZip" class="input" placeholder="80331"/></label>
              <label>Straße <input id="newStreet" class="input" placeholder="Musterstraße 1"/></label>
              <label style="grid-column:1 / -1">Ort <input id="newCity" class="input" placeholder="München"/></label>
            </div>
          </div>

          <div class="preview-col">
            <div class="imgcard hotel">
              <img id="hotelImg" src="/assets/hotel-placeholder.png" alt="Hotelbild"
                   style="width:100%;height:360px;object-fit:cover;border-radius:10px;display:block"
                   onerror="this.onerror=null;this.src='/assets/hotel-placeholder.png';"/>
            </div>

            <div class="box" style="margin-top:12px">
              <h4 class="mono section" style="margin:0 0 6px">Kontaktdaten</h4>
              <div class="grid-compact">
                <label style="grid-column:1 / -1">Telefon <input id="newPhone" class="input" placeholder="+49 …"/></label>
                <label style="grid-column:1 / -1">E-Mail <input id="newEmail" class="input" placeholder="max@example.com"/></label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="wpage narrow" id="w2">
        <div class="s2-top">
          <div class="s2-left">
            <label class="s2-label">Kategorie
              <select id="newCat" class="input theme-select"></select>
            </label>

            <div class="box s2-facts">
              <div class="mono muted tiny" style="margin-bottom:4px">Fakten</div>
              <div class="tiny">
                Max Personen: 2<br/>
                Haustiere erlaubt: Nein<br/>
                Check In: 15:00<br/>
                Check Out: 11:00
              </div>
            </div>
          </div>

          <div class="box s2-desc">
            <div class="mono muted tiny" style="margin-bottom:4px">Beschreibung</div>
            <div id="catDesc" class="tiny">
              das Zimmer hat eine größe von mehr oder weniger als 40m², Toaster, Mikrowelle und Balkon mit Ausblick.
              Dies ist ein Placeholder-Text und soll einen visuellen Effekt erzeugen. Die Beschreibung soll dem Agent
              alle Infos zu der Zimmerkategorie liefern, um möglichst präziser arbeiten zu können.
            </div>
          </div>
        </div>

        <div class="s2-gallery">
          <div class="imgcard"><img id="imgCatPreview"  alt="Kategorie Bild 1" /></div>
          <div class="imgcard"><img id="imgCatPreview2" alt="Kategorie Bild 2" /></div>
          <div class="imgcard"><img id="imgCatPreview3" alt="Kategorie Bild 3" /></div>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="wpage narrow hidden" id="w3">
        <div class="row wrap" style="gap:12px;align-items:flex-start;">
          <label style="min-width:260px;flex:1">Rate
            <select id="newRate" class="input theme-select"></select>
          </label>
          <label style="width:160px">Preis
            <input id="newPrice" type="number" step="1" value="89" class="input"/>
          </label>
        </div>
        <div class="policy-box">
          <div class="muted">Stornobedingung</div>
          <p id="ratePolicyPreview">—</p>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="wpage hidden" id="w4">
        <aside class="summary box" id="summaryFinal"></aside>

        <h4 class="mono section">Gastdaten</h4>
        <details class="box">
          <summary class="mono">Firma (optional)</summary>
          <div class="grid2">
            <label>Firma <input id="newCompany" class="input" /></label>
            <label>USt-ID <input id="newVat" class="input" /></label>
            <label>PLZ <input id="newCompanyZip" class="input" /></label>
            <label>Adresse <input id="newAddress" class="input" placeholder="Straße + Ort" /></label>
          </div>
        </details>

        <h4 class="mono section">Kreditkarte</h4>
        <div class="cc-wrap">
          <div class="cc-visual">
            <div class="cc-chip"></div>
            <div class="cc-num"  id="ccNumLive">•••• •••• •••• ••••</div>
            <div class="cc-holder" id="ccHolderLive">NAME</div>
            <div class="cc-exp"    id="ccExpLive">MM/YY</div>
          </div>
          <div class="cc-form">
            <div class="grid2">
              <label>Karteninhaber <input id="ccHolder" class="input" /></label>
              <label>Kartennummer <input id="ccNumber" class="input" placeholder="•••• •••• •••• 1234" /></label>
              <label>Ablauf (MM/JJ) <input id="ccExpiry" class="input" placeholder="12/27" /></label>
            </div>
          </div>
        </div>

        <label class="section mono">Notizen
          <textarea id="newNotes" class="input" rows="3" placeholder="Besonderheiten, Wünsche …"></textarea>
        </label>
      </div>

      <div class="wizard-actions">
        <button class="btn ghost hidden" id="btnPrev">Zurück</button>
        <div style="flex:1"></div>
        <button class="btn" id="btnNext" disabled>Weiter</button>
        <button class="btn primary hidden" id="btnCreate">Reservierung abschicken</button>
      </div>

      <p class="muted" id="newInfo" style="margin-top:8px;"></p>
    </div>
  </section>

  <!-- Reservierung bearbeiten -->
  <section class="modal" id="modalEdit" role="dialog" aria-labelledby="editTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="editTitle" class="mono">Reservierung bearbeiten</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="tabs">
        <button class="tab active" data-tab="tabDet">Details</button>
        <button class="tab" data-tab="tabPlan">Preisplan</button>
        <button class="tab" data-tab="tabPay">Zahlungskonto</button>
        <button class="tab" data-tab="tabAct">Aktionen</button>
      </div>

      <div class="tabpage" id="tabDet">
        <div class="grid2">
          <label>Res.-Nr. <input id="eResNo" class="input" disabled/></label>
          <label>Status
            <select id="eStatus" class="input theme-select">
              <option>active</option>
              <option>done</option>
              <option>canceled</option>
            </select>
          </label>
          <label>Hotel <input id="eHotel" class="input" disabled/></label>
          <label>Gast Nachname <input id="eLname" class="input"/></label>
          <label>Anreise <input id="eArr" type="date" class="input"/></label>
          <label>Abreise <input id="eDep" type="date" class="input"/></label>
          <label>Kategorie
  <select id="eCat" class="input theme-select"></select>
</label>
<label>Rate
  <select id="eRate" class="input theme-select"></select>
</label>
<!-- Gesamtpreis (read-only; Summe aus Preisplan) -->
<div class="row" style="gap:12px; align-items:flex-end;">
  <div style="flex:1 1 220px;">
    <label for="editTotalPrice" class="lbl">Gesamtpreis</label>
    <input id="editTotalPrice" class="input mono" type="number" step="0.01" readonly
           title="Summe der Nachtpreise aus dem Preisplan" />
  </div>
</div>

<!-- Notizen (klar erkennbar, rot-leuchtender Rahmen) -->
<div style="margin-top:12px;">
  <div class="lbl" style="display:flex; align-items:center; gap:8px;">
    <span>Notizen</span>
    <span class="tiny muted">(intern)</span>
  </div>
  <div style="
       border:1px solid #ff4d4d;
       border-radius:10px;
       box-shadow: 0 0 12px rgba(255,77,77,.25), inset 0 0 8px rgba(255,77,77,.12);
       padding:8px;">
    <textarea id="editNotes" class="input" rows="4" placeholder="Interne Notizen zur Reservierung"
              style="resize:vertical; border:none; background:transparent; box-shadow:none;"></textarea>
  </div>
</div>
        </div>
        <div class="right"><button class="btn" id="btnSaveEdit">Speichern</button></div>
      </div>

      <!-- +++ NEU: Preisplan-Tab +++ -->
<div id="tabPlan" class="tabpage hidden">
  <div class="section">
    <div class="row wrap" style="justify-content:space-between;align-items:center;">
      <h4 class="mono" style="margin:0">Preisplan (pro Nacht)</h4>
      <div class="row wrap" style="gap:8px;">
        <button id="btnPlanFillWeekdays" class="btn sm ghost" title="Wochentage-Muster anwenden">Wochentage-Muster</button>
        <button id="btnPlanAll" class="btn sm ghost" title="Alle Nächte auf einen Preis setzen">💰All Price</button>
        <button id="btnPlanReset" class="btn sm ghost" title="Alle Nächte wieder auf Basispreis setzen">Zurücksetzen</button>
        <button id="btnSavePlan" class="btn sm primary">Preisplan speichern</button>
       <!-- Footer-Aktionen unten rechts im Tab -->
<div id="planFooter" style="position:sticky; bottom:0; padding-top:8px;">
  <div style="display:flex; justify-content:flex-end; gap:8px;">
    <button id="btnApplyTrim" class="btn sm danger hidden">Anpassung speichern</button>
  </div>
</div>
        <!-- Mini-Popup: All Price -->
<div id="planAllPopup" class="card hidden" style="
     position:absolute; right:12px; top:56px; z-index:200;
     width: 260px; padding:12px; border:1px solid var(--line,#17414b);">
  <div class="mono" style="margin-bottom:8px;">Alle Nächte auf Preis setzen</div>
  <div class="row" style="gap:8px; align-items:center;">
    <input id="planAllValue" class="input mono" type="number" step="0.01" min="0" placeholder="z. B. 109.00" style="flex:1;">
    <span class="mono">€</span>
  </div>
  <div class="row" style="justify-content:flex-end; gap:8px; margin-top:10px;">
    <button id="planAllCancel" class="btn sm">Abbrechen</button>
    <button id="planAllApply" class="btn sm primary">Preise setzen</button>
  </div>
</div>


      </div>
    </div>
    <div id="planList" class="grid2" style="margin-top:10px;"></div>
    <div id="planInfo" class="muted" style="margin-top:8px"></div>
  </div>
</div>


      <div class="tabpage hidden" id="tabPay">
        <div class="grid2">
          <label>Karteninhaber <input id="eCcHolder" class="input"/></label>
          <label>Last4 <input id="eCcLast4" class="input"/></label>
          <label>Exp. Monat <input id="eCcExpM" type="number" min="1" max="12" class="input"/></label>
          <label>Exp. Jahr <input id="eCcExpY" type="number" min="24" max="40" class="input"/></label>
        </div>
        <div class="right"><button class="btn" id="btnSavePay">Speichern</button></div>
      </div>

      <div class="tabpage hidden" id="tabAct">
        <div class="box">
          <p class="muted">Reservierung stornieren? Status wird auf <b>canceled</b> gesetzt.</p>
          <button class="btn danger" id="btnCancelRes">Stornieren</button>
          <button id="btnResendConfirmation" class="btn btn--primary">Bestätigung erneut senden</button>
        </div>
      </div>

      <p class="muted" id="editInfo" style="margin-top:8px;"></p>
    </div>
  </section>

  <!-- Verfügbarkeit -->
  <section class="modal" id="modalAvail" role="dialog" aria-labelledby="availTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="availTitle" class="mono"><span class="rep-logo"></span> Verfügbarkeit</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="row wrap" style="margin-bottom:8px;">
        <label>Von <input id="availFrom" type="date" class="input" style="width:170px;"></label>
        <label>Tage
          <select id="availDays" class="input theme-select" style="width:120px;">
            <option value="7">7</option>
            <option value="14" selected>14</option>
            <option value="30">30</option>
            <option value="60">60</option>
          </select>
        </label>
        <button class="btn" id="availRun">Aktualisieren</button>
        <div class="muted" style="margin-left:auto;">Legende:
          <span class="pill occ-g">≤64%</span>
          <span class="pill occ-o">65–89%</span>
          <span class="pill occ-r">≥90%</span>
        </div>
      </div>
      <div class="matrix compact">
        <table class="matrix" id="matrixTable">
          <thead><tr><th class="sticky">Hotel</th></tr></thead>
          <tbody id="matrixBody"></tbody>
        </table>
      </div>
    </div>
  </section>

   <!-- Reporting -->
<section class="modal" id="modalReporting" role="dialog" aria-labelledby="repTitle" aria-modal="true">
 <header>
  <h3 id="repTitle" class="mono">
    <span class="rep-logo"></span> Reporting
  </h3>
  <button class="btn" data-close>Schließen</button>
</header>
  <div class="body">
    <div class="row wrap">
      <label>Von <input id="repFrom" type="date" class="input"></label>
      <label>Bis <input id="repTo" type="date" class="input"></label>
      <label>Hotel
        <select id="repHotel" class="input theme-select" style="width:200px;"></select>
      </label>
      <button class="btn" id="repRun">Aktualisieren</button>

      <!-- kompakte Export-Spalte rechts -->
      <div class="rep-tools">
        <button class="btn ghost" id="repXls">Export Excel</button>
        <button class="btn ghost" id="repCsv">Export CSV</button>
        <button class="btn ghost" id="repPdf">Export PDF</button>
      </div>
    </div>

    <!-- kompakte, gleich hohe Charts -->
    <div class="rep-charts">
      <div class="chart-card">
        <h4 class="mono">Umsatz pro Hotel</h4>
        <div class="chart-box"><canvas id="chartRevenue"></canvas></div>
      </div>
      <div class="chart-card">
        <h4 class="mono">Buchungen pro Hotel</h4>
        <div class="chart-box"><canvas id="chartBookings"></canvas></div>
      </div>
    </div>

    <div class="table-wrap">
      <table class="resv">
        <thead>
          <tr>
            <th>Hotel</th>
            <th>Buchungen</th>
            <th>Umsatz</th>
            <th>ADR</th>
            <th>Belegungsrate</th>
          </tr>
        </thead>
        <tbody id="repBody"></tbody>
      </table>
    </div>
  </div>
</section>

  <!-- Einstellungen -->
  <section class="modal" id="modalSettings" role="dialog" aria-labelledby="setTitle" aria-modal="true">
    <header>
      <h3 id="setTitle" class="mono">
        <span class="set-logo" aria-hidden="true"></span> Einstellungen
      </h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <!-- oben: links Form / rechts Live-Systeminfo -->
     <div class="set-top">
  <!-- LINKER BLOCK: Sprache/Farbton + Buttons -->
  <div class="set-left">
    <div class="set-grid">
      <label class="set-field">
        <span class="set-label">Sprache</span>
        <select id="selLang" class="input theme-select">
          <option value="de">Deutsch</option>
          <option value="en">English</option>
        </select>
      </label>

      <label class="set-field">
        <span class="set-label">Farbton (Hue) <span id="hueVal" class="muted">180°</span></span>
        <input id="rngHue" class="hue" type="range" min="0" max="359" step="1" />
      </label>
    </div>

    <!-- Buttons direkt darunter, klein -->
    <div class="set-tiles">
      <button class="btn tile" id="btnUserPrefs">Benutzereinstellungen</button>
      <button class="btn tile" id="btnChannel">Channel – Einstellungen</button>
      <button class="btn tile" id="btnLog">Log Activity</button>
      <button class="btn tile" id="btnCats">Kategorieverwaltung</button>
      <button class="btn tile" id="btnRates" data-modal="#modalRates">Rateneinstellungen</button>
      <button class="btn tile" id="btnHelp">Hilfe & FAQ</button>
    </div>
  </div>

  <!-- RECHTER BLOCK: Live-Systeminfo (kleiner, transparenter) -->
  <aside class="box set-sys" id="netBox">
    <h4 class="mono section" style="margin:0 0 6px">Live‑Systeminfo</h4>
    <div class="sys-grid">
      <div class="settings-row"><label>Öffentliche IP</label><span id="netIp">—</span></div>
      <div class="settings-row"><label>IPv4</label><span id="netIpv4">—</span></div>
      <div class="settings-row"><label>Standort</label><span id="netLoc">—</span></div>
      <div class="settings-row"><label>OS / Browser</label><span id="netOs">—</span></div>
    </div>
    <p class="muted tiny">Live Daten.</p>
  </aside>
</div>

      <!-- unten rechts: Speichern -->
      <div class="set-footer right">
  <button class="btn primary" id="btnSaveSettings" data-i18n="settings.save">
    Einstellungen speichern
  </button>
</div>

      <p class="muted" id="setInfo"></p>
    </div>
  </section>

<!-- Modal: Channel Settings (admin) – NEU -->
<section class="modal" id="modalChannel" role="dialog" aria-labelledby="channelTitle" aria-modal="true">
  <header>
    <h3 id="channelTitle" class="mono">
      <span class="set-logo" aria-hidden="true"></span> Channel – Einstellungen
    </h3>
    <button class="btn" data-close>Schließen</button>
  </header>

  <div class="body" style="min-width:920px; max-width:96vw;">
    <div class="channel-wrap" style="display:flex; gap:12px; align-items:stretch;">
      <!-- Linke Tabs -->
      <aside class="box" style="width:260px; padding:10px;">
        <div class="mono muted tiny" style="margin-bottom:6px">Bereiche</div>
        <div class="channel-tabs" id="channelTabs" style="display:flex; flex-direction:column; gap:6px;">
          <button class="btn tile channel-tab active" data-channel-tab="api">Api – Einstellungen</button>
          <button class="btn tile channel-tab" data-channel-tab="property">Property – Mapping</button>
          <button class="btn tile channel-tab" data-channel-tab="monitor">Monitoring</button>
          <button class="btn tile channel-tab" data-channel-tab="system">System – Technik</button>
          <button class="btn tile channel-tab" data-channel-tab="admin">Admin</button>
        </div>
      </aside>

      <!-- Rechte Contentfläche -->
      <section class="card" style="flex:1;">
        <div class="content" id="channelContent" style="min-height:480px;">
          <!-- Page: API -->
          <div class="channel-page" id="chPage_api">
            <div class="card-head"><h3 class="mono" style="margin:0">API – Einstellungen</h3></div>
            <div class="grid2">
              <label>API-Key (versteckt)
                <input id="chApiKey" type="password" class="input" autocomplete="off" placeholder="••••••••" />
              </label>
              <label>API-Secret (versteckt)
                <input id="chApiSecret" type="password" class="input" autocomplete="off" placeholder="••••••••" />
              </label>
              <label>HNS Endpoint – PROD
                <input id="chHnsProd" class="input" placeholder="https://api.hns.example/v1" />
              </label>
              <label>HNS Endpoint – TEST
                <input id="chHnsTest" class="input" placeholder="https://sandbox.hns.example/v1" />
              </label>
              <label>Timeout (ms)
                <input id="chTimeout" type="number" class="input" value="15000" min="1000" step="500" />
              </label>
              <label>Retry-Versuche
                <input id="chRetry" type="number" class="input" value="2" min="0" max="5" />
              </label>
              <label style="grid-column:1 / -1">Hotel-Mapping (JSON: unsere <code>hotel_code</code> → HNS-Code)
                <textarea id="chHotelMap" class="input" rows="4" placeholder='{"MA7-STR":"HNS_123","TAL-SON":"HNS_987"}'></textarea>
              </label>
            </div>
          </div>

          <!-- Page: Property -->
          <div class="channel-page hidden" id="chPage_property">
            <div class="card-head"><h3 class="mono" style="margin:0">Property – Mapping</h3></div>
            <div class="box">
              <div class="mono muted tiny" style="margin-bottom:6px">Hotels aktiv</div>
              <div id="chHotelActiveList" class="grid-compact" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:8px;"></div>
            </div>
            <div class="grid2" style="margin-top:8px">
              <label style="grid-column:1 / -1">Kategorien-Mapping (JSON: unsere Kategorie → HNS)
                <textarea id="chCatMap" class="input" rows="3" placeholder='{"Standard":"STD","Superior":"SUP","Suite":"STE"}'></textarea>
              </label>
              <label style="grid-column:1 / -1">Raten-Mapping (JSON: unser Ratecode → HNS-Ratecode)
                <textarea id="chRateMap" class="input" rows="3" placeholder='{"1001":"BAR","1002":"BAR_BB"}'></textarea>
              </label>
            </div>
          </div>

         <!-- Page: Monitoring -->
<div class="channel-page hidden" id="chPage_monitor">
  <div class="card-head"><h3 class="mono" style="margin:0">Monitoring</h3></div>
  <div class="row" style="gap:8px; align-items:center;">
    <span class="mono muted tiny">Status:</span>
    <span class="pill" id="chChipHns">HNS</span>
    <span class="pill" id="chChipSb">SB</span>
  </div>
  <div class="grid2" style="margin-top:10px">
    <div>
      <h4 class="mono section">Error-Log (letzte 10)</h4>
      <ul id="chErrorList" class="tiny" style="margin:6px 0 0 16px; line-height:1.4"></ul>
    </div>
    <div>
      <h4 class="mono section">Mapping-Übersicht</h4>
      <div id="chMappingSummary" class="tiny" style="margin-bottom:8px;">—</div>

      <!-- Ampel -->
      <div class="box" id="chMapAmpel" style="display:grid; gap:8px;">
        <!-- wird per JS befüllt -->
      </div>
    </div>
  </div>
</div>

          <!-- Page: System -->
          <div class="channel-page hidden" id="chPage_system">
            <div class="card-head"><h3 class="mono" style="margin:0">System – Technik</h3></div>
            <div class="grid2">
              <label>Modus
                <select id="chMode" class="input theme-select">
                  <option value="sandbox">Sandbox</option>
                  <option value="live">Live</option>
                </select>
              </label>
              <div class="row" style="align-items:end; gap:8px;">
                <button class="btn" id="chExport">Export Settings (JSON)</button>
                <label class="btn ghost" for="chImportFile">Import JSON</label>
                <input id="chImportFile" type="file" accept="application/json" style="display:none;">
              </div>
              <div style="grid-column:1 / -1" class="box">
                <div class="mono muted tiny" style="margin-bottom:6px">Hotel hinzufügen (on-the-fly)</div>
                <div class="grid-compact">
                  <label>Code <input id="chNewHotelCode" class="input" placeholder="VV-HH"></label>
                  <label>Name <input id="chNewHotelName" class="input" placeholder="Villa Viva Hamburg"></label>
                  <label>Gruppe <input id="chNewHotelGroup" class="input" placeholder="Villa Viva"></label>
                  <label>Bild-URL <input id="chNewHotelImg" class="input" placeholder="/assets/hotel-placeholder.png"></label>
                  <button class="btn" id="chAddHotel">Hotel hinzufügen</button>
                </div>
              </div>
              <label style="grid-column:1 / -1">Stornierungsbedingungen (Default, Markdown/Plain)
                <textarea id="chCancelPolicy" class="input" rows="3" placeholder="Bis 18:00 Uhr am Anreisetag kostenfrei stornierbar."></textarea>
              </label>
            </div>
          </div>

         <!-- Page: Admin -->
<div class="channel-page hidden" id="chPage_admin">
  <div class="card-head"><h3 class="mono" style="margin:0">Admin</h3></div>
  <div class="grid2">
    <div class="box">
      <div class="settings-row"><label>Passwortschutz</label><span class="muted tiny">ist aktiv (Prompt)</span></div>
      <div class="settings-row"><label>Letzter Sync</label><span id="chLastSync">—</span></div>
    </div>
    <div class="box">
      <p class="tiny muted">
        „Jetzt synchronisieren“ führt einen Health-Check aus, zieht Availability von HNS (für aktive Hotels)
        und schreibt alles ins Log. Danach werden KPIs & Matrix aktualisiert.
      </p>
      <button class="btn primary" id="btnSyncNow">Jetzt synchronisieren</button>
    </div>
  </div>
</div>

        <!-- Footer -->
        <div class="set-footer right">
          <button class="btn primary" id="btnSaveChannel">Einstellungen speichern</button>
        </div>
      </section>
    </div>
    <p class="muted tiny" id="channelInfo" style="margin-top:6px;"></p>
  </div>
</section>


<!-- Modal: Log Activity (admin) -->
<section class="modal" id="modalLog" role="dialog" aria-labelledby="logTitle" aria-modal="true">
  <header>
    <h3 id="logTitle" class="mono">
      <span class="set-logo" aria-hidden="true"></span> Log Activity
    </h3>
    <button class="btn" data-close>Schließen</button>
  </header>
  <div class="body">
    <div class="row wrap" style="margin-bottom:8px;">
      <input id="logSearch" class="input" placeholder="Suche… (Text/Meta)" style="width:220px;">
      <select id="logType" class="input theme-select" style="width:180px;">
        <option value="">Typ: Alle</option>
        <option value="settings">settings</option>
        <option value="reservation">reservation</option>
        <option value="channel">channel</option>
        <option value="system">system</option>
      </select>
      <label>Von <input id="logFrom" type="date" class="input" style="width:160px;"></label>
      <label>Bis <input id="logTo" type="date" class="input" style="width:160px;"></label>
      <button class="btn" id="logApply">Filter anwenden</button>
      <button class="btn ghost" id="logClear">Zurücksetzen</button>
    </div>
    <div class="table-wrap">
      <table class="table" id="logTable">
  <thead>
    <tr>
      <th>Datum/Zeit</th>
      <th>Benutzer</th> <!-- NEU -->
      <th>Typ</th>
      <th>Aktion</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
      <div id="logPager" class="toolbar" style="justify-content:flex-end;gap:8px">
  <button id="logPrev" class="btn sm ghost">Zurück</button>
  <span id="logPageInfo" class="muted">Seite 1 / 1 · 0 Einträge</span>
  <button id="logNext" class="btn sm">Weiter</button>
</div>

    </div>
  </div>
</section>

<!-- Kategorieverwaltung -->
<section class="modal" id="modalCats" role="dialog" aria-labelledby="catsTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="catsTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Kategorieverwaltung</h3>
    <button class="btn" data-close>Schließen</button>
  </header>

  <div class="body">
    <div class="cats-wrap">
      <!-- Linke Spalte: Filter + Anlage -->
      <aside class="cats-side">
        <label class="set-field">
          <span class="set-label">Hotel</span>
          <select id="catsHotel" class="input theme-select"></select>
        </label>

        <label class="set-field">
          <span class="set-label">Suche</span>
          <input id="catsSearch" class="input sm" placeholder="Suche: Code/Name">
        </label>

        <hr class="rates-sep"/>

        <div class="box">
          <h4 class="mono" style="margin:0 0 6px;">Neue Kategorie</h4>
          <div class="grid2">
            <label>Code
              <input id="catCodeNew" class="input sm" placeholder="z. B. STD" maxlength="12">
            </label>
            <label>Max. Pers.
              <input id="catMaxNew" type="number" min="1" max="12" class="input sm" value="2">
            </label>
          </div>
          <label style="margin-top:6px">Name
            <input id="catNameNew" class="input sm" placeholder="z. B. Standard">
          </label>
          <p class="muted tiny" style="margin:6px 0 0;">
            Code: nur Großbuchstaben/Zahlen, fix nach Anlage. Hotel & Code sind später nicht änderbar.
          </p>
          <div class="right" style="margin-top:8px">
            <button class="btn sm" id="btnCatCreate">Hinzufügen</button>
          </div>
          <p class="muted tiny" id="catsInfo" style="margin-top:6px"></p>
        </div>
      </aside>

      <!-- Rechte Spalte: Tabelle -->
      <section class="cats-main card">
        <div class="content">
          <div class="card-head">
            <h3 class="mono" id="catsTitleHotel">Kategorien</h3>
            <div class="muted tiny" id="catsCount"></div>
          </div>

          <div class="table-wrap">
            <table class="resv" id="catsTable">
              <thead>
                <tr>
                  <th style="width:120px">Code</th>
                  <th>Name</th>
                  <th style="width:140px">Max. Pers.</th>
                  <th style="width:160px">Aktionen</th>
                </tr>
              </thead>
              <tbody id="catsTbody"></tbody>
            </table>
          </div>

          <div class="pagination">
            <button class="btn" id="catsPrev">Zurück</button>
            <span class="muted" id="catsPageInfo">Seite 1</span>
            <button class="btn" id="catsNext">Weiter</button>
          </div>

          <p class="muted tiny" style="margin-top:6px">Max. 50 Einträge pro Seite.</p>
        </div>
      </section>
    </div>
  </div>
</section>


  <!-- Benutzereinstellungen -->
  <section class="modal" id="modalUserPrefs" role="dialog" aria-labelledby="userPrefsTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="userPrefsTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Benutzereinstellungen</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="box">
        <p class="muted">Platzhalter für persönliche Einstellungen (z. B. Standardhotel, Standardzeitraum, Shortcuts …).</p>
      </div>
    </div>
  </section>


<!-- Rateneinstellungen (nur Verwaltung/Liste – ohne "Neue Rate") -->
<section class="modal" id="modalRates" role="dialog" aria-labelledby="ratesTitle" aria-modal="true">
  <header>
    <h3 id="ratesTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Rateneinstellungen</h3>
    <button class="btn" data-close>Schließen</button>
  </header>
<div class="body">
  <div class="rates-wrap">
    <!-- Linke Listener-Leiste -->
   <aside class="rates-side">
  <button class="btn primary sm" id="rsNewRate">+ Neue Rate</button>
  <input id="rsSearch" class="input sm" placeholder="Suchen: Name oder Ratecode">
  <select id="rsHotelFilter" class="input sm theme-select" title="Hotel filtern"></select>
  <hr class="rates-sep"/>
  <button class="btn tile active" id="rsTabDirect" data-rates-tab="direct">Direct-Rate</button>
  <button class="btn tile" id="rsTabCorp"   data-rates-tab="corp">Corp-Rate</button>
  <button class="btn tile" id="rsTabIds"    data-rates-tab="ids">IDS-Rate</button>
</aside>

    <!-- Rechte Hauptfläche -->
    <section class="rates-main card">
      <div class="content">
        <div class="card-head">
          <h3 class="mono" id="rsTitle">Raten – Direct</h3>
         <div class="rs-toolbar"></div>
        </div>

        <div class="table-wrap" id="ratesBoard" data-max-rows="50">
          <table class="resv">
            <thead>
              <tr>
                <th style="width:110px">Ratecode</th>
                <th>Name</th>
                <th>Hotel</th>
                <th style="width:180px">Kategorien</th>
                <th style="width:110px">Preis</th>
                <th style="width:90px">Mapped</th>
              </tr>
            </thead>
            <tbody id="rsBody"></tbody>
          </table>
          <p class="muted tiny" style="margin-top:6px">Max. 50 Einträge werden angezeigt.</p>
        </div>
      </div>

      <div class="set-footer">
        <div style="flex:1"></div>
        <!-- (frei für spätere Aktionen) -->
      </div>
    </section>
  </div>
</div>
</section>

  <!-- Hilfe & FAQ -->
  <section class="modal" id="modalHelp" role="dialog" aria-labelledby="helpTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="helpTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Hilfe & FAQ</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="box">
        <h4 class="mono" style="margin:0 0 6px;">Schnelle Antworten</h4>
        <details class="box"><summary class="mono">Wie lege ich eine neue Reservierung an?</summary>
          <p class="tiny">Oben „Neue Reservierung“ → Schritt 1–4 durchklicken, dann „Reservierung abschicken“.</p>
        </details>
        <details class="box"><summary class="mono">Woher kommen Verfügbarkeiten?</summary>
          <p class="tiny">Aus der Tabelle <code>availability</code> (Supabase). HNS-Anbindung folgt.</p>
        </details>
        <details class="box"><summary class="mono">Werden Systeminfos gespeichert?</summary>
          <p class="tiny">Nein. IP/Standort/OS werden nur lokal angezeigt.</p>
        </details>
      </div>
    </div>
  </section>

  <!-- Hotelskizze -->
  <section class="modal" id="modalSketch" role="dialog" aria-labelledby="sketchTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="sketchTitle" class="mono"><span class="sketch-logo" aria-hidden="true"></span> Hotelskizze</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="sketch-wrap">
        <aside class="sketch-left">
          <div class="mono muted tiny" style="margin-bottom:6px">Hotels</div>
          <div id="sketchList" class="sketch-list"></div>
        </aside>
        <section class="sketch-right">
          <div class="card">
            <div class="content">
              <div class="card-head">
                <h3 class="mono" id="sketchHotelLabel">Bitte Hotel wählen</h3>
                <span class="pill">Skizze</span>
              </div>
              <div class="imgcard wide">
                <img id="sketchImage" alt="Hotelskizze" />
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </section>

<!-- Modal: Kategoriebeschreibung -->
<section class="modal" id="modalCatDesc" role="dialog" aria-labelledby="catDescTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="catDescTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Kategoriebeschreibung</h3>
    <button class="btn" data-close>Schließen</button>
  </header>
  <div class="body">
    <label class="mono muted tiny" style="margin-bottom:6px;display:block">Beschreibungstext</label>
    <textarea id="catDescTextarea" class="input" rows="6" placeholder="Beschreibung zur Zimmerkategorie …"></textarea>
    <div class="set-footer right" style="margin-top:10px;">
      <button class="btn primary" id="btnCatDescSave">Speichern</button>
    </div>
  </div>
</section>

  
  <!-- Libraries + App -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.5/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Build erwartet /src/app.js -->
  <script src="/src/app.js"></script>
  <script src="/src/i18n.js"></script>

  <!-- Confirmations-Popup -->
<div id="confirmEmailModal" class="modal hidden" aria-hidden="true">
  <div class="modal__backdrop" data-close="confirmEmailModal"></div>
  <div class="modal__panel">
    <div class="modal__header">
      <h3>Reservierungsbestätigung versenden</h3>
      <button class="modal__close" data-close="confirmEmailModal" aria-label="Schließen">×</button>
    </div>

    <div class="modal__body">
      <label class="form__label">Empfänger-E-Mail</label>
      <input id="confirmEmailTo" type="email" class="form__input" placeholder="kunde@example.com" />

      <label class="form__label" style="margin-top:12px;">Nachricht (bearbeitbar)</label>
      <textarea id="confirmEmailBody" class="form__textarea" rows="8" placeholder="Ihre Buchungsbestätigung …"></textarea>
    </div>

    <div class="modal__footer">
      <div style="margin-right:auto; display:flex; gap:8px;"><button class="btn btn--ghost" id="btnCopyEmail" type="button" title="E-Mail kopieren">E-Mail kopieren</button><button class="btn btn--ghost" id="btnCopyConfirmation" type="button" title="Text kopieren">Text kopieren</button></div><button class="btn btn--ghost" data-close="confirmEmailModal">Abbrechen</button>
      <button id="btnSendConfirmationNow" class="btn btn--primary">Reservierungsbestätigung versenden</button>
    </div>
  </div>
</div>


  <div id="appToast" class="toast hidden" role="status" aria-live="polite"></div>

 <script>
/* ===== res-tool i18n (DE/EN) – extended coverage ===== */
(function(){
  const LS_KEY = 'resTool.lang';

  // --- Wörterbuch ---
  const I18N = {
    de: {
      // Topbar/Toolbar
      'btn.new':'Neue Reservierung','btn.avail':'Verfügbarkeit','btn.reporting':'Reporting','btn.settings':'Einstellungen','btn.sketch':'Hotelskizze',
      // KPIs
      'kpi.today.title':'Performance - Heute','kpi.today.bookings':'Buchungen (heute eingegangen)','kpi.today.revenue':'Umsatz (heute)','kpi.today.adr':'ADR (heute)','kpi.today.occ':'Auslastung (heute)',
      'kpi.next.title':'Performance - Nächste 7 Tage','kpi.next.revenue':'Umsatz (Anreisen +1..+7)','kpi.next.adr':'WDR (+1..+7)','kpi.next.occ':'Ø Auslastung (+1..+7)',
      // Res-Liste
      'res.title':'Reservierungen','res.th.resno':'Res.-Nr.','res.th.hotel':'Hotel','res.th.guest':'Gastname','res.th.arr':'Anreise','res.th.dep':'Abreise','res.th.cat':'Kategorie','res.th.rate':'Rate','res.th.price':'Preis','res.th.status':'Status',
      'res.ph.search':'Gastname…','res.ph.resno':'Res.-Nr.','res.filter.status.active':'Status: Active (Zukunft)','res.filter.status.done':'Status: Done (Vergangenheit)','res.filter.status.canceled':'Status: Canceled','res.filter.status.all':'Status: Alle',
      'btn.refresh':'Refresh','btn.reset':'Reset','btn.export.csv':'Export CSV',
      'pager.prev':'Zurück','pager.next':'Weiter','pager.page':'Seite','pager.of':'/','pager.entries':'Einträge',
      // Neue Reservierung
      'modal.new':'Neue Reservierung','wiz.step1':'Hotel & Daten','wiz.step2':'Kategorie','wiz.step3':'Rate','wiz.step4':'Gast & Zahlung',
      'lab.hotel':'Hotel','lab.arrival':'Anreise','lab.departure':'Abreise','lab.adults':'Erwachsene','lab.children':'Kinder',
      'lab.fname':'Vorname','lab.lname':'Nachname*','lab.zip':'PLZ','lab.street':'Straße','lab.city':'Ort',
      'contact.box':'Kontaktdaten','ph.phone':'Telefon','ph.email':'E-Mail',
      's2.facts':'Fakten','s2.desc':'Beschreibung',
      's3.policy':'Stornobedingung',
      's4.company':'Firma (optional)','s4.cc':'Kreditkarte','s4.notes':'Notizen',
      'btn.prev':'Zurück','btn.next':'Weiter','btn.create':'Reservierung abschicken','btn.close':'Schließen',
      // Edit Modal
      'modal.edit':'Reservierung bearbeiten','tab.details':'Details','tab.plan':'Preisplan','tab.pay':'Zahlungskonto','tab.act':'Aktionen',
      'lab.resno':'Res.-Nr.','lab.status':'Status','lab.guestlname':'Gast Nachname','lab.category':'Kategorie','lab.rate':'Rate',
      'lab.total':'Gesamtpreis','lab.notes':'Notizen','notes.hint':'(intern)',
      'btn.save':'Speichern','btn.cancel':'Stornieren','btn.resend':'Bestätigung erneut senden',
      // Availability
      'modal.avail':'Verfügbarkeit','lab.from':'Von','lab.to':'Bis','lab.days':'Tage','avail.legend':'Legende:','avail.g':'≤64%','avail.o':'65–89%','avail.r':'≥90%','btn.update':'Aktualisieren',
      // Reporting
      'modal.report':'Reporting','report.h1':'Umsatz pro Hotel','report.h2':'Buchungen pro Hotel',
      'rep.th.hotel':'Hotel','rep.th.bookings':'Buchungen','rep.th.revenue':'Umsatz','rep.th.adr':'ADR','rep.th.occ':'Belegungsrate',
      'btn.export.xls':'Export Excel','btn.export.csv':'Export CSV','btn.export.pdf':'Export PDF',
      // Settings
      'modal.settings':'Einstellungen','set.lang':'Sprache','set.hue':'Farbton (Hue)','set.save':'Einstellungen speichern',
      'set.userprefs':'Benutzereinstellungen','set.channel':'Channel – Einstellungen','set.log':'Log Activity','set.cats':'Kategorieverwaltung','set.rates':'Rateneinstellungen','set.help':'Hilfe & FAQ',
      'sysinfo':'Live-Systeminfo',
      // Quick Links
      'ql.book':'Buchungs-Tracker','ql.call':'Telefon-Tracker','ql.manual':'Handbuch',
      // Rate-Edit/Create
      'modal.rate.edit':'Rate bearbeiten','modal.rate.create':'Neue Rate',
      'lab.ratecode':'Ratecode (nur Zahlen)','lab.ratetype':'Ratentyp*','lab.ratehotel':'Hotel*','lab.ratename':'Ratename*','lab.cats':'Kategorien','lab.policy':'Stornobedingung','lab.price':'Preis/Nacht (€)','lab.mapped':'Gemappt',
      'btn.rate.create':'Rate erstellen','btn.rate.update':'Änderungen speichern','btn.rate.delete':'Rate löschen',
      // Category Mgmt
      'modal.cats':'Kategorieverwaltung','cats.new':'Neue Kategorie','lab.cat.code':'Code','lab.cat.max':'Max. Pers.','lab.cat.name':'Name','ph.cats.search':'Suche: Code/Name',
      // Channel
      'modal.channel':'Channel – Einstellungen','tab.api':'API – Einstellungen','tab.prop':'Property – Mapping','tab.monitor':'Monitoring','tab.system':'System – Technik','tab.admin':'Admin',
      'btn.sync':'Jetzt synchronisieren',
      // Log
      'modal.log':'Log Activity','log.ph.search':'Suche… (Text/Meta)','log.type.all':'Typ: Alle','log.th.time':'Datum/Zeit','log.th.user':'Benutzer','log.th.type':'Typ','log.th.action':'Aktion','log.th.details':'Details'
    },
    en: {
      // Topbar/Toolbar
      'btn.new':'New Reservation','btn.avail':'Availability','btn.reporting':'Reporting','btn.settings':'Settings','btn.sketch':'Hotel Sketch',
      // KPIs
      'kpi.today.title':'Performance - Today','kpi.today.bookings':'Bookings (received today)','kpi.today.revenue':'Revenue (today)','kpi.today.adr':'ADR (today)','kpi.today.occ':'Occupancy (today)',
      'kpi.next.title':'Performance - Next 7 Days','kpi.next.revenue':'Revenue (arrivals +1..+7)','kpi.next.adr':'ADR (+1..+7)','kpi.next.occ':'Avg. Occupancy (+1..+7)',
      // Res-Liste
      'res.title':'Reservations','res.th.resno':'Res. No.','res.th.hotel':'Hotel','res.th.guest':'Guest name','res.th.arr':'Arrival','res.th.dep':'Departure','res.th.cat':'Category','res.th.rate':'Rate','res.th.price':'Price','res.th.status':'Status',
      'res.ph.search':'Guest name…','res.ph.resno':'Res. No.','res.filter.status.active':'Status: Active (future)','res.filter.status.done':'Status: Done (past)','res.filter.status.canceled':'Status: Canceled','res.filter.status.all':'Status: All',
      'btn.refresh':'Refresh','btn.reset':'Reset','btn.export.csv':'Export CSV',
      'pager.prev':'Back','pager.next':'Next','pager.page':'Page','pager.of':'/','pager.entries':'entries',
      // Neue Reservierung
      'modal.new':'New Reservation','wiz.step1':'Hotel & Dates','wiz.step2':'Category','wiz.step3':'Rate','wiz.step4':'Guest & Payment',
      'lab.hotel':'Hotel','lab.arrival':'Arrival','lab.departure':'Departure','lab.adults':'Adults','lab.children':'Children',
      'lab.fname':'First name','lab.lname':'Last name*','lab.zip':'ZIP','lab.street':'Street','lab.city':'City',
      'contact.box':'Contact','ph.phone':'Phone','ph.email':'Email',
      's2.facts':'Facts','s2.desc':'Description',
      's3.policy':'Cancellation policy',
      's4.company':'Company (optional)','s4.cc':'Credit Card','s4.notes':'Notes',
      'btn.prev':'Back','btn.next':'Next','btn.create':'Submit reservation','btn.close':'Close',
      // Edit Modal
      'modal.edit':'Edit Reservation','tab.details':'Details','tab.plan':'Price Plan','tab.pay':'Payment','tab.act':'Actions',
      'lab.resno':'Res. No.','lab.status':'Status','lab.guestlname':'Guest last name','lab.category':'Category','lab.rate':'Rate',
      'lab.total':'Total price','lab.notes':'Notes','notes.hint':'(internal)',
      'btn.save':'Save','btn.cancel':'Cancel','btn.resend':'Resend confirmation',
      // Availability
      'modal.avail':'Availability','lab.from':'From','lab.to':'To','lab.days':'Days','avail.legend':'Legend:','avail.g':'≤64%','avail.o':'65–89%','avail.r':'≥90%','btn.update':'Update',
      // Reporting
      'modal.report':'Reporting','report.h1':'Revenue by hotel','report.h2':'Bookings by hotel',
      'rep.th.hotel':'Hotel','rep.th.bookings':'Bookings','rep.th.revenue':'Revenue','rep.th.adr':'ADR','rep.th.occ':'Occupancy',
      'btn.export.xls':'Export Excel','btn.export.csv':'Export CSV','btn.export.pdf':'Export PDF',
      // Settings
      'modal.settings':'Settings','set.lang':'Language','set.hue':'Hue (color)','set.save':'Save settings',
      'set.userprefs':'User preferences','set.channel':'Channel settings','set.log':'Log Activity','set.cats':'Category Management','set.rates':'Rate settings','set.help':'Help & FAQ',
      'sysinfo':'Live system info',
      // Quick Links
      'ql.book':'Booking tracker','ql.call':'Call tracker','ql.manual':'Manual',
      // Rate-Edit/Create
      'modal.rate.edit':'Edit Rate','modal.rate.create':'Create Rate',
      'lab.ratecode':'Ratecode (numbers only)','lab.ratetype':'Rate type*','lab.ratehotel':'Hotel*','lab.ratename':'Rate name*','lab.cats':'Categories','lab.policy':'Cancellation policy','lab.price':'Price / night (€)','lab.mapped':'Mapped',
      'btn.rate.create':'Create rate','btn.rate.update':'Save changes','btn.rate.delete':'Delete rate',
      // Category Mgmt
      'modal.cats':'Category Management','cats.new':'New Category','lab.cat.code':'Code','lab.cat.max':'Max. guests','lab.cat.name':'Name','ph.cats.search':'Search: Code/Name',
      // Channel
      'modal.channel':'Channel settings','tab.api':'API settings','tab.prop':'Property mapping','tab.monitor':'Monitoring','tab.system':'System / Tech','tab.admin':'Admin',
      'btn.sync':'Sync now',
      // Log
      'modal.log':'Log Activity','log.ph.search':'Search… (text/meta)','log.type.all':'Type: All','log.th.time':'Date/Time','log.th.user':'User','log.th.type':'Type','log.th.action':'Action','log.th.details':'Details'
    }
  };

  // --- Helfer: Label eines Inputs per ID setzen ---
  function setLabelByInputId(id, key, lang){
    const input = document.getElementById(id);
    if (!input) return;
    const label = input.closest('label') || input.parentElement?.tagName==='LABEL' ? input.parentElement : null;
    if (!label) return;
    const txt = tr(key, lang);
    const tn = Array.from(label.childNodes).find(n=>n.nodeType===3);
    if (tn) tn.nodeValue = txt + ' ';
    else label.prepend(document.createTextNode(txt + ' '));
  }

  // --- Texte holen ---
  function tr(key, lang){ return (I18N[lang] && I18N[lang][key]) || I18N.de[key] || ''; }

  // --- Haupt-Anwendung: alle bekannten Stellen übersetzen ---
  function applyI18n(lang){
    // Toolbar
    text('#btnNew','btn.new'); text('#btnAvail','btn.avail'); text('#btnReporting','btn.reporting'); text('#btnSettings','btn.settings'); text('#btnSketch','btn.sketch');

    // KPIs
    text('.hero article:nth-of-type(1) .card-head h3','kpi.today.title');
    text('.hero article:nth-of-type(2) .card-head h3','kpi.next.title');
    text('.hero article:nth-of-type(1) .kpis .kpi:nth-child(1) .label','kpi.today.bookings');
    text('.hero article:nth-of-type(1) .kpis .kpi:nth-child(2) .label','kpi.today.revenue');
    text('.hero article:nth-of-type(1) .kpis .kpi:nth-child(3) .label','kpi.today.adr');
    text('.hero article:nth-of-type(1) .kpis .kpi:nth-child(4) .label','kpi.today.occ');
    text('.hero article:nth-of-type(2) .kpis .kpi:nth-child(1) .label','kpi.next.revenue');
    text('.hero article:nth-of-type(2) .kpis .kpi:nth-child(2) .label','kpi.next.adr');
    text('.hero article:nth-of-type(2) .kpis .kpi:nth-child(3) .label','kpi.next.occ');

    // Reservierungen – Titel & Header
    text('section[aria-label="Reservierungen"] .card-head h3','res.title');
    th('#resTable thead th', ['res.th.resno','res.th.hotel','res.th.guest','res.th.arr','res.th.dep','res.th.cat','res.th.rate','res.th.price','res.th.status']);

    // Filter/Placeholders
    ph('#searchInput','res.ph.search'); ph('#filterResNo','res.ph.resno');
    text('#filterStatus option[value="active"]','res.filter.status.active');
    text('#filterStatus option[value="done"]','res.filter.status.done');
    text('#filterStatus option[value="canceled"]','res.filter.status.canceled');
    text('#filterStatus option[value="all"]','res.filter.status.all');
    text('#btnRefresh','btn.refresh'); text('#btnClearFilters','btn.reset'); text('#resExportCsv','btn.export.csv');

    // Paginierung Tabelle
    text('#prevPage','pager.prev'); text('#nextPage','pager.next');
    const pi = document.getElementById('pageInfo'); if (pi && /Seite|Page/.test(pi.textContent)) { /* dynamische Zahl drin lassen */ pi.textContent = pi.textContent.replace(/Seite|Page/, tr('pager.page',lang)); }

    // Quick Links
    text('.quick-links a:nth-child(1)','ql.book'); text('.quick-links a:nth-child(2)','ql.call'); text('.quick-links a:nth-child(3)','ql.manual');

    // Modale: Close-Buttons
    document.querySelectorAll('section.modal header button[data-close]').forEach(b=> b.textContent = tr('btn.close', lang));

    // Neue Reservierung – Titel/Steps
    text('#modalNew header h3','modal.new');
    text('.wizard-steps .wstep[data-step="1"] b','wiz.step1');
    text('.wizard-steps .wstep[data-step="2"] b','wiz.step2');
    text('.wizard-steps .wstep[data-step="3"] b','wiz.step3');
    text('.wizard-steps .wstep[data-step="4"] b','wiz.step4');

    // Step 1: Labels via Input-IDs
    setLabelByInputId('newHotel','lab.hotel',lang);
    setLabelByInputId('newArr','lab.arrival',lang);
    setLabelByInputId('newDep','lab.departure',lang);
    setLabelByInputId('newAdults','lab.adults',lang);
    setLabelByInputId('newChildren','lab.children',lang);
    setLabelByInputId('newFname','lab.fname',lang);
    setLabelByInputId('newLname','lab.lname',lang);
    setLabelByInputId('newZip','lab.zip',lang);
    setLabelByInputId('newStreet','lab.street',lang);
    setLabelByInputId('newCity','lab.city',lang);
    // Step 1: Kontakt-Box + Placeholders
    text('#w1 .preview-col .box h4.section','contact.box');
    ph('#newPhone','ph.phone'); ph('#newEmail','ph.email');

    // Step 2
    text('#w2 .s2-facts .mono','s2.facts');
    text('#w2 .s2-desc .mono','s2.desc');

    // Step 3
    text('#w3 .policy-box .muted','s3.policy');

    // Step 4
    text('#w4 .section:nth-of-type(1)','s4.company');
    text('#w4 .section:nth-of-type(2)','s4.cc');
    text('#w4 label.section','s4.notes');

    // Wizard Buttons
    text('#btnPrev','btn.prev'); text('#btnNext','btn.next'); text('#btnCreate','btn.create');

    // Edit-Modal – Titel/Tabs
    text('#modalEdit header h3','modal.edit');
    text('#modalEdit .tabs .tab[data-tab="tabDet"]','tab.details');
    text('#modalEdit .tabs .tab[data-tab="tabPlan"]','tab.plan');
    text('#modalEdit .tabs .tab[data-tab="tabPay"]','tab.pay');
    text('#modalEdit .tabs .tab[data-tab="tabAct"]','tab.act');

    // Edit-Modal – Labels (per Input-ID)
    setLabelByInputId('eResNo','lab.resno',lang);
    setLabelByInputId('eStatus','lab.status',lang);
    setLabelByInputId('eHotel','lab.hotel',lang);
    setLabelByInputId('eLname','lab.guestlname',lang);
    setLabelByInputId('eArr','lab.arrival',lang);
    setLabelByInputId('eDep','lab.departure',lang);
    setLabelByInputId('eCat','lab.category',lang);
    setLabelByInputId('eRate','lab.rate',lang);
    text('label[for="editTotalPrice"]','lab.total');
    const notesLbl = document.querySelector('#tabDet .lbl span:first-child'); if (notesLbl) notesLbl.textContent = tr('lab.notes',lang);
    const hint = document.querySelector('#tabDet .lbl .tiny'); if (hint) hint.textContent = tr('notes.hint',lang);

    text('#btnSaveEdit','btn.save'); text('#btnSavePay','btn.save'); text('#btnCancelRes','btn.cancel'); text('#btnResendConfirmation','btn.resend');

    // Availability
    text('#modalAvail header h3','modal.avail');
    setLabelByInputId('availFrom','lab.from',lang);
    setLabelByInputId('availDays','lab.days',lang);
    text('#availRun','btn.update');
    const avLegend = document.querySelector('#modalAvail .body .muted'); if (avLegend) avLegend.textContent = tr('avail.legend',lang);
    text('#modalAvail .pill.occ-g','avail.g'); text('#modalAvail .pill.occ-o','avail.o'); text('#modalAvail .pill.occ-r','avail.r');

    // Reporting
    text('#modalReporting header h3','modal.report');
    setLabelByInputId('repFrom','lab.from',lang);
    setLabelByInputId('repTo','lab.to',lang);
    setLabelByInputId('repHotel','lab.hotel',lang);
    text('#repXls','btn.export.xls'); text('#repCsv','btn.export.csv'); text('#repPdf','btn.export.pdf');
    text('#modalReporting .chart-card:nth-child(1) h4','report.h1');
    text('#modalReporting .chart-card:nth-child(2) h4','report.h2');
    th('#modalReporting thead th', ['rep.th.hotel','rep.th.bookings','rep.th.revenue','rep.th.adr','rep.th.occ']);

    // Settings
    text('#modalSettings header h3','modal.settings');
    // Labeltexte neben den Controls: dort sind <span class="set-label"> …</span>
    replTextIn('.set-label','Sprache','set.lang');
    replTextIn('.set-label','Farbton','set.hue');
    text('#btnUserPrefs','set.userprefs'); text('#btnChannel','set.channel'); text('#btnLog','set.log'); text('#btnCats','set.cats'); text('#btnRates','set.rates'); text('#btnHelp','set.help');
    text('#btnSaveSettings','set.save');
    text('.set-sys h4.section','sysinfo');

    // Rates
    text('#modalRateEdit header h3','modal.rate.edit');
    text('#modalRateCreate header h3','modal.rate.create');
    setLabelByInputId('crCode','lab.ratecode',lang);
    setLabelByInputId('crType','lab.ratetype',lang);
    setLabelByInputId('crHotel','lab.ratehotel',lang);
    setLabelByInputId('crName','lab.ratename',lang);
    text('label[for="crCatsWrap"] .set-label','lab.cats'); // falls als label-for gesetzt
    setLabelByInputId('crPolicy','lab.policy',lang);
    setLabelByInputId('crPrice','lab.price',lang);
    setLabelByInputId('crMapped','lab.mapped',lang);
    text('#btnRateCreate','btn.rate.create');
    // Edit
    setLabelByInputId('erHotel','lab.ratehotel',lang);
    setLabelByInputId('erCode','lab.ratecode',lang);
    setLabelByInputId('erType','lab.ratetype',lang);
    setLabelByInputId('erName','lab.ratename',lang);
    setLabelByInputId('erPolicy','lab.policy',lang);
    setLabelByInputId('erPrice','lab.price',lang);
    setLabelByInputId('erMapped','lab.mapped',lang);
    text('#btnRateUpdate','btn.rate.update'); text('#btnRateDelete','btn.rate.delete');

    // Categories
    text('#modalCats header h3','modal.cats');
    text('.cats-wrap .box h4.mono','cats.new');
    setLabelByInputId('catsHotel','lab.hotel',lang);
    ph('#catsSearch','ph.cats.search');
    setLabelByInputId('catCodeNew','lab.cat.code',lang);
    setLabelByInputId('catMaxNew','lab.cat.max',lang);
    setLabelByInputId('catNameNew','lab.cat.name',lang);

    // Channel
    text('#modalChannel header h3','modal.channel');
    text('.channel-tab[data-channel-tab="api"]','tab.api');
    text('.channel-tab[data-channel-tab="property"]','tab.prop');
    text('.channel-tab[data-channel-tab="monitor"]','tab.monitor');
    text('.channel-tab[data-channel-tab="system"]','tab.system');
    text('.channel-tab[data-channel-tab="admin"]','tab.admin');
    text('#btnSyncNow','btn.sync');

    // Log
    text('#modalLog header h3','modal.log');
    ph('#logSearch','log.ph.search');
    const optAll = document.querySelector('#logType option[value=""]'); if (optAll) optAll.textContent = tr('log.type.all',lang);
    th('#logTable thead th', ['log.th.time','log.th.user','log.th.type','log.th.action','log.th.details']);
    text('#logPrev','pager.prev'); text('#logNext','pager.next');
    const lpi = document.getElementById('logPageInfo'); if (lpi) {
      lpi.textContent = lpi.textContent
        .replace(/Seite|Page/, tr('pager.page',lang))
        .replace(/Einträge|entries/, tr('pager.entries',lang));
    }
  }

  // --- kleine DOM-Utils ---
  function el(sel){ return document.querySelector(sel); }
  function text(sel,key){ const e = el(sel); if (e) e.textContent = tr(key, getLang()); }
  function ph(sel,key){ const e = el(sel); if (e) e.setAttribute('placeholder', tr(key, getLang())); }
  function th(sel, keys){
    const row = el(sel);
    if (!row) { // if sel points to the first TH, try its parent row
      const heads = document.querySelectorAll(sel);
      if (heads && heads.length) heads.forEach((thEl,i)=> thEl.textContent = tr(keys[i], getLang()));
      return;
    }
    const list = document.querySelectorAll(sel);
    list.forEach((thEl,i)=> thEl.textContent = tr(keys[i], getLang()));
  }
  function replTextIn(selector, contains, key){
    document.querySelectorAll(selector).forEach(el=>{
      if ((el.textContent||'').includes(contains)) el.textContent = tr(key, getLang());
    });
  }

  // --- Sprache speichern/lesen ---
  function getLang(){ return localStorage.getItem(LS_KEY) || 'de'; }
  function setLang(v){ localStorage.setItem(LS_KEY, v); }

  // --- Re-apply bei dynamischen Änderungen (Modale, Tabs, Table reload) ---
  let mo;
  function observeMutations(){
    if (mo) return;
    mo = new MutationObserver(()=> applyI18n(getLang()));
    mo.observe(document.body, {subtree:true, childList:true, attributes:true, attributeFilter:['aria-hidden','class']});
  }

  // --- Init ---
  function init(){
    applyI18n(getLang());
    const sel = document.getElementById('selLang');
    if (sel && !sel.__i18nBound){
      sel.__i18nBound = true;
      sel.addEventListener('change', e=>{
        const v = e.target.value === 'en' ? 'en' : 'de';
        setLang(v);
        applyI18n(v);
      });
    }
    observeMutations();
  }

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();

  // optional öffentlich
  window.resToolI18n = {apply:lang=>applyI18n(lang), getLang, setLang};
})();
</script>

</body>
</html>
