<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>res-tool ‚Äì Dashboard</title>
  
  <!-- Inline Favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüè®%3C/text%3E%3C/svg%3E">

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

</head>

<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="res-tool brand">
      <div class="logo" aria-hidden="true"></div>
      <h1 class="mono"><span>res</span>-tool<span class="cursor">_</span></h1>
    </div>

    <nav class="toolbar" aria-label="Aktionen">
      <div class="toolbar-left">
        <button class="btn primary" id="btnNew" data-modal="#modalNew">Neue Reservierung</button>
        <button class="btn ghost" id="btnAvail" data-modal="#modalAvail">Verf√ºgbarkeit</button>
        <button class="btn ghost" id="btnReporting" data-modal="#modalReporting">Reporting</button>
        <button class="btn ghost" id="btnSettings" data-modal="#modalSettings">Einstellungen</button>
        <button class="btn ghost" id="btnSketch" data-modal="#modalSketch">Hotelskizze</button>
        <button class="btn ghost" id="btnGroups" data-modal="#modalGroups">Gruppen Resa</button>
      </div>

      <div class="toolbar-right mono">
        <div id="statusChips">
          <span class="pill" id="chipSb" title="Supabase">SB</span>
          <span class="pill" id="chipHns" title="HotelNetSolutions">HNS</span>
          <span class="mono muted" id="authUserInline" style="margin-right:8px;"></span>
        </div>
        <div class="clock">
          <span id="dateLocal">--.--.----</span>
          <span class="sep">¬∑</span>
          <span id="clockLocal">--:--:--</span>
        </div>
      </div>
    </nav>
  </header>

  <main class="main-content" aria-label="Hauptinhalt" id="mainContent">

    <!-- Mini-Analytics in der rechten oberen Ecke -->
    <aside class="analytics-dash" id="miniAnalyticsContainer" role="complementary" aria-label="Live-Statistiken">
      <div class="stat">
        <div class="value mono" id="statBookings">---</div>
        <div class="label">Buchungen</div>
      </div>
      <div class="stat">
        <div class="value mono" id="statCancels">---</div>
        <div class="label">Stornos</div>
      </div>
      <div class="stat">
        <div class="value mono" id="statRevenue">‚Ç¨---</div>
        <div class="label">Umsatz</div>
      </div>
    </aside>

    <!-- Suchleiste mit Filtern -->
    <section class="section-bar" aria-label="Suche und Filter">
      <div class="search-group">
        <div class="search-bar">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="9" r="7"></circle>
            <path d="M14 14l3.5 3.5"></path>
          </svg>
          <input type="search" id="searchInput" placeholder="Suchen..." aria-label="Reservierungen suchen" />
          
          <div class="filter-row">
            <button class="filter-item active" data-filter="all">Alle</button>
            <button class="filter-item" data-filter="confirmations">Unbest√§tigt</button>
            <button class="filter-item" data-filter="actions">Aktion erforderlich</button>
            
            <select id="hotelSelect" class="filter-select" aria-label="Hotel ausw√§hlen">
              <option value="">Alle Hotels</option>
            </select>
            
            <select id="sourceSelect" class="filter-select" aria-label="Quelle ausw√§hlen">
              <option value="">Alle Quellen</option>
              <option value="HNS">HotelNetSolutions</option>
              <option value="SB">Supabase</option>
              <option value="PMS">PMS direkt</option>
            </select>
            
            <select id="statusSelect" class="filter-select" aria-label="Status ausw√§hlen">
              <option value="">Alle Stati</option>
              <option value="confirmed">Best√§tigt</option>
              <option value="pending">Ausstehend</option>
              <option value="cancelled">Storniert</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <!-- Datentabelle -->
    <section class="section-table" aria-label="Reservierungstabelle">
      <div class="table-wrap" id="tableContainer">
        <table class="table" id="resTable" role="table">
          <thead>
            <tr>
              <th><input type="checkbox" id="selectAll" aria-label="Alle ausw√§hlen" /></th>
              <th data-column="resNumber" class="sortable">Res. #<span class="sort-indicator"></span></th>
              <th data-column="guest" class="sortable">Gast<span class="sort-indicator"></span></th>
              <th data-column="checkin" class="sortable">Check-in<span class="sort-indicator"></span></th>
              <th data-column="checkout" class="sortable">Check-out<span class="sort-indicator"></span></th>
              <th data-column="nights" class="sortable">N√§chte<span class="sort-indicator"></span></th>
              <th data-column="hotel" class="sortable">Hotel<span class="sort-indicator"></span></th>
              <th data-column="room" class="sortable">Zimmer<span class="sort-indicator"></span></th>
              <th data-column="rate" class="sortable">Tarif<span class="sort-indicator"></span></th>
              <th data-column="total" class="sortable">Gesamt ‚Ç¨<span class="sort-indicator"></span></th>
              <th data-column="status" class="sortable">Status<span class="sort-indicator"></span></th>
              <th data-column="source">Quelle</th>
              <th data-column="actions">Aktionen</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Zeilen werden dynamisch via JS geladen -->
          </tbody>
        </table>
        
        <div class="table-loading" id="loadingIndicator" aria-live="polite">
          <div class="spinner">
            <div></div><div></div><div></div>
          </div>
          <p>Reservierungen werden geladen...</p>
        </div>
      </div>
    </section>

    <!-- Pagination -->
    <nav class="pagination" id="paginationContainer" aria-label="Seitennavigation"></nav>

  </main>

  <!-- MODALE -->

  <!-- 1. Neue Reservierung Modal -->
  <div class="modal" id="modalNew" role="dialog" aria-labelledby="modalNewTitle" aria-hidden="true">
    <div class="modal-content large">
      <div class="modal-head">
        <h3 id="modalNewTitle">Neue Reservierung</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        
        <!-- Tab Navigation -->
        <div class="tabs">
          <button class="tab-button active" data-tab="tab-guest">Gast</button>
          <button class="tab-button" data-tab="tab-booking">Buchung</button>
          <button class="tab-button" data-tab="tab-payment">Zahlung</button>
          <button class="tab-button" data-tab="tab-notes">Notizen</button>
        </div>
        
        <!-- Tab Contents -->
        <form id="formNewReservation" novalidate>
          
          <!-- Tab 1: Gast -->
          <div class="tab-content active" id="tab-guest">
            <div class="form-grid">
              <div class="form-group">
                <label for="guestFirstName">Vorname *</label>
                <input type="text" id="guestFirstName" name="guestFirstName" required />
              </div>
              <div class="form-group">
                <label for="guestLastName">Nachname *</label>
                <input type="text" id="guestLastName" name="guestLastName" required />
              </div>
              <div class="form-group">
                <label for="guestEmail">E-Mail *</label>
                <input type="email" id="guestEmail" name="guestEmail" required />
              </div>
              <div class="form-group">
                <label for="guestPhone">Telefon</label>
                <input type="tel" id="guestPhone" name="guestPhone" />
              </div>
            </div>
          </div>
          
          <!-- Tab 2: Buchung -->
          <div class="tab-content" id="tab-booking">
            <div class="form-grid">
              <div class="form-group">
                <label for="hotelId">Hotel *</label>
                <select id="hotelId" name="hotelId" required>
                  <option value="">Bitte w√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label for="checkinDate">Check-in *</label>
                <input type="date" id="checkinDate" name="checkinDate" required />
              </div>
              <div class="form-group">
                <label for="checkoutDate">Check-out *</label>
                <input type="date" id="checkoutDate" name="checkoutDate" required />
              </div>
            </div>
          </div>
          
          <!-- Tab 3: Zahlung -->
          <div class="tab-content" id="tab-payment">
            <div class="form-grid">
              <div class="form-group">
                <label for="ratePerNight">Rate pro Nacht (‚Ç¨) *</label>
                <input type="number" id="ratePerNight" name="ratePerNight" min="0" step="0.01" required />
              </div>
              <div class="form-group">
                <label for="totalAmount">Gesamtbetrag (‚Ç¨)</label>
                <input type="number" id="totalAmount" name="totalAmount" min="0" step="0.01" readonly />
              </div>
            </div>
          </div>
          
          <!-- Tab 4: Notizen -->
          <div class="tab-content" id="tab-notes">
            <div class="form-grid">
              <div class="form-group full-width">
                <label for="specialRequests">Sonderw√ºnsche</label>
                <textarea id="specialRequests" name="specialRequests" rows="4"></textarea>
              </div>
            </div>
          </div>
          
        </form>
      </div>
      <div class="modal-foot">
        <button type="button" class="btn secondary" data-dismiss="modal">Abbrechen</button>
        <button type="submit" form="formNewReservation" class="btn primary">Reservierung erstellen</button>
      </div>
    </div>
  </div>

  <!-- 2. Verf√ºgbarkeit Modal -->
  <div class="modal" id="modalAvail" role="dialog" aria-labelledby="modalAvailTitle" aria-hidden="true">
    <div class="modal-content large">
      <div class="modal-head">
        <h3 id="modalAvailTitle">Verf√ºgbarkeit pr√ºfen</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        <p>Verf√ºgbarkeitspr√ºfung - Coming Soon</p>
      </div>
    </div>
  </div>

  <!-- 3. Reporting Modal -->
  <div class="modal" id="modalReporting" role="dialog" aria-labelledby="modalReportingTitle" aria-hidden="true">
    <div class="modal-content xlarge">
      <div class="modal-head">
        <h3 id="modalReportingTitle">Reporting & Analytics</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        <div class="chart-container">
          <canvas id="reportChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- 4. Settings Modal -->
  <div class="modal" id="modalSettings" role="dialog" aria-labelledby="modalSettingsTitle" aria-hidden="true">
    <div class="modal-content medium">
      <div class="modal-head">
        <h3 id="modalSettingsTitle">Einstellungen</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        <p>Einstellungen - Coming Soon</p>
      </div>
    </div>
  </div>

  <!-- 5. Hotel Sketch Modal -->
  <div class="modal" id="modalSketch" role="dialog" aria-labelledby="modalSketchTitle" aria-hidden="true">
    <div class="modal-content xlarge">
      <div class="modal-head">
        <h3 id="modalSketchTitle">Hotel Grundriss</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        <p>Hotel Grundriss - Coming Soon</p>
      </div>
    </div>
  </div>

  <!-- 6. Groups Modal -->
  <div class="modal" id="modalGroups" role="dialog" aria-labelledby="modalGroupsTitle" aria-hidden="true">
    <div class="modal-content xlarge">
      <div class="modal-head">
        <h3 id="modalGroupsTitle">Gruppenreservierung</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        <p>Gruppenreservierung - Coming Soon</p>
      </div>
    </div>
  </div>

  <!-- Analytics Dock (rechts unten) -->
  <aside class="analytics-dock" id="miniAnalyticsDockContainer" role="complementary" aria-label="Mini-Analytics">
    <div class="dock-head">
      <h4 class="mono">Booking / Day (YoY)</h4>
      <button id="dockToggle" class="btn sm ghost" type="button" aria-expanded="true">‚Äî</button>
    </div>
    <div id="miniAnalyticsDock" class="dock-list">
      <!-- Wird via JS gef√ºllt -->
    </div>
  </aside>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <!-- SCRIPTS -->
  
  <!-- External Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.5/dist/umd/supabase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  
  <!-- App Scripts (alle im Root) -->
  <script src="supabase.js"></script>
  <script src="eventBus.js"></script>
  <script src="auth.js"></script>
  <script src="hotels.js"></script>
  <script src="reservations.js"></script>
  <script src="formatters.js"></script>
  <script src="modal.js"></script>
  <script src="toast.js"></script>
  <script src="toast-system.js"></script>
  <script src="tableManager.js"></script>
  
  <!-- Main App (muss als letztes geladen werden) -->
  <script src="app.js"></script>

</body>
</html>
