<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>res-tool ‚Äì Dashboard</title>
  
  <!-- Inline Favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüè®%3C/text%3E%3C/svg%3E">

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">

  
  <!-- Styles (V1.5 - Best of Both Worlds) -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- Toast System (defer for DOM-ready) -->
  <script src="./toast-system.js" defer></script>

</head>

<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="res-tool brand">
      <div class="logo" aria-hidden="true"></div>
      <h1 class="mono"><span>res</span>-tool<span class="cursor">_</span></h1>
    </div>

    <nav class="toolbar" aria-label="Aktionen">
      <div class="toolbar-left">
        <button class="btn primary" id="btnNew"        data-modal="#modalNew">Neue Reservierung</button>
        <button class="btn ghost"   id="btnAvail"      data-modal="#modalAvail">Verf√ºgbarkeit</button>
        <button class="btn ghost"   id="btnReporting"  data-modal="#modalReporting">Reporting</button>
        <button class="btn ghost"   id="btnSettings"   data-modal="#modalSettings">Einstellungen</button>
        <button class="btn ghost"   id="btnSketch"     data-modal="#modalSketch">Hotelskizze</button>
        <button class="btn ghost" id="btnGroups" data-modal="#modalGroups">Gruppen Resa</button>
      </div>

      <div class="toolbar-right mono">
        <div id="statusChips">
          <span class="pill" id="chipSb"  title="Supabase">SB</span>
          <span class="pill" id="chipHns" title="HotelNetSolutions">HNS</span>
          <span class="mono muted" id="authUserInline" style="margin-right:8px;"></span>
        </div>
        <div class="clock">
          <span id="dateLocal">--.--.----</span>
          <span class="sep">¬∑</span>
          <span id="clockLocal">--:--:--</span>
        </div>
      </div>
    </nav>
  </header>

  <main class="main-content" aria-label="Hauptinhalt" id="mainContent">

    <!-- ============ Mini-Analytics in separate <aside> in der rechten oberen Ecke -->
    <aside class="analytics-dash" id="miniAnalyticsContainer" role="complementary" aria-label="Live-Statistiken">
      <div class="stat">
        <div class="value mono" id="statBookings">---</div>
        <div class="label">Buchungen</div>
      </div>
      <div class="stat">
        <div class="value mono" id="statCancels">---</div>
        <div class="label">Stornos</div>
      </div>
      <div class="stat">
        <div class="value mono" id="statRevenue">‚Ç¨---</div>
        <div class="label">Umsatz</div>
      </div>
    </aside>

    <!-- ============ Suchleiste mit Filtern (jetzt mit funktionalen Dummy-Elementen) -->
    <section class="section-bar" aria-label="Suche und Filter">
      <div class="search-group">
        <div class="search-bar">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="9" r="7"></circle>
            <path d="M14 14l3.5 3.5"></path>
          </svg>
          <input type="search" id="searchInput" placeholder="Suchen..." aria-label="Reservierungen suchen" />
          
          <div class="filter-row">
            <button class="filter-item active" data-filter="all">Alle</button>
            <button class="filter-item" data-filter="confirmations">Unbest√§tigt</button>
            <button class="filter-item" data-filter="actions">Aktion erforderlich</button>
            
            <select id="hotelSelect" class="filter-select" aria-label="Hotel ausw√§hlen">
              <option value="">Alle Hotels</option>
            </select>
            
            <select id="sourceSelect" class="filter-select" aria-label="Quelle ausw√§hlen">
              <option value="">Alle Quellen</option>
              <option value="HNS">HotelNetSolutions</option>
              <option value="SB">Supabase</option>
              <option value="PMS">PMS direkt</option>
            </select>
            
            <select id="statusSelect" class="filter-select" aria-label="Status ausw√§hlen">
              <option value="">Alle Stati</option>
              <option value="confirmed">Best√§tigt</option>
              <option value="pending">Ausstehend</option>
              <option value="cancelled">Storniert</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <!-- ============ Datentabelle (√ºbernommen aus V1) -->
    <section class="section-table" aria-label="Reservierungstabelle">
      <div class="table-wrap" id="tableContainer">
        <table class="table" id="resTable" role="table">
          <thead>
            <tr>
              <th><input type="checkbox" id="selectAll" aria-label="Alle ausw√§hlen" /></th>
              <th data-column="resNumber" class="sortable">Res. #<span class="sort-indicator"></span></th>
              <th data-column="guest" class="sortable">Gast<span class="sort-indicator"></span></th>
              <th data-column="checkin" class="sortable">Check-in<span class="sort-indicator"></span></th>
              <th data-column="checkout" class="sortable">Check-out<span class="sort-indicator"></span></th>
              <th data-column="nights" class="sortable">N√§chte<span class="sort-indicator"></span></th>
              <th data-column="hotel" class="sortable">Hotel<span class="sort-indicator"></span></th>
              <th data-column="room" class="sortable">Zimmer<span class="sort-indicator"></span></th>
              <th data-column="rate" class="sortable">Tarif<span class="sort-indicator"></span></th>
              <th data-column="total" class="sortable">Gesamt ‚Ç¨<span class="sort-indicator"></span></th>
              <th data-column="status" class="sortable">Status<span class="sort-indicator"></span></th>
              <th data-column="source">Quelle</th>
              <th data-column="actions">Aktionen</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- Zeilen werden dynamisch via JS geladen -->
          </tbody>
        </table>
        
        <div class="table-loading" id="loadingIndicator" aria-live="polite">
          <div class="spinner">
            <div></div><div></div><div></div>
          </div>
          <p>Reservierungen werden geladen...</p>
        </div>
      </div>
    </section>

    <!-- Pagination wird hier eingef√ºgt -->
    <nav class="pagination" id="paginationContainer" aria-label="Seitennavigation"></nav>

  </main>

  <!-- =============== MODALE (V1.5 Kombi) =============== -->

  <!-- 1. Neue Reservierung Modal (erweitert mit Tabs) -->
  <div class="modal" id="modalNew" role="dialog" aria-labelledby="modalNewTitle" aria-hidden="true">
    <div class="modal-content large">
      <div class="modal-head">
        <h3 id="modalNewTitle">Neue Reservierung</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        
        <!-- Tab Navigation -->
        <div class="tabs">
          <button class="tab-button active" data-tab="tab-guest">Gast</button>
          <button class="tab-button" data-tab="tab-booking">Buchung</button>
          <button class="tab-button" data-tab="tab-payment">Zahlung</button>
          <button class="tab-button" data-tab="tab-notes">Notizen</button>
        </div>
        
        <!-- Tab Contents -->
        <form id="formNewReservation" novalidate>
          
          <!-- Tab 1: Gast -->
          <div class="tab-content active" id="tab-guest">
            <div class="form-grid">
              <div class="form-group">
                <label for="guestFirstName">Vorname *</label>
                <input type="text" id="guestFirstName" name="guestFirstName" required />
              </div>
              <div class="form-group">
                <label for="guestLastName">Nachname *</label>
                <input type="text" id="guestLastName" name="guestLastName" required />
              </div>
              <div class="form-group">
                <label for="guestEmail">E-Mail *</label>
                <input type="email" id="guestEmail" name="guestEmail" required />
              </div>
              <div class="form-group">
                <label for="guestPhone">Telefon</label>
                <input type="tel" id="guestPhone" name="guestPhone" />
              </div>
              <div class="form-group">
                <label for="guestCountry">Land</label>
                <select id="guestCountry" name="guestCountry">
                  <option value="">Bitte w√§hlen</option>
                  <option value="DE">Deutschland</option>
                  <option value="AT">√ñsterreich</option>
                  <option value="CH">Schweiz</option>
                  <option value="FR">Frankreich</option>
                  <option value="IT">Italien</option>
                  <option value="ES">Spanien</option>
                  <option value="UK">Gro√übritannien</option>
                  <option value="US">USA</option>
                  <option value="OTHER">Andere</option>
                </select>
              </div>
              <div class="form-group">
                <label for="guestLanguage">Sprache</label>
                <select id="guestLanguage" name="guestLanguage">
                  <option value="de">Deutsch</option>
                  <option value="en">English</option>
                  <option value="fr">Fran√ßais</option>
                  <option value="it">Italiano</option>
                  <option value="es">Espa√±ol</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Tab 2: Buchung -->
          <div class="tab-content" id="tab-booking">
            <div class="form-grid">
              <div class="form-group">
                <label for="hotelId">Hotel *</label>
                <select id="hotelId" name="hotelId" required>
                  <option value="">Bitte w√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label for="roomType">Zimmertyp *</label>
                <select id="roomType" name="roomType" required>
                  <option value="">Bitte w√§hlen</option>
                  <option value="STD">Standard</option>
                  <option value="SUP">Superior</option>
                  <option value="DLX">Deluxe</option>
                  <option value="SUI">Suite</option>
                  <option value="JSU">Junior Suite</option>
                </select>
              </div>
              <div class="form-group">
                <label for="checkinDate">Check-in *</label>
                <input type="date" id="checkinDate" name="checkinDate" required />
              </div>
              <div class="form-group">
                <label for="checkoutDate">Check-out *</label>
                <input type="date" id="checkoutDate" name="checkoutDate" required />
              </div>
              <div class="form-group">
                <label for="adults">Erwachsene *</label>
                <input type="number" id="adults" name="adults" min="1" value="2" required />
              </div>
              <div class="form-group">
                <label for="children">Kinder</label>
                <input type="number" id="children" name="children" min="0" value="0" />
              </div>
              <div class="form-group">
                <label for="rateCode">Tarif-Code</label>
                <select id="rateCode" name="rateCode">
                  <option value="BAR">Best Available Rate</option>
                  <option value="CORP">Corporate</option>
                  <option value="PKG">Package</option>
                  <option value="PROMO">Promotion</option>
                </select>
              </div>
              <div class="form-group">
                <label for="mealPlan">Verpflegung</label>
                <select id="mealPlan" name="mealPlan">
                  <option value="RO">Ohne Verpflegung</option>
                  <option value="BB">Fr√ºhst√ºck</option>
                  <option value="HB">Halbpension</option>
                  <option value="FB">Vollpension</option>
                  <option value="AI">All Inclusive</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Tab 3: Zahlung -->
          <div class="tab-content" id="tab-payment">
            <div class="form-grid">
              <div class="form-group">
                <label for="ratePerNight">Rate pro Nacht (‚Ç¨) *</label>
                <input type="number" id="ratePerNight" name="ratePerNight" min="0" step="0.01" required />
              </div>
              <div class="form-group">
                <label for="totalAmount">Gesamtbetrag (‚Ç¨)</label>
                <input type="number" id="totalAmount" name="totalAmount" min="0" step="0.01" readonly />
              </div>
              <div class="form-group">
                <label for="paymentMethod">Zahlungsmethode</label>
                <select id="paymentMethod" name="paymentMethod">
                  <option value="">Bitte w√§hlen</option>
                  <option value="CARD">Kreditkarte</option>
                  <option value="BANK">Bank√ºberweisung</option>
                  <option value="CASH">Bar</option>
                  <option value="INVOICE">Rechnung</option>
                </select>
              </div>
              <div class="form-group">
                <label for="paymentStatus">Zahlungsstatus</label>
                <select id="paymentStatus" name="paymentStatus">
                  <option value="pending">Ausstehend</option>
                  <option value="partial">Teilweise bezahlt</option>
                  <option value="paid">Bezahlt</option>
                  <option value="refunded">Erstattet</option>
                </select>
              </div>
              <div class="form-group">
                <label for="depositAmount">Anzahlung (‚Ç¨)</label>
                <input type="number" id="depositAmount" name="depositAmount" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="depositDue">Anzahlung f√§llig</label>
                <input type="date" id="depositDue" name="depositDue" />
              </div>
            </div>
          </div>
          
          <!-- Tab 4: Notizen -->
          <div class="tab-content" id="tab-notes">
            <div class="form-grid">
              <div class="form-group full-width">
                <label for="specialRequests">Sonderw√ºnsche</label>
                <textarea id="specialRequests" name="specialRequests" rows="4" placeholder="z.B. Allergien, Zimmerpr√§ferenzen, etc."></textarea>
              </div>
              <div class="form-group full-width">
                <label for="internalNotes">Interne Notizen</label>
                <textarea id="internalNotes" name="internalNotes" rows="4" placeholder="Nur f√ºr interne Verwendung"></textarea>
              </div>
              <div class="form-group">
                <label for="bookingSource">Buchungsquelle</label>
                <select id="bookingSource" name="bookingSource">
                  <option value="direct">Direkt</option>
                  <option value="booking">Booking.com</option>
                  <option value="expedia">Expedia</option>
                  <option value="hrs">HRS</option>
                  <option value="phone">Telefon</option>
                  <option value="email">E-Mail</option>
                  <option value="walkin">Walk-In</option>
                </select>
              </div>
              <div class="form-group">
                <label for="confirmationSent">
                  <input type="checkbox" id="confirmationSent" name="confirmationSent" />
                  Best√§tigung gesendet
                </label>
              </div>
            </div>
          </div>
          
        </form>
      </div>
      <div class="modal-foot">
        <button type="button" class="btn secondary" data-dismiss="modal">Abbrechen</button>
        <button type="submit" form="formNewReservation" class="btn primary">Reservierung erstellen</button>
      </div>
    </div>
  </div>

  <!-- 2. Verf√ºgbarkeit Modal -->
  <div class="modal" id="modalAvail" role="dialog" aria-labelledby="modalAvailTitle" aria-hidden="true">
    <div class="modal-content large">
      <div class="modal-head">
        <h3 id="modalAvailTitle">Verf√ºgbarkeit pr√ºfen</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        <div class="avail-filters">
          <div class="form-grid">
            <div class="form-group">
              <label for="availHotel">Hotel</label>
              <select id="availHotel">
                <option value="">Alle Hotels</option>
              </select>
            </div>
            <div class="form-group">
              <label for="availStart">Von</label>
              <input type="date" id="availStart" />
            </div>
            <div class="form-group">
              <label for="availEnd">Bis</label>
              <input type="date" id="availEnd" />
            </div>
            <button type="button" class="btn primary" id="btnCheckAvail">Verf√ºgbarkeit pr√ºfen</button>
          </div>
        </div>
        
        <div class="avail-results" id="availResults">
          <!-- Dynamisch gef√ºllte Verf√ºgbarkeitsmatrix -->
          <div class="loading-state">
            <p class="muted">W√§hlen Sie Datum und Hotel aus, um die Verf√ºgbarkeit zu pr√ºfen.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 3. Reporting Modal -->
  <div class="modal" id="modalReporting" role="dialog" aria-labelledby="modalReportingTitle" aria-hidden="true">
    <div class="modal-content xlarge">
      <div class="modal-head">
        <h3 id="modalReportingTitle">Reporting & Analytics</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        
        <!-- Report Filters -->
        <div class="report-filters">
          <div class="form-grid">
            <div class="form-group">
              <label for="reportType">Report-Typ</label>
              <select id="reportType">
                <option value="occupancy">Auslastung</option>
                <option value="revenue">Umsatz</option>
                <option value="source">Buchungsquellen</option>
                <option value="forecast">Forecast</option>
                <option value="cancellation">Stornierungen</option>
              </select>
            </div>
            <div class="form-group">
              <label for="reportPeriod">Zeitraum</label>
              <select id="reportPeriod">
                <option value="today">Heute</option>
                <option value="week">Diese Woche</option>
                <option value="month">Dieser Monat</option>
                <option value="quarter">Dieses Quartal</option>
                <option value="year">Dieses Jahr</option>
                <option value="custom">Benutzerdefiniert</option>
              </select>
            </div>
            <div class="form-group">
              <label for="reportHotel">Hotel</label>
              <select id="reportHotel">
                <option value="">Alle Hotels</option>
              </select>
            </div>
            <button type="button" class="btn primary" id="btnGenerateReport">Report generieren</button>
            <button type="button" class="btn ghost" id="btnExportReport">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 14V3M10 14L6 10M10 14L14 10M3 17H17"></path>
              </svg>
              Export
            </button>
          </div>
        </div>
        
        <!-- Chart Container -->
        <div class="chart-container">
          <canvas id="reportChart"></canvas>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid" id="reportStats">
          <!-- Wird dynamisch gef√ºllt -->
        </div>
        
      </div>
    </div>
  </div>

  <!-- 4. Settings Modal -->
  <div class="modal" id="modalSettings" role="dialog" aria-labelledby="modalSettingsTitle" aria-hidden="true">
    <div class="modal-content medium">
      <div class="modal-head">
        <h3 id="modalSettingsTitle">Einstellungen</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        
        <!-- Settings Tabs -->
        <div class="tabs">
          <button class="tab-button active" data-tab="settings-general">Allgemein</button>
          <button class="tab-button" data-tab="settings-hotels">Hotels</button>
          <button class="tab-button" data-tab="settings-api">API & Integration</button>
          <button class="tab-button" data-tab="settings-users">Benutzer</button>
        </div>
        
        <!-- Settings Tab Contents -->
        <div class="settings-content">
          
          <!-- General Settings -->
          <div class="tab-content active" id="settings-general">
            <div class="setting-group">
              <h4>Anzeigeoptionen</h4>
              <label class="switch-label">
                <input type="checkbox" id="darkMode" checked />
                <span>Dark Mode</span>
              </label>
              <label class="switch-label">
                <input type="checkbox" id="compactView" />
                <span>Kompakte Ansicht</span>
              </label>
              <label class="switch-label">
                <input type="checkbox" id="showAnalytics" checked />
                <span>Live-Statistiken anzeigen</span>
              </label>
            </div>
            
            <div class="setting-group">
              <h4>Benachrichtigungen</h4>
              <label class="switch-label">
                <input type="checkbox" id="notifyNewBooking" checked />
                <span>Neue Buchungen</span>
              </label>
              <label class="switch-label">
                <input type="checkbox" id="notifyCancellation" checked />
                <span>Stornierungen</span>
              </label>
              <label class="switch-label">
                <input type="checkbox" id="notifyModification" />
                <span>√Ñnderungen</span>
              </label>
            </div>
            
            <div class="setting-group">
              <h4>Sprache & Region</h4>
              <div class="form-group">
                <label for="language">Sprache</label>
                <select id="language">
                  <option value="de">Deutsch</option>
                  <option value="en">English</option>
                </select>
              </div>
              <div class="form-group">
                <label for="timezone">Zeitzone</label>
                <select id="timezone">
                  <option value="Europe/Berlin">Berlin (UTC+1)</option>
                  <option value="Europe/Vienna">Wien (UTC+1)</option>
                  <option value="Europe/Zurich">Z√ºrich (UTC+1)</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Hotels Settings -->
          <div class="tab-content" id="settings-hotels">
            <div class="hotels-list" id="hotelsList">
              <!-- Wird dynamisch gef√ºllt -->
            </div>
            <button type="button" class="btn primary" id="btnAddHotel">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 5V15M5 10H15"></path>
              </svg>
              Hotel hinzuf√ºgen
            </button>
          </div>
          
          <!-- API Settings -->
          <div class="tab-content" id="settings-api">
            <div class="api-status">
              <h4>Verbindungsstatus</h4>
              <div class="status-grid">
                <div class="status-item">
                  <span class="status-indicator active"></span>
                  <span>HotelNetSolutions API</span>
                  <span class="mono muted">Verbunden</span>
                </div>
                <div class="status-item">
                  <span class="status-indicator active"></span>
                  <span>Supabase</span>
                  <span class="mono muted">Verbunden</span>
                </div>
                <div class="status-item">
                  <span class="status-indicator inactive"></span>
                  <span>PMS Integration</span>
                  <span class="mono muted">Nicht konfiguriert</span>
                </div>
              </div>
            </div>
            
            <div class="setting-group">
              <h4>API Konfiguration</h4>
              <div class="form-group">
                <label for="apiEndpoint">HNS API Endpoint</label>
                <input type="url" id="apiEndpoint" value="https://api.hotelnetsolutions.com/v2" />
              </div>
              <div class="form-group">
                <label for="apiKey">API Key</label>
                <input type="password" id="apiKey" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              </div>
              <div class="form-group">
                <label for="syncInterval">Sync-Intervall (Minuten)</label>
                <input type="number" id="syncInterval" value="15" min="5" max="60" />
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="btn ghost" id="btnTestConnection">Verbindung testen</button>
              <button type="button" class="btn primary" id="btnSaveApiSettings">Speichern</button>
            </div>
          </div>
          
          <!-- Users Settings -->
          <div class="tab-content" id="settings-users">
            <div class="users-list">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>E-Mail</th>
                    <th>Rolle</th>
                    <th>Status</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
            <button type="button" class="btn primary" id="btnAddUser">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 5V15M5 10H15"></path>
              </svg>
              Benutzer hinzuf√ºgen
            </button>
          </div>
          
        </div>
        
      </div>
    </div>
  </div>

  <!-- 5. Hotel Sketch Modal -->
  <div class="modal" id="modalSketch" role="dialog" aria-labelledby="modalSketchTitle" aria-hidden="true">
    <div class="modal-content xlarge">
      <div class="modal-head">
        <h3 id="modalSketchTitle">Hotel Grundriss & Zimmerbelegung</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        
        <!-- Floor Selector -->
        <div class="floor-selector">
          <button class="btn ghost active" data-floor="1">Etage 1</button>
          <button class="btn ghost" data-floor="2">Etage 2</button>
          <button class="btn ghost" data-floor="3">Etage 3</button>
          <button class="btn ghost" data-floor="4">Etage 4</button>
        </div>
        
        <!-- Floor Plan -->
        <div class="floor-plan" id="floorPlan">
          <!-- Wird dynamisch mit Zimmern gef√ºllt -->
          <div class="room-grid">
            <!-- Beispiel Zimmer (wird durch echte Daten ersetzt) -->
            <div class="room occupied" data-room="101">
              <div class="room-number">101</div>
              <div class="room-status">Belegt</div>
              <div class="room-guest">M. Mustermann</div>
            </div>
            <div class="room available" data-room="102">
              <div class="room-number">102</div>
              <div class="room-status">Frei</div>
            </div>
            <div class="room cleaning" data-room="103">
              <div class="room-number">103</div>
              <div class="room-status">Reinigung</div>
            </div>
            <div class="room maintenance" data-room="104">
              <div class="room-number">104</div>
              <div class="room-status">Wartung</div>
            </div>
          </div>
        </div>
        
        <!-- Legend -->
        <div class="floor-legend">
          <div class="legend-item">
            <span class="legend-color occupied"></span>
            <span>Belegt</span>
          </div>
          <div class="legend-item">
            <span class="legend-color available"></span>
            <span>Verf√ºgbar</span>
          </div>
          <div class="legend-item">
            <span class="legend-color cleaning"></span>
            <span>Reinigung</span>
          </div>
          <div class="legend-item">
            <span class="legend-color maintenance"></span>
            <span>Wartung</span>
          </div>
          <div class="legend-item">
            <span class="legend-color reserved"></span>
            <span>Reserviert</span>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- 6. Groups Reservation Modal -->
  <div class="modal" id="modalGroups" role="dialog" aria-labelledby="modalGroupsTitle" aria-hidden="true">
    <div class="modal-content xlarge">
      <div class="modal-head">
        <h3 id="modalGroupsTitle">Gruppenreservierung</h3>
        <button type="button" class="close" aria-label="Schlie√üen">√ó</button>
      </div>
      <div class="modal-body">
        
        <form id="formGroupReservation">
          <!-- Group Info Section -->
          <div class="section-header">
            <h4>Gruppeninformationen</h4>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="groupName">Gruppenname *</label>
              <input type="text" id="groupName" name="groupName" required />
            </div>
            <div class="form-group">
              <label for="groupSize">Anzahl Personen *</label>
              <input type="number" id="groupSize" name="groupSize" min="10" required />
            </div>
            <div class="form-group">
              <label for="groupContact">Ansprechpartner *</label>
              <input type="text" id="groupContact" name="groupContact" required />
            </div>
            <div class="form-group">
              <label for="groupEmail">E-Mail *</label>
              <input type="email" id="groupEmail" name="groupEmail" required />
            </div>
            <div class="form-group">
              <label for="groupPhone">Telefon *</label>
              <input type="tel" id="groupPhone" name="groupPhone" required />
            </div>
            <div class="form-group">
              <label for="groupType">Gruppentyp</label>
              <select id="groupType" name="groupType">
                <option value="leisure">Freizeit</option>
                <option value="business">Gesch√§ft</option>
                <option value="conference">Konferenz</option>
                <option value="tour">Reisegruppe</option>
                <option value="sports">Sportgruppe</option>
                <option value="school">Schulklasse</option>
                <option value="wedding">Hochzeit</option>
                <option value="other">Sonstige</option>
              </select>
            </div>
          </div>
          
          <!-- Room Allocation Section -->
          <div class="section-header">
            <h4>Zimmerverteilung</h4>
          </div>
          <div class="room-allocation" id="roomAllocation">
            <div class="allocation-row">
              <div class="form-group">
                <label>Einzelzimmer</label>
                <input type="number" id="singleRooms" min="0" value="0" />
              </div>
              <div class="form-group">
                <label>Doppelzimmer</label>
                <input type="number" id="doubleRooms" min="0" value="0" />
              </div>
              <div class="form-group">
                <label>Dreibettzimmer</label>
                <input type="number" id="tripleRooms" min="0" value="0" />
              </div>
              <div class="form-group">
                <label>Suiten</label>
                <input type="number" id="suiteRooms" min="0" value="0" />
              </div>
            </div>
            <div class="allocation-summary">
              <span>Gesamt Zimmer: <strong id="totalRooms">0</strong></span>
              <span>Gesamt Betten: <strong id="totalBeds">0</strong></span>
            </div>
          </div>
          
          <!-- Dates and Rates Section -->
          <div class="section-header">
            <h4>Zeitraum & Preise</h4>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="groupCheckin">Check-in *</label>
              <input type="date" id="groupCheckin" name="groupCheckin" required />
            </div>
            <div class="form-group">
              <label for="groupCheckout">Check-out *</label>
              <input type="date" id="groupCheckout" name="groupCheckout" required />
            </div>
            <div class="form-group">
              <label for="groupRate">Gruppenrate (‚Ç¨/Zimmer) *</label>
              <input type="number" id="groupRate" name="groupRate" min="0" step="0.01" required />
            </div>
            <div class="form-group">
              <label for="groupMealPlan">Verpflegung</label>
              <select id="groupMealPlan" name="groupMealPlan">
                <option value="RO">Ohne Verpflegung</option>
                <option value="BB">Fr√ºhst√ºck</option>
                <option value="HB">Halbpension</option>
                <option value="FB">Vollpension</option>
              </select>
            </div>
          </div>
          
          <!-- Rooming List Section -->
          <div class="section-header">
            <h4>Rooming List</h4>
            <button type="button" class="btn ghost sm" id="btnImportRooming">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 14V3M10 14L6 10M10 14L14 10"></path>
              </svg>
              Import CSV
            </button>
          </div>
          <div class="rooming-list" id="roomingList">
            <table class="table">
              <thead>
                <tr>
                  <th>Zimmer</th>
                  <th>Vorname</th>
                  <th>Nachname</th>
                  <th>Sonderw√ºnsche</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="roomingTableBody">
                <tr>
                  <td><input type="text" placeholder="101" /></td>
                  <td><input type="text" placeholder="Vorname" /></td>
                  <td><input type="text" placeholder="Nachname" /></td>
                  <td><input type="text" placeholder="Notizen" /></td>
                  <td>
                    <button type="button" class="btn ghost sm remove-row">√ó</button>
                  </td>
                </tr>
              </tbody>
            </table>
            <button type="button" class="btn ghost" id="btnAddRoomingRow">
              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 5V15M5 10H15"></path>
              </svg>
              Zeile hinzuf√ºgen
            </button>
          </div>
          
        </form>
        
      </div>
      <div class="modal-foot">
        <button type="button" class="btn secondary" data-dismiss="modal">Abbrechen</button>
        <button type="button" class="btn ghost" id="btnSaveGroupDraft">Als Entwurf speichern</button>
        <button type="submit" form="formGroupReservation" class="btn primary">Gruppe anlegen</button>
      </div>
    </div>
  </div>

  <!-- =============== TOAST CONTAINER =============== -->
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <!-- =============== SCRIPTS =============== -->
  
  <!-- External Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.5/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  
  <!-- Main App -->
  <script src="./app.js"></script>
  
  <!-- Inline Scripts for UI interactions -->
  <script>
    // Tab switching functionality
    document.querySelectorAll('.tabs').forEach(tabContainer => {
      const buttons = tabContainer.querySelectorAll('.tab-button');
      buttons.forEach(button => {
        button.addEventListener('click', () => {
          const tabId = button.getAttribute('data-tab');
          const content = document.getElementById(tabId);
          
          // Remove active from all tabs and contents
          buttons.forEach(b => b.classList.remove('active'));
          tabContainer.parentElement.querySelectorAll('.tab-content').forEach(c => {
            c.classList.remove('active');
          });
          
          // Add active to clicked tab and content
          button.classList.add('active');
          if (content) content.classList.add('active');
        });
      });
    });
    
    // Filter buttons functionality
    document.querySelectorAll('.filter-item').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.filter-item').forEach(b => b.classList.remove('active'));
        button.classList.add('active');
        
        // Trigger filter logic here
        const filter = button.getAttribute('data-filter');
        console.log('Filter applied:', filter);
        // TODO: Implement actual filtering
      });
    });
    
    // Modal functionality
    document.querySelectorAll('[data-modal]').forEach(trigger => {
      trigger.addEventListener('click', () => {
        const modalId = trigger.getAttribute('data-modal');
        const modal = document.querySelector(modalId);
        if (modal) {
          modal.classList.add('show');
          modal.setAttribute('aria-hidden', 'false');
        }
      });
    });
    
    document.querySelectorAll('.modal .close, [data-dismiss="modal"]').forEach(closeBtn => {
      closeBtn.addEventListener('click', () => {
        const modal = closeBtn.closest('.modal');
        if (modal) {
          modal.classList.remove('show');
          modal.setAttribute('aria-hidden', 'true');
        }
      });
    });
    
    // Close modal on outside click
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('show');
          modal.setAttribute('aria-hidden', 'true');
        }
      });
    });
    
    // Calculate total amount when rate or dates change
    const rateInput = document.getElementById('ratePerNight');
    const checkinInput = document.getElementById('checkinDate');
    const checkoutInput = document.getElementById('checkoutDate');
    const totalInput = document.getElementById('totalAmount');
    
    function calculateTotal() {
      if (rateInput && checkinInput && checkoutInput && totalInput) {
        const rate = parseFloat(rateInput.value) || 0;
        const checkin = new Date(checkinInput.value);
        const checkout = new Date(checkoutInput.value);
        
        if (!isNaN(checkin) && !isNaN(checkout) && checkout > checkin) {
          const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));
          const total = rate * nights;
          totalInput.value = total.toFixed(2);
        }
      }
    }
    
    if (rateInput) rateInput.addEventListener('input', calculateTotal);
    if (checkinInput) checkinInput.addEventListener('change', calculateTotal);
    if (checkoutInput) checkoutInput.addEventListener('change', calculateTotal);
    
    // Room allocation calculator for groups
    const roomInputs = document.querySelectorAll('#singleRooms, #doubleRooms, #tripleRooms, #suiteRooms');
    
    function calculateRoomTotals() {
      const single = parseInt(document.getElementById('singleRooms')?.value) || 0;
      const double = parseInt(document.getElementById('doubleRooms')?.value) || 0;
      const triple = parseInt(document.getElementById('tripleRooms')?.value) || 0;
      const suite = parseInt(document.getElementById('suiteRooms')?.value) || 0;
      
      const totalRooms = single + double + triple + suite;
      const totalBeds = (single * 1) + (double * 2) + (triple * 3) + (suite * 2);
      
      const roomsEl = document.getElementById('totalRooms');
      const bedsEl = document.getElementById('totalBeds');
      
      if (roomsEl) roomsEl.textContent = totalRooms;
      if (bedsEl) bedsEl.textContent = totalBeds;
    }
    
    roomInputs.forEach(input => {
      if (input) input.addEventListener('input', calculateRoomTotals);
    });
    
    // Add rooming list row
    const addRowBtn = document.getElementById('btnAddRoomingRow');
    if (addRowBtn) {
      addRowBtn.addEventListener('click', () => {
        const tbody = document.getElementById('roomingTableBody');
        if (tbody) {
          const newRow = document.createElement('tr');
          newRow.innerHTML = `
            <td><input type="text" placeholder="Zimmer" /></td>
            <td><input type="text" placeholder="Vorname" /></td>
            <td><input type="text" placeholder="Nachname" /></td>
            <td><input type="text" placeholder="Notizen" /></td>
            <td>
              <button type="button" class="btn ghost sm remove-row">√ó</button>
            </td>
          `;
          tbody.appendChild(newRow);
          
          // Add remove functionality to new row
          newRow.querySelector('.remove-row')?.addEventListener('click', () => {
            newRow.remove();
          });
        }
      });
    }
    
    // Remove rooming list row
    document.querySelectorAll('.remove-row').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.closest('tr')?.remove();
      });
    });
    
    // Floor selector
    document.querySelectorAll('.floor-selector button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.floor-selector button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const floor = btn.getAttribute('data-floor');
        console.log('Selected floor:', floor);
        // TODO: Load floor data
      });
    });
  </script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const btn = document.getElementById('dockToggle');
  const list = document.getElementById('miniAnalyticsDock');
  if (btn && list) {
    btn.addEventListener('click', () => {
      const hidden = list.style.display === 'none';
      list.style.display = hidden ? '' : 'none';
      btn.setAttribute('aria-expanded', String(hidden));
      btn.textContent = hidden ? '‚Äî' : '+';
    });
  }
});
</script>

 <aside class="analytics-dock" id="miniAnalyticsDockContainer" role="complementary" aria-label="Mini-Analytics">
  <div class="dock-head">
    <h4 class="mono">Booking / Day  (YoY)</h4>
    <button id="dockToggle" class="btn sm ghost" type="button" aria-expanded="true" aria-controls="miniAnalyticsDock">‚Äî</button>
  </div>
  <div id="miniAnalyticsDock" class="dock-list"><!-- wird via JS gef√ºllt --></div>
</aside>


</body>
</html>
