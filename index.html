<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>res-tool â€” Dashboard</title>

  <!-- Preloads -->
  <link rel="preload" as="image" href="/assets/hotel-placeholder.png">
  <link rel="preload" as="image" href="/assets/sketch-placeholder.png">

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">

  
  <!-- Build erwartet /src/styles.css -->
  <link rel="stylesheet" href="/src/styles.css" />
</head>

<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="res-tool brand">
      <div class="logo" aria-hidden="true"></div>
      <h1 class="mono"><span>res</span>-tool<span class="cursor">_</span></h1>
    </div>

    <nav class="toolbar" aria-label="Aktionen">
      <div class="toolbar-left">
        <button class="btn primary" id="btnNew"        data-modal="#modalNew">Neue Reservierung</button>
        <button class="btn ghost"   id="btnAvail"      data-modal="#modalAvail">VerfÃ¼gbarkeit</button>
        <button class="btn ghost"   id="btnReporting"  data-modal="#modalReporting">Reporting</button>
        <button class="btn ghost"   id="btnSettings"   data-modal="#modalSettings">Einstellungen</button>
        <button class="btn ghost"   id="btnSketch"     data-modal="#modalSketch">Hotelskizze</button>
      </div>

      <div class="toolbar-right mono">
        <div id="statusChips">
          <span class="pill" id="chipSb"  title="Supabase">SB</span>
          <span class="pill" id="chipHns" title="HotelNetSolutions">HNS</span>
        </div>
        <div class="clock">
          <span id="dateLocal">--.--.----</span>
          <span class="sep">Â·</span>
          <span id="clockLocal">--:--:--</span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Mini-Charts (YoY) -->
  <aside class="analytics-dock" aria-label="Mini-Charts">
    <div class="dock-head">
      <span class="mono">YoY - Daily</span>
      <button class="btn sm" id="dockToggle" title="Ein-/Ausblenden">â€“</button>
    </div>
    <div id="miniAnalyticsDock" class="dock-list"></div>
  </aside>

  <main class="container" aria-live="polite">
    <!-- KPIs -->
    <section class="grid hero" aria-label="Dashboard Ãœbersicht">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">Performance - Heute</h3>
            <div class="select-wrap">
              <select id="kpiFilterToday" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="tBookings">â€”</div><div class="label">Buchungen (heute eingegangen)</div></div>
            <div class="kpi"><div class="value" id="tRevenue">â€” â‚¬</div><div class="label">Umsatz (heute)</div></div>
            <div class="kpi"><div class="value" id="tADR">â€” â‚¬</div><div class="label">ADR (heute)</div></div>
            <div class="kpi"><div class="value" id="tOcc">â€”%</div><div class="label">Auslastung (heute)</div></div>
          </div>
        </div>
      </article>

      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">Performance - NÃ¤chste 7 Tage</h3>
            <div class="select-wrap">
              <select id="kpiFilterNext" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="nRevenue">â€” â‚¬</div><div class="label">Umsatz (Anreisen +1..+7)</div></div>
            <div class="kpi"><div class="value" id="nADR">â€” â‚¬</div><div class="label">WDR (+1..+7)</div></div>
            <div class="kpi"><div class="value" id="nOcc">â€”%</div><div class="label">Ã˜ Auslastung (+1..+7)</div></div>
          </div>
        </div>
      </article>
    </section>

    <!-- Reservierungen -->
    <section style="margin-top:16px;" aria-label="Reservierungen">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono" style="margin:0">Reservierungen</h3>
            <span></span>
          </div>

          <div class="table-tools">
            <div class="row wrap">
              <input id="searchInput" class="input" placeholder="Gastnameâ€¦" />
              <select id="filterHotel" class="input theme-select" style="width:220px;"></select>
              <select id="filterStatus" class="input theme-select" style="width:170px;">
                <option value="active">Status: Active (Zukunft)</option>
                <option value="done">Status: Done (Vergangenheit)</option>
                <option value="canceled">Status: Canceled</option>
                <option value="all">Status: Alle</option>
              </select>
              <input id="filterResNo" class="input" placeholder="Res.-Nr." style="width:150px;" />
              <input id="filterFrom" type="date" class="input" style="width:170px;" />
              <input id="filterTo"   type="date" class="input" style="width:170px;" />
              <button class="btn" id="btnRefresh">Refresh</button>
            
<button class="btn ghost" id="btnClearFilters" title="Filter zurÃ¼cksetzen">Reset</button>
</div>
          </div>

          <div class="table-wrap">
            <table class="resv" id="resTable">
              <thead>
                <tr>
                  <th>Res.-Nr.</th>
                  <th>Hotel</th>
                  <th>Gastname</th>
                  <th>Anreise</th>
                  <th>Abreise</th>
                  <th>Kategorie</th>
                  <th>Rate</th>
                  <th>Preis</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="resvBody"></tbody>
            </table>
            <div class="pagination">
              <button class="btn" id="prevPage">ZurÃ¼ck</button>
              <span class="muted" id="pageInfo">Seite 1</span>
              <button class="btn" id="nextPage">Weiter</button>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <!-- Quick links -->
  <aside class="quick-links" aria-label="Tracker Shortcuts">
    <a class="btn sm" href="https://noteforms.com/forms/hotel-booking-tracker-c83eba" target="_blank" rel="noopener">Buchungs-Tracker</a>
    <a class="btn sm" href="https://noteforms.com/forms/hotel-call-tracking-form-hw2hqj" target="_blank" rel="noopener">Telefon-Tracker</a>
    <a class="btn sm" href="https://www.notion.so/11a5a3d6427580fbbb4ac3a0dcd1e209?v=35809356ec4245718f85f4a470e066d6" target="_blank" rel="noopener">Handbuch</a>
  </aside>

  <!-- Rate bearbeiten -->
<section class="modal" id="modalRateEdit" role="dialog" aria-labelledby="rateEditTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="rateEditTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Rate bearbeiten</h3>
    <button class="btn" data-close>SchlieÃŸen</button>
  </header>
  <div class="body">
    <div class="grid2">
      <label>Hotel
        <select id="erHotel" class="input theme-select" disabled></select>
      </label>
      <label>Ratecode
        <input id="erCode" class="input" disabled />
      </label>
      <label>Ratentyp
        <select id="erType" class="input theme-select" disabled>
          <option>Direct</option>
          <option>Corp</option>
          <option>IDS</option>
        </select>
      </label>
      <label>Ratename
        <input id="erName" class="input" placeholder="z. B. Flex exkl. FrÃ¼hstÃ¼ck" />
      </label>
      <label style="grid-column:1 / -1">Kategorien
  <div id="erCatsWrap" class="cat-stack"></div>
  <button class="btn sm ghost" id="erAddCatRow" type="button">+ weitere Kategorie</button>
</label>
      <label style="grid-column:1 / -1">Stornobedingung
        <textarea id="erPolicy" class="input" rows="3" placeholder="z. B. Bis zum Anreisetag 18:00 Uhr kostenfrei stornierbar."></textarea>
      </label>
      <label>Preis/Nacht (â‚¬)
        <input id="erPrice" type="number" step="1" min="0" class="input" />
      </label>
      <label>Gemappt
        <select id="erMapped" class="input theme-select">
          <option value="true">ja</option>
          <option value="false">nein</option>
        </select>
      </label>
    </div>

    <div class="set-footer" style="gap:8px; justify-content:flex-end">
      <button class="btn danger" id="btnRateDelete">Rate lÃ¶schen</button>
      <button class="btn primary" id="btnRateUpdate">Ã„nderungen speichern</button>
    </div>

    <p class="muted tiny" style="margin-top:6px">Hotel, Ratecode und Ratentyp sind fix und nicht Ã¤nderbar.</p>
  </div>
</section>

  <!-- Neue Rate anlegen -->
<section class="modal" id="modalRateCreate" role="dialog" aria-labelledby="rateCreateTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="rateCreateTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Neue Rate</h3>
    <button class="btn" data-close>SchlieÃŸen</button>
  </header>
  <div class="body">
    <div class="grid2">
      <label>Ratecode (nur Zahlen)
        <input id="crCode" class="input" inputmode="numeric" pattern="\d+" placeholder="z. B. 100123">
      </label>
      <label>Ratentyp*
        <select id="crType" class="input theme-select">
          <option value="">Bitte wÃ¤hlen</option>
          <option>Direct</option><option>Corp</option><option>IDS</option>
        </select>
      </label>
      <label>Hotel*
        <select id="crHotel" class="input theme-select"></select>
      </label>
      <label>Ratename*
        <input id="crName" class="input" placeholder="z. B. Flex exkl. FrÃ¼hstÃ¼ck">
      </label>
      <label style="grid-column:1 / -1">Kategorien
  <div id="crCatsWrap" class="cat-stack" data-disabled="true"></div>
  <button class="btn sm ghost" id="crAddCatRow" type="button" disabled>+ weitere Kategorie</button>
</label>
      <label style="grid-column:1 / -1">Stornobedingung
        <textarea id="crPolicy" class="input" rows="3" placeholder="Bis 18:00 Uhr am Anreisetag kostenfrei stornierbar."></textarea>
      </label>
      <label>Preis/Nacht (â‚¬)
        <input id="crPrice" type="number" step="1" min="0" class="input" value="0">
      </label>
      <label>Gemappt
        <select id="crMapped" class="input theme-select">
          <option value="true">ja</option>
          <option value="false" selected>nein</option>
        </select>
      </label>
    </div>

    <div class="set-footer" style="gap:8px; justify-content:flex-end">
      <button class="btn primary" id="btnRateCreate">Rate erstellen</button>
    </div>
  </div>
</section>



  <!-- Backdrop -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true"></div>

  <!-- Neue Reservierung -->
  <section class="modal" id="modalNew" role="dialog" aria-labelledby="newTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="newTitle" class="mono"><span class="newres-logo"></span> Neue Reservierung</h3>
      <button class="btn" data-close>SchlieÃŸen</button>
    </header>
    <div class="body">
      <div class="wizard-steps">
        <div class="wstep active" data-step="1"><span>1</span><b>Hotel & Daten</b></div>
        <div class="wstep" data-step="2"><span>2</span><b>Kategorie</b></div>
        <div class="wstep" data-step="3"><span>3</span><b>Rate</b></div>
        <div class="wstep" data-step="4"><span>4</span><b>Gast & Zahlung</b></div>
      </div>

      <!-- STEP 1 -->
      <div class="wpage compact" id="w1">
        <div class="grid-compact-2" style="align-items:start">
          <div class="form-col">
            <h4 class="mono section" style="margin-top:0">Aufenthaltsdaten</h4>
            <div class="grid-compact">
              <label style="grid-column:1 / -1">Hotel
                <select id="newHotel" class="input theme-select" style="width:100%"></select>
              </label>
              <label>Anreise <input id="newArr" type="date" class="input"/></label>
              <label>Abreise <input id="newDep" type="date" class="input"/></label>
              <label>Erwachsene <input id="newAdults" type="number" min="1" value="1" class="input"/></label>
              <label>Kinder <input id="newChildren" type="number" min="0" value="0" class="input"/></label>
            </div>

            <h4 class="mono section">GÃ¤stedaten</h4>
            <div class="grid-compact">
              <label>Vorname <input id="newFname" class="input" placeholder="Max"/></label>
              <label>Nachname* <input id="newLname" class="input" placeholder="Mustermann" required/></label>
              <label>PLZ <input id="newZip" class="input" placeholder="80331"/></label>
              <label>StraÃŸe <input id="newStreet" class="input" placeholder="MusterstraÃŸe 1"/></label>
              <label style="grid-column:1 / -1">Ort <input id="newCity" class="input" placeholder="MÃ¼nchen"/></label>
            </div>
          </div>

          <div class="preview-col">
            <div class="imgcard hotel">
              <img id="hotelImg" src="/assets/hotel-placeholder.png" alt="Hotelbild"
                   style="width:100%;height:360px;object-fit:cover;border-radius:10px;display:block"
                   onerror="this.onerror=null;this.src='/assets/hotel-placeholder.png';"/>
            </div>

            <div class="box" style="margin-top:12px">
              <h4 class="mono section" style="margin:0 0 6px">Kontaktdaten</h4>
              <div class="grid-compact">
                <label style="grid-column:1 / -1">Telefon <input id="newPhone" class="input" placeholder="+49 â€¦"/></label>
                <label style="grid-column:1 / -1">E-Mail <input id="newEmail" class="input" placeholder="max@example.com"/></label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="wpage narrow" id="w2">
        <div class="s2-top">
          <div class="s2-left">
            <label class="s2-label">Kategorie
              <select id="newCat" class="input theme-select"></select>
            </label>

            <div class="box s2-facts">
              <div class="mono muted tiny" style="margin-bottom:4px">Fakten</div>
              <div class="tiny">
                Max Personen: 2<br/>
                Haustiere erlaubt: Nein<br/>
                Check In: 15:00<br/>
                Check Out: 11:00
              </div>
            </div>
          </div>

          <div class="box s2-desc">
            <div class="mono muted tiny" style="margin-bottom:4px">Beschreibung</div>
            <div id="catDesc" class="tiny">
              das Zimmer hat eine grÃ¶ÃŸe von mehr oder weniger als 40mÂ², Toaster, Mikrowelle und Balkon mit Ausblick.
              Dies ist ein Placeholder-Text und soll einen visuellen Effekt erzeugen. Die Beschreibung soll dem Agent
              alle Infos zu der Zimmerkategorie liefern, um mÃ¶glichst prÃ¤ziser arbeiten zu kÃ¶nnen.
            </div>
          </div>
        </div>

        <div class="s2-gallery">
          <div class="imgcard"><img id="imgCatPreview"  alt="Kategorie Bild 1" /></div>
          <div class="imgcard"><img id="imgCatPreview2" alt="Kategorie Bild 2" /></div>
          <div class="imgcard"><img id="imgCatPreview3" alt="Kategorie Bild 3" /></div>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="wpage narrow hidden" id="w3">
        <div class="row wrap" style="gap:12px;align-items:flex-start;">
          <label style="min-width:260px;flex:1">Rate
            <select id="newRate" class="input theme-select"></select>
          </label>
          <label style="width:160px">Preis
            <input id="newPrice" type="number" step="1" value="89" class="input"/>
          </label>
        </div>
        <div class="policy-box">
          <div class="muted">Stornobedingung</div>
          <p id="ratePolicyPreview">â€”</p>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="wpage hidden" id="w4">
        <aside class="summary box" id="summaryFinal"></aside>

        <h4 class="mono section">Gastdaten</h4>
        <details class="box">
          <summary class="mono">Firma (optional)</summary>
          <div class="grid2">
            <label>Firma <input id="newCompany" class="input" /></label>
            <label>USt-ID <input id="newVat" class="input" /></label>
            <label>PLZ <input id="newCompanyZip" class="input" /></label>
            <label>Adresse <input id="newAddress" class="input" placeholder="StraÃŸe + Ort" /></label>
          </div>
        </details>

        <h4 class="mono section">Kreditkarte</h4>
        <div class="cc-wrap">
          <div class="cc-visual">
            <div class="cc-chip"></div>
            <div class="cc-num"  id="ccNumLive">â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢</div>
            <div class="cc-holder" id="ccHolderLive">NAME</div>
            <div class="cc-exp"    id="ccExpLive">MM/YY</div>
          </div>
          <div class="cc-form">
            <div class="grid2">
              <label>Karteninhaber <input id="ccHolder" class="input" /></label>
              <label>Kartennummer <input id="ccNumber" class="input" placeholder="â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ 1234" /></label>
              <label>Ablauf (MM/JJ) <input id="ccExpiry" class="input" placeholder="12/27" /></label>
            </div>
          </div>
        </div>

        <label class="section mono">Notizen
          <textarea id="newNotes" class="input" rows="3" placeholder="Besonderheiten, WÃ¼nsche â€¦"></textarea>
        </label>
      </div>

      <div class="wizard-actions">
        <button class="btn ghost hidden" id="btnPrev">ZurÃ¼ck</button>
        <div style="flex:1"></div>
        <button class="btn" id="btnNext" disabled>Weiter</button>
        <button class="btn primary hidden" id="btnCreate">Reservierung abschicken</button>
      </div>

      <p class="muted" id="newInfo" style="margin-top:8px;"></p>
    </div>
  </section>

  <!-- Reservierung bearbeiten -->
  <section class="modal" id="modalEdit" role="dialog" aria-labelledby="editTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="editTitle" class="mono">Reservierung bearbeiten</h3>
      <button class="btn" data-close>SchlieÃŸen</button>
    </header>
    <div class="body">
      <div class="tabs">
        <button class="tab active" data-tab="tabDet">Details</button>
        <button class="tab" data-tab="tabPlan">Preisplan</button>
        <button class="tab" data-tab="tabPay">Zahlungskonto</button>
        <button class="tab" data-tab="tabAct">Aktionen</button>
      </div>

      <div class="tabpage" id="tabDet">
        <div class="grid2">
          <label>Res.-Nr. <input id="eResNo" class="input" disabled/></label>
          <label>Status
            <select id="eStatus" class="input theme-select">
              <option>active</option>
              <option>done</option>
              <option>canceled</option>
            </select>
          </label>
          <label>Hotel <input id="eHotel" class="input" disabled/></label>
          <label>Gast Nachname <input id="eLname" class="input"/></label>
          <label>Anreise <input id="eArr" type="date" class="input"/></label>
          <label>Abreise <input id="eDep" type="date" class="input"/></label>
          <label>Kategorie
  <select id="eCat" class="input theme-select"></select>
</label>
<label>Rate
  <select id="eRate" class="input theme-select"></select>
</label>
<!-- Gesamtpreis (read-only; Summe aus Preisplan) -->
<div class="row" style="gap:12px; align-items:flex-end;">
  <div style="flex:1 1 220px;">
    <label for="editTotalPrice" class="lbl">Gesamtpreis</label>
    <input id="editTotalPrice" class="input mono" type="number" step="0.01" readonly
           title="Summe der Nachtpreise aus dem Preisplan" />
  </div>
</div>

<!-- Notizen (klar erkennbar, rot-leuchtender Rahmen) -->
<div style="margin-top:12px;">
  <div class="lbl" style="display:flex; align-items:center; gap:8px;">
    <span>Notizen</span>
    <span class="tiny muted">(intern)</span>
  </div>
  <div style="
       border:1px solid #ff4d4d;
       border-radius:10px;
       box-shadow: 0 0 12px rgba(255,77,77,.25), inset 0 0 8px rgba(255,77,77,.12);
       padding:8px;">
    <textarea id="editNotes" class="input" rows="4" placeholder="Interne Notizen zur Reservierung"
              style="resize:vertical; border:none; background:transparent; box-shadow:none;"></textarea>
  </div>
</div>
        </div>
        <div class="right"><button class="btn" id="btnSaveEdit">Speichern</button></div>
      </div>

      <!-- +++ NEU: Preisplan-Tab +++ -->
<div id="tabPlan" class="tabpage hidden">
  <div class="section">
    <div class="row wrap" style="justify-content:space-between;align-items:center;">
      <h4 class="mono" style="margin:0">Preisplan (pro Nacht)</h4>
      <div class="row wrap" style="gap:8px;">
        <button id="btnPlanFillWeekdays" class="btn sm ghost" title="Wochentage-Muster anwenden">Wochentage-Muster</button>
        <button id="btnPlanAll" class="btn sm ghost" title="Alle NÃ¤chte auf einen Preis setzen">ðŸ’°All Price</button>
        <button id="btnPlanReset" class="btn sm ghost" title="Alle NÃ¤chte wieder auf Basispreis setzen">ZurÃ¼cksetzen</button>
        <button id="btnSavePlan" class="btn sm primary">Preisplan speichern</button>
       <!-- Footer-Aktionen unten rechts im Tab -->
<div id="planFooter" style="position:sticky; bottom:0; padding-top:8px;">
  <div style="display:flex; justify-content:flex-end; gap:8px;">
    <button id="btnApplyTrim" class="btn sm danger hidden">Anpassung speichern</button>
  </div>
</div>
        <!-- Mini-Popup: All Price -->
<div id="planAllPopup" class="card hidden" style="
     position:absolute; right:12px; top:56px; z-index:200;
     width: 260px; padding:12px; border:1px solid var(--line,#17414b);">
  <div class="mono" style="margin-bottom:8px;">Alle NÃ¤chte auf Preis setzen</div>
  <div class="row" style="gap:8px; align-items:center;">
    <input id="planAllValue" class="input mono" type="number" step="0.01" min="0" placeholder="z. B. 109.00" style="flex:1;">
    <span class="mono">â‚¬</span>
  </div>
  <div class="row" style="justify-content:flex-end; gap:8px; margin-top:10px;">
    <button id="planAllCancel" class="btn sm">Abbrechen</button>
    <button id="planAllApply" class="btn sm primary">Preise setzen</button>
  </div>
</div>


      </div>
    </div>
    <div id="planList" class="grid2" style="margin-top:10px;"></div>
    <div id="planInfo" class="muted" style="margin-top:8px"></div>
  </div>
</div>


      <div class="tabpage hidden" id="tabPay">
        <div class="grid2">
          <label>Karteninhaber <input id="eCcHolder" class="input"/></label>
          <label>Last4 <input id="eCcLast4" class="input"/></label>
          <label>Exp. Monat <input id="eCcExpM" type="number" min="1" max="12" class="input"/></label>
          <label>Exp. Jahr <input id="eCcExpY" type="number" min="24" max="40" class="input"/></label>
        </div>
        <div class="right"><button class="btn" id="btnSavePay">Speichern</button></div>
      </div>

      <div class="tabpage hidden" id="tabAct">
        <div class="box">
          <p class="muted">Reservierung stornieren? Status wird auf <b>canceled</b> gesetzt.</p>
          <button class="btn danger" id="btnCancelRes">Stornieren</button>
          <button id="btnResendConfirmation" class="btn btn--primary">BestÃ¤tigung erneut senden</button>
        </div>
      </div>

      <p class="muted" id="editInfo" style="margin-top:8px;"></p>
    </div>
  </section>

  <!-- VerfÃ¼gbarkeit -->
  <section class="modal" id="modalAvail" role="dialog" aria-labelledby="availTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="availTitle" class="mono"><span class="rep-logo"></span> VerfÃ¼gbarkeit</h3>
      <button class="btn" data-close>SchlieÃŸen</button>
    </header>
    <div class="body">
      <div class="row wrap" style="margin-bottom:8px;">
        <label>Von <input id="availFrom" type="date" class="input" style="width:170px;"></label>
        <label>Tage
          <select id="availDays" class="input theme-select" style="width:120px;">
            <option value="7">7</option>
            <option value="14" selected>14</option>
            <option value="30">30</option>
            <option value="60">60</option>
          </select>
        </label>
        <button class="btn" id="availRun">Aktualisieren</button>
        <div class="muted" style="margin-left:auto;">Legende:
          <span class="pill occ-g">â‰¤64%</span>
          <span class="pill occ-o">65â€“89%</span>
          <span class="pill occ-r">â‰¥90%</span>
        </div>
      </div>
      <div class="matrix compact">
        <table class="matrix" id="matrixTable">
          <thead><tr><th class="sticky">Hotel</th></tr></thead>
          <tbody id="matrixBody"></tbody>
        </table>
      </div>
    </div>
  </section>

   <!-- Reporting -->
<section class="modal" id="modalReporting" role="dialog" aria-labelledby="repTitle" aria-modal="true">
 <header>
  <h3 id="repTitle" class="mono">
    <span class="rep-logo"></span> Reporting
  </h3>
  <button class="btn" data-close>SchlieÃŸen</button>
</header>
  <div class="body">
    <div class="row wrap">
      <label>Von <input id="repFrom" type="date" class="input"></label>
      <label>Bis <input id="repTo" type="date" class="input"></label>
      <label>Hotel
        <select id="repHotel" class="input theme-select" style="width:200px;"></select>
      </label>
      <button class="btn" id="repRun">Aktualisieren</button>

      <!-- kompakte Export-Spalte rechts -->
      <div class="rep-tools">
        <button class="btn ghost" id="repXls">Export Excel</button>
        <button class="btn ghost" id="repCsv">Export CSV</button>
        <button class="btn ghost" id="repPdf">Export PDF</button>
      </div>
    </div>

    <!-- kompakte, gleich hohe Charts -->
    <div class="rep-charts">
      <div class="chart-card">
        <h4 class="mono">Umsatz pro Hotel</h4>
        <div class="chart-box"><canvas id="chartRevenue"></canvas></div>
      </div>
      <div class="chart-card">
        <h4 class="mono">Buchungen pro Hotel</h4>
        <div class="chart-box"><canvas id="chartBookings"></canvas></div>
      </div>
    </div>

    <div class="table-wrap">
      <table class="resv">
        <thead>
          <tr>
            <th>Hotel</th>
            <th>Buchungen</th>
            <th>Umsatz</th>
            <th>ADR</th>
            <th>Belegungsrate</th>
          </tr>
        </thead>
        <tbody id="repBody"></tbody>
      </table>
    </div>
  </div>
</section>

  <!-- Einstellungen -->
  <section class="modal" id="modalSettings" role="dialog" aria-labelledby="setTitle" aria-modal="true">
    <header>
      <h3 id="setTitle" class="mono">
        <span class="set-logo" aria-hidden="true"></span> Einstellungen
      </h3>
      <button class="btn" data-close>SchlieÃŸen</button>
    </header>
    <div class="body">
      <!-- oben: links Form / rechts Live-Systeminfo -->
     <div class="set-top">
  <!-- LINKER BLOCK: Sprache/Farbton + Buttons -->
<div class="set-left">
    <div class="set-grid">
      <label class="set-field">
        <span class="set-label">Sprache</span>
        <select id="selLang" class="input theme-select">
          <option value="de">Deutsch</option>
          <option value="en">English</option>
        </select>
      </label>

      <label class="set-field">
        <span class="set-label">Farbton (Hue) <span id="hueVal" class="muted">180Â°</span></span>
        <input id="rngHue" class="hue" type="range" min="0" max="359" step="1" />
      </label>
    </div>

    <!-- Buttons direkt darunter, klein -->
    <div class="set-tiles">
      <button class="btn tile" id="btnUserPrefs">Benutzereinstellungen</button>
      <button class="btn tile" id="btnChannel">Channel â€“ Einstellungen</button>
      <button class="btn tile" id="btnLog">Log Activity</button>
      <button class="btn tile" id="btnCats">Kategorieverwaltung</button>
      <button class="btn tile" id="btnRates" data-modal="#modalRates">Rateneinstellungen</button>
      <button class="btn tile" id="btnHelp">Hilfe & FAQ</button>
    </div>
  </div>

  <!-- RECHTER BLOCK: Live-Systeminfo (kleiner, transparenter) -->
  <aside class="box set-sys" id="netBox">
    <h4 class="mono section" style="margin:0 0 6px">Liveâ€‘Systeminfo</h4>
    <div class="sys-grid">
      <div class="settings-row"><label>Ã–ffentliche IP</label><span id="netIp">â€”</span></div>
      <div class="settings-row"><label>IPv4</label><span id="netIpv4">â€”</span></div>
      <div class="settings-row"><label>Standort</label><span id="netLoc">â€”</span></div>
      <div class="settings-row"><label>OS / Browser</label><span id="netOs">â€”</span></div>
    </div>
    <p class="muted tiny">Live Daten.</p>
  </aside>
</div>

      <!-- unten rechts: Speichern -->
      <div class="set-footer right">
  <button class="btn primary" id="btnSaveSettings" data-i18n="settings.save">
    Einstellungen speichern
  </button>
</div>

      <p class="muted" id="setInfo"></p>
    </div>
  </section>

<!-- Modal: Channel Settings (admin) â€“ NEU -->
<section class="modal" id="modalChannel" role="dialog" aria-labelledby="channelTitle" aria-modal="true">
  <header>
    <h3 id="channelTitle" class="mono">
      <span class="set-logo" aria-hidden="true"></span> Channel â€“ Einstellungen
    </h3>
    <button class="btn" data-close>SchlieÃŸen</button>
  </header>

  <div class="body" style="min-width:920px; max-width:96vw;">
    <div class="channel-wrap" style="display:flex; gap:12px; align-items:stretch;">
      <!-- Linke Tabs -->
      <aside class="box" style="width:260px; padding:10px;">
        <div class="mono muted tiny" style="margin-bottom:6px">Bereiche</div>
        <div class="channel-tabs" id="channelTabs" style="display:flex; flex-direction:column; gap:6px;">
          <button class="btn tile channel-tab active" data-channel-tab="api">Api â€“ Einstellungen</button>
          <button class="btn tile channel-tab" data-channel-tab="property">Property â€“ Mapping</button>
          <button class="btn tile channel-tab" data-channel-tab="monitor">Monitoring</button>
          <button class="btn tile channel-tab" data-channel-tab="system">System â€“ Technik</button>
          <button class="btn tile channel-tab" data-channel-tab="admin">Admin</button>
        </div>
      </aside>

      <!-- Rechte ContentflÃ¤che -->
      <section class="card" style="flex:1;">
        <div class="content" id="channelContent" style="min-height:480px;">
          <!-- Page: API -->
          <div class="channel-page" id="chPage_api">
            <div class="card-head"><h3 class="mono" style="margin:0">API â€“ Einstellungen</h3></div>
            <div class="grid2">
              <label>API-Key (versteckt)
                <input id="chApiKey" type="password" class="input" autocomplete="off" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
              </label>
              <label>API-Secret (versteckt)
                <input id="chApiSecret" type="password" class="input" autocomplete="off" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
              </label>
              <label>HNS Endpoint â€“ PROD
                <input id="chHnsProd" class="input" placeholder="https://api.hns.example/v1" />
              </label>
              <label>HNS Endpoint â€“ TEST
                <input id="chHnsTest" class="input" placeholder="https://sandbox.hns.example/v1" />
              </label>
              <label>Timeout (ms)
                <input id="chTimeout" type="number" class="input" value="15000" min="1000" step="500" />
              </label>
              <label>Retry-Versuche
                <input id="chRetry" type="number" class="input" value="2" min="0" max="5" />
              </label>
              <label style="grid-column:1 / -1">Hotel-Mapping (JSON: unsere <code>hotel_code</code> â†’ HNS-Code)
                <textarea id="chHotelMap" class="input" rows="4" placeholder='{"MA7-STR":"HNS_123","TAL-SON":"HNS_987"}'></textarea>
              </label>
            </div>
          </div>

          <!-- Page: Property -->
          <div class="channel-page hidden" id="chPage_property">
            <div class="card-head"><h3 class="mono" style="margin:0">Property â€“ Mapping</h3></div>
            <div class="box">
              <div class="mono muted tiny" style="margin-bottom:6px">Hotels aktiv</div>
              <div id="chHotelActiveList" class="grid-compact" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:8px;"></div>
            </div>
            <div class="grid2" style="margin-top:8px">
              <label style="grid-column:1 / -1">Kategorien-Mapping (JSON: unsere Kategorie â†’ HNS)
                <textarea id="chCatMap" class="input" rows="3" placeholder='{"Standard":"STD","Superior":"SUP","Suite":"STE"}'></textarea>
              </label>
              <label style="grid-column:1 / -1">Raten-Mapping (JSON: unser Ratecode â†’ HNS-Ratecode)
                <textarea id="chRateMap" class="input" rows="3" placeholder='{"1001":"BAR","1002":"BAR_BB"}'></textarea>
              </label>
            </div>
          </div>

         <!-- Page: Monitoring -->
<div class="channel-page hidden" id="chPage_monitor">
  <div class="card-head"><h3 class="mono" style="margin:0">Monitoring</h3></div>
  <div class="row" style="gap:8px; align-items:center;">
    <span class="mono muted tiny">Status:</span>
    <span class="pill" id="chChipHns">HNS</span>
    <span class="pill" id="chChipSb">SB</span>
  </div>
  <div class="grid2" style="margin-top:10px">
    <div>
      <h4 class="mono section">Error-Log (letzte 10)</h4>
      <ul id="chErrorList" class="tiny" style="margin:6px 0 0 16px; line-height:1.4"></ul>
    </div>
    <div>
      <h4 class="mono section">Mapping-Ãœbersicht</h4>
      <div id="chMappingSummary" class="tiny" style="margin-bottom:8px;">â€”</div>

      <!-- Ampel -->
      <div class="box" id="chMapAmpel" style="display:grid; gap:8px;">
        <!-- wird per JS befÃ¼llt -->
      </div>
    </div>
  </div>
</div>

          <!-- Page: System -->
          <div class="channel-page hidden" id="chPage_system">
            <div class="card-head"><h3 class="mono" style="margin:0">System â€“ Technik</h3></div>
            <div class="grid2">
              <label>Modus
                <select id="chMode" class="input theme-select">
                  <option value="sandbox">Sandbox</option>
                  <option value="live">Live</option>
                </select>
              </label>
              <div class="row" style="align-items:end; gap:8px;">
                <button class="btn" id="chExport">Export Settings (JSON)</button>
                <label class="btn ghost" for="chImportFile">Import JSON</label>
                <input id="chImportFile" type="file" accept="application/json" style="display:none;">
              </div>
              <div style="grid-column:1 / -1" class="box">
                <div class="mono muted tiny" style="margin-bottom:6px">Hotel hinzufÃ¼gen (on-the-fly)</div>
                <div class="grid-compact">
                  <label>Code <input id="chNewHotelCode" class="input" placeholder="VV-HH"></label>
                  <label>Name <input id="chNewHotelName" class="input" placeholder="Villa Viva Hamburg"></label>
                  <label>Gruppe <input id="chNewHotelGroup" class="input" placeholder="Villa Viva"></label>
                  <label>Bild-URL <input id="chNewHotelImg" class="input" placeholder="/assets/hotel-placeholder.png"></label>
                  <button class="btn" id="chAddHotel">Hotel hinzufÃ¼gen</button>
                </div>
              </div>
              <label style="grid-column:1 / -1">Stornierungsbedingungen (Default, Markdown/Plain)
                <textarea id="chCancelPolicy" class="input" rows="3" placeholder="Bis 18:00 Uhr am Anreisetag kostenfrei stornierbar."></textarea>
              </label>
            </div>
          </div>

         <!-- Page: Admin -->
<div class="channel-page hidden" id="chPage_admin">
  <div class="card-head"><h3 class="mono" style="margin:0">Admin</h3></div>
  <div class="grid2">
    <div class="box">
      <div class="settings-row"><label>Passwortschutz</label><span class="muted tiny">ist aktiv (Prompt)</span></div>
      <div class="settings-row"><label>Letzter Sync</label><span id="chLastSync">â€”</span></div>
    </div>
    <div class="box">
      <p class="tiny muted">
        â€žJetzt synchronisierenâ€œ fÃ¼hrt einen Health-Check aus, zieht Availability von HNS (fÃ¼r aktive Hotels)
        und schreibt alles ins Log. Danach werden KPIs & Matrix aktualisiert.
      </p>
      <button class="btn primary" id="btnSyncNow">Jetzt synchronisieren</button>
    </div>
  </div>
</div>

        <!-- Footer -->
        <div class="set-footer right">
          <button class="btn primary" id="btnSaveChannel">Einstellungen speichern</button>
        </div>
      </section>
    </div>
    <p class="muted tiny" id="channelInfo" style="margin-top:6px;"></p>
  </div>
</section>


<!-- Modal: Log Activity (admin) -->
<section class="modal" id="modalLog" role="dialog" aria-labelledby="logTitle" aria-modal="true">
  <header>
    <h3 id="logTitle" class="mono">
      <span class="set-logo" aria-hidden="true"></span> Log Activity
    </h3>
    <button class="btn" data-close>SchlieÃŸen</button>
  </header>
  <div class="body">
    <div class="row wrap" style="margin-bottom:8px;">
      <input id="logSearch" class="input" placeholder="Sucheâ€¦ (Text/Meta)" style="width:220px;">
      <select id="logType" class="input theme-select" style="width:180px;">
        <option value="">Typ: Alle</option>
        <option value="settings">settings</option>
        <option value="reservation">reservation</option>
        <option value="channel">channel</option>
        <option value="system">system</option>
      </select>
      <label>Von <input id="logFrom" type="date" class="input" style="width:160px;"></label>
      <label>Bis <input id="logTo" type="date" class="input" style="width:160px;"></label>
      <button class="btn" id="logApply">Filter anwenden</button>
      <button class="btn ghost" id="logClear">ZurÃ¼cksetzen</button>
    </div>
    <div class="table-wrap">
      <table class="table" id="logTable">
  <thead>
    <tr>
      <th>Datum/Zeit</th>
      <th>Benutzer</th> <!-- NEU -->
      <th>Typ</th>
      <th>Aktion</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
      <div id="logPager" class="toolbar" style="justify-content:flex-end;gap:8px">
  <button id="logPrev" class="btn sm ghost">ZurÃ¼ck</button>
  <span id="logPageInfo" class="muted">Seite 1 / 1 Â· 0 EintrÃ¤ge</span>
  <button id="logNext" class="btn sm">Weiter</button>
</div>

    </div>
  </div>
</section>

<!-- Kategorieverwaltung -->
<section class="modal" id="modalCats" role="dialog" aria-labelledby="catsTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="catsTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Kategorieverwaltung</h3>
    <button class="btn" data-close>SchlieÃŸen</button>
  </header>

  <div class="body">
    <div class="cats-wrap">
      <!-- Linke Spalte: Filter + Anlage -->
      <aside class="cats-side">
        <label class="set-field">
          <span class="set-label">Hotel</span>
          <select id="catsHotel" class="input theme-select"></select>
        </label>

        <label class="set-field">
          <span class="set-label">Suche</span>
          <input id="catsSearch" class="input sm" placeholder="Suche: Code/Name">
        </label>

        <hr class="rates-sep"/>

        <div class="box">
          <h4 class="mono" style="margin:0 0 6px;">Neue Kategorie</h4>
          <div class="grid2">
            <label>Code
              <input id="catCodeNew" class="input sm" placeholder="z. B. STD" maxlength="12">
            </label>
            <label>Max. Pers.
              <input id="catMaxNew" type="number" min="1" max="12" class="input sm" value="2">
            </label>
          </div>
          <label style="margin-top:6px">Name
            <input id="catNameNew" class="input sm" placeholder="z. B. Standard">
          </label>
          <p class="muted tiny" style="margin:6px 0 0;">
            Code: nur GroÃŸbuchstaben/Zahlen, fix nach Anlage. Hotel & Code sind spÃ¤ter nicht Ã¤nderbar.
          </p>
          <div class="right" style="margin-top:8px">
            <button class="btn sm" id="btnCatCreate">HinzufÃ¼gen</button>
          </div>
          <p class="muted tiny" id="catsInfo" style="margin-top:6px"></p>
        </div>
      </aside>

      <!-- Rechte Spalte: Tabelle -->
      <section class="cats-main card">
        <div class="content">
          <div class="card-head">
            <h3 class="mono" id="catsTitleHotel">Kategorien</h3>
            <div class="muted tiny" id="catsCount"></div>
          </div>

          <div class="table-wrap">
            <table class="resv" id="catsTable">
              <thead>
                <tr>
                  <th style="width:120px">Code</th>
                  <th>Name</th>
                  <th style="width:140px">Max. Pers.</th>
                  <th style="width:160px">Aktionen</th>
                </tr>
              </thead>
              <tbody id="catsTbody"></tbody>
            </table>
          </div>

          <div class="pagination">
            <button class="btn" id="catsPrev">ZurÃ¼ck</button>
            <span class="muted" id="catsPageInfo">Seite 1</span>
            <button class="btn" id="catsNext">Weiter</button>
          </div>

          <p class="muted tiny" style="margin-top:6px">Max. 50 EintrÃ¤ge pro Seite.</p>
        </div>
      </section>
    </div>
  </div>
</section>


  <!-- Benutzereinstellungen -->
  <section class="modal" id="modalUserPrefs" role="dialog" aria-labelledby="userPrefsTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="userPrefsTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Benutzereinstellungen</h3>
      <button class="btn" data-close>SchlieÃŸen</button>
    </header>
    <div class="body">
      <div class="box">
        <p class="muted">Platzhalter fÃ¼r persÃ¶nliche Einstellungen (z. B. Standardhotel, Standardzeitraum, Shortcuts â€¦).</p>
      </div>
    </div>
  </section>


<!-- Rateneinstellungen (nur Verwaltung/Liste â€“ ohne "Neue Rate") -->
<section class="modal" id="modalRates" role="dialog" aria-labelledby="ratesTitle" aria-modal="true">
  <header>
    <h3 id="ratesTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Rateneinstellungen</h3>
    <button class="btn" data-close>SchlieÃŸen</button>
  </header>
<div class="body">
  <div class="rates-wrap">
    <!-- Linke Listener-Leiste -->
   <aside class="rates-side">
  <button class="btn primary sm" id="rsNewRate">+ Neue Rate</button>
  <input id="rsSearch" class="input sm" placeholder="Suchen: Name oder Ratecode">
  <select id="rsHotelFilter" class="input sm theme-select" title="Hotel filtern"></select>
  <hr class="rates-sep"/>
  <button class="btn tile active" id="rsTabDirect" data-rates-tab="direct">Direct-Rate</button>
  <button class="btn tile" id="rsTabCorp"   data-rates-tab="corp">Corp-Rate</button>
  <button class="btn tile" id="rsTabIds"    data-rates-tab="ids">IDS-Rate</button>
</aside>

    <!-- Rechte HauptflÃ¤che -->
    <section class="rates-main card">
      <div class="content">
        <div class="card-head">
          <h3 class="mono" id="rsTitle">Raten â€“ Direct</h3>
         <div class="rs-toolbar"></div>
        </div>

        <div class="table-wrap" id="ratesBoard" data-max-rows="50">
          <table class="resv">
            <thead>
              <tr>
                <th style="width:110px">Ratecode</th>
                <th>Name</th>
                <th>Hotel</th>
                <th style="width:180px">Kategorien</th>
                <th style="width:110px">Preis</th>
                <th style="width:90px">Mapped</th>
              </tr>
            </thead>
            <tbody id="rsBody"></tbody>
          </table>
          <p class="muted tiny" style="margin-top:6px">Max. 50 EintrÃ¤ge werden angezeigt.</p>
        </div>
      </div>

      <div class="set-footer">
        <div style="flex:1"></div>
        <!-- (frei fÃ¼r spÃ¤tere Aktionen) -->
      </div>
    </section>
  </div>
</div>
</section>

  <!-- Hilfe & FAQ -->
  <section class="modal" id="modalHelp" role="dialog" aria-labelledby="helpTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="helpTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Hilfe & FAQ</h3>
      <button class="btn" data-close>SchlieÃŸen</button>
    </header>
    <div class="body">
      <div class="box">
        <h4 class="mono" style="margin:0 0 6px;">Schnelle Antworten</h4>
        <details class="box"><summary class="mono">Wie lege ich eine neue Reservierung an?</summary>
          <p class="tiny">Oben â€žNeue Reservierungâ€œ â†’ Schritt 1â€“4 durchklicken, dann â€žReservierung abschickenâ€œ.</p>
        </details>
        <details class="box"><summary class="mono">Woher kommen VerfÃ¼gbarkeiten?</summary>
          <p class="tiny">Aus der Tabelle <code>availability</code> (Supabase). HNS-Anbindung folgt.</p>
        </details>
        <details class="box"><summary class="mono">Werden Systeminfos gespeichert?</summary>
          <p class="tiny">Nein. IP/Standort/OS werden nur lokal angezeigt.</p>
        </details>
      </div>
    </div>
  </section>

  <!-- Hotelskizze -->
  <section class="modal" id="modalSketch" role="dialog" aria-labelledby="sketchTitle" aria-modal="true" aria-hidden="true">
    <header>
      <h3 id="sketchTitle" class="mono"><span class="sketch-logo" aria-hidden="true"></span> Hotelskizze</h3>
      <button class="btn" data-close>SchlieÃŸen</button>
    </header>
    <div class="body">
      <div class="sketch-wrap">
        <aside class="sketch-left">
          <div class="mono muted tiny" style="margin-bottom:6px">Hotels</div>
          <div id="sketchList" class="sketch-list"></div>
        </aside>
        <section class="sketch-right">
          <div class="card">
            <div class="content">
              <div class="card-head">
                <h3 class="mono" id="sketchHotelLabel">Bitte Hotel wÃ¤hlen</h3>
                <span class="pill">Skizze</span>
              </div>
              <div class="imgcard wide">
                <img id="sketchImage" alt="Hotelskizze" />
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </section>

<!-- Modal: Kategoriebeschreibung -->
<section class="modal" id="modalCatDesc" role="dialog" aria-labelledby="catDescTitle" aria-modal="true" aria-hidden="true">
  <header>
    <h3 id="catDescTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Kategoriebeschreibung</h3>
    <button class="btn" data-close>SchlieÃŸen</button>
  </header>
  <div class="body">
    <label class="mono muted tiny" style="margin-bottom:6px;display:block">Beschreibungstext</label>
    <textarea id="catDescTextarea" class="input" rows="6" placeholder="Beschreibung zur Zimmerkategorie â€¦"></textarea>
    <div class="set-footer right" style="margin-top:10px;">
      <button class="btn primary" id="btnCatDescSave">Speichern</button>
    </div>
  </div>
</section>

  
  <!-- Libraries + App -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.5/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Build erwartet /src/app.js -->
  <script src="/src/app.js"></script>
  <script src="/src/i18n.js"></script>
  <script>
(function(){
  function bindLangSelect(){
    // akzeptiert diverse Selektoren â€“ falls #selLang fehlt
    const sel = document.querySelector('#selLang, [data-role="lang-select"], #language, #lang, select[name="language"]');
    if (!sel || sel.__i18nBound) return;
    sel.__i18nBound = true;

    // Initialwert aus LocalStorage widerspiegeln
    try {
      const cur = (localStorage.getItem('resTool.lang') || 'de');
      if (sel.value !== cur) sel.value = cur;
    } catch(e){}

    sel.addEventListener('change', e=>{
      const v = (e.target.value || '').toLowerCase().startsWith('en') ? 'en' : 'de';
      if (window.resToolI18n){
        window.resToolI18n.setLang(v);
        window.resToolI18n.apply(v);
      }
    });
  }

  function applyOnLoad(){
    // Beim Laden einmal anwenden
    try{
      const v = (localStorage.getItem('resTool.lang') || 'de');
      if (window.resToolI18n) {
        window.resToolI18n.setLang(v);
        window.resToolI18n.apply(v);
      }
    }catch(e){}
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ()=>{ bindLangSelect(); applyOnLoad(); });
  } else {
    bindLangSelect(); applyOnLoad();
  }
})();
</script>

  <script>try{window.resToolI18n && window.resToolI18n.apply(localStorage.getItem('resTool.lang')||'de');}catch(e){}</script>

  <!-- Confirmations-Popup -->
<div id="confirmEmailModal" class="modal hidden" aria-hidden="true">
  <div class="modal__backdrop" data-close="confirmEmailModal"></div>
  <div class="modal__panel">
    <div class="modal__header">
      <h3>ReservierungsbestÃ¤tigung versenden</h3>
      <button class="modal__close" data-close="confirmEmailModal" aria-label="SchlieÃŸen">Ã—</button>
    </div>

    <div class="modal__body">
      <label class="form__label">EmpfÃ¤nger-E-Mail</label>
      <input id="confirmEmailTo" type="email" class="form__input" placeholder="kunde@example.com" />

      <label class="form__label" style="margin-top:12px;">Nachricht (bearbeitbar)</label>
      <textarea id="confirmEmailBody" class="form__textarea" rows="8" placeholder="Ihre BuchungsbestÃ¤tigung â€¦"></textarea>
    </div>

    <div class="modal__footer">
      <div style="margin-right:auto; display:flex; gap:8px;"><button class="btn btn--ghost" id="btnCopyEmail" type="button" title="E-Mail kopieren">E-Mail kopieren</button><button class="btn btn--ghost" id="btnCopyConfirmation" type="button" title="Text kopieren">Text kopieren</button></div><button class="btn btn--ghost" data-close="confirmEmailModal">Abbrechen</button>
      <button id="btnSendConfirmationNow" class="btn btn--primary">ReservierungsbestÃ¤tigung versenden</button>
    </div>
  </div>
</div>


  <div id="appToast" class="toast hidden" role="status" aria-live="polite"></div>



</body>
</html>
