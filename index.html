<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>res-tool — Dashboard</title>

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Styles mit Cache-Buster -->
  <link rel="stylesheet" href="/src/styles.css?v=3" />
</head>
<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="res-tool brand">
      <div class="logo" aria-hidden="true"></div>
      <h1 class="mono"><span>res</span>-tool<span class="cursor">_</span></h1>
    </div>

    <nav class="toolbar" aria-label="Aktionen">
      <div class="toolbar-left">
        <button class="btn primary" id="btnNew">Neue Reservierung</button>
        <button class="btn ghost"   id="btnAvail">Verfügbarkeit</button>
        <button class="btn ghost"   id="btnReporting">Reporting</button>
        <button class="btn ghost"   id="btnSettings">Einstellungen</button>
        <button class="btn ghost"   id="btnSketch">Hotelskizze</button>
      </div>

      <div class="toolbar-right mono">
        <div id="statusChips">
          <span class="pill" id="chipSb"  title="Supabase">SB</span>
          <span class="pill" id="chipHns" title="HotelNetSolutions">HNS</span>
        </div>
        <div class="clock">
          <span id="clockLocal">--:--:--</span>
          <span class="sep">/</span>
          <span id="clockServer">srv --:--:--</span>
        </div>
      </div>
    </nav>
  </header>

  <main class="container" aria-live="polite">
    <!-- KPI Filter -->
    <section class="filterbar" aria-label="KPI Filter">
      <label class="mono" for="kpiFilter">KPI Ansicht:</label>
      <select id="kpiFilter" class="input sm"></select>
    </section>

    <!-- KPIs -->
    <section class="grid hero" aria-label="Dashboard Übersicht">
      <article class="card scanlines">
        <div class="content">
          <h3 class="mono">KPI — Heute</h3>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="tBookings">—</div><div class="label">Buchungen</div></div>
            <div class="kpi"><div class="value" id="tRevenue">— €</div><div class="label">Umsatz</div></div>
            <div class="kpi"><div class="value" id="tADR">— €</div><div class="label">ADR</div></div>
            <div class="kpi"><div class="value" id="tOcc">—%</div><div class="label">Ø Auslastung</div></div>
          </div>
        </div>
      </article>
      <article class="card scanlines">
        <div class="content">
          <h3 class="mono">KPI — Letzte 7 Tage</h3>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="wBookings">—</div><div class="label">Buchungen</div></div>
            <div class="kpi"><div class="value" id="wRevenue">— €</div><div class="label">Umsatz</div></div>
            <div class="kpi"><div class="value" id="wADR">— €</div><div class="label">ADR</div></div>
            <div class="kpi"><div class="value" id="wOcc">—%</div><div class="label">Ø Auslastung</div></div>
          </div>
        </div>
      </article>
    </section>

    <!-- Reservierungen -->
    <section style="margin-top:16px;" aria-label="Reservierungen">
      <article class="card scanlines">
        <div class="content">
          <div class="table-tools">
            <h3 class="mono" style="margin:0">Reservierungen</h3>
            <div class="search"><input id="searchInput" class="input" placeholder="Nach Gastname suchen…" autocomplete="off" /></div>
          </div>
          <div class="table-wrap">
            <table class="resv">
              <thead>
                <tr>
                  <th>Gastname</th><th>Anreise</th><th>Abreise</th><th>Hotel</th>
                  <th>Kategorie</th><th>Rate</th><th>Preis</th><th>Notizen</th>
                </tr>
              </thead>
              <tbody id="resvBody"></tbody>
            </table>
            <div class="pagination">
              <button class="btn" id="prevPage">Zurück</button>
              <span class="muted" id="pageInfo">Seite 1</span>
              <button class="btn" id="nextPage">Weiter</button>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <!-- Rechte, schwebende Tracker-Buttons (klein) -->
  <aside class="quick-links" aria-label="Tracker Shortcuts">
    <a class="btn sm" href="https://noteforms.com/forms/hotel-booking-tracker-c83eba" target="_blank" rel="noopener">Buchungs-Tracker</a>
    <a class="btn sm" href="https://noteforms.com/forms/hotel-call-tracking-form-hw2hqj" target="_blank" rel="noopener">Telefon-Tracker</a>
  </aside>

  <!-- Backdrop + Modals (fix & zentriert) -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true"></div>

  <section class="modal" id="modalNew" role="dialog" aria-labelledby="newTitle" aria-modal="true">
    <header>
      <h3 id="newTitle" class="mono">Neue Reservierung</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="grid2">
        <label>Hotel <select id="newHotel" class="input"></select></label>
        <label>Gäste <input id="newGuests" type="number" min="1" value="1" class="input"/></label>
        <label>Anreise <input id="newArr" type="date" class="input"/></label>
        <label>Abreise <input id="newDep" type="date" class="input"/></label>
        <label>Kategorie
          <select id="newCat" class="input"><option>Standard</option><option>Superior</option><option>Suite</option></select>
        </label>
        <label>Rate
          <select id="newRate" class="input">
            <option value="Flex exkl. Frühstück" data-price="89">Flex exkl. Frühstück</option>
            <option value="Flex inkl. Frühstück" data-price="109">Flex inkl. Frühstück</option>
          </select>
        </label>
        <label>Preis <input id="newPrice" type="number" step="1" value="89" class="input"/></label>
        <label>Gast Nachname <input id="newLname" type="text" placeholder="Mustermann" class="input"/></label>
      </div>
      <div class="right"><button class="btn" id="btnCreate">Anlegen</button></div>
      <p class="muted" id="newInfo" style="margin-top:6px;"></p>
    </div>
  </section>

  <section class="modal" id="modalAvail" role="dialog" aria-labelledby="availTitle" aria-modal="true">
    <header>
      <h3 id="availTitle" class="mono">Verfügbarkeit (14 Tage)</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="matrix">
        <table class="matrix" id="matrixTable"><thead><tr><th class="sticky">Hotel</th></tr></thead><tbody id="matrixBody"></tbody></table>
      </div>
      <p class="muted" style="margin-top:8px;">Legende: <span class="pill lvl-0">OK</span> <span class="pill lvl-1">+1</span> <span class="pill lvl-2">≥2</span></p>
    </div>
  </section>

  <section class="modal" id="modalReporting" role="dialog" aria-labelledby="repTitle" aria-modal="true">
    <header>
      <h3 id="repTitle" class="mono">Reporting</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="row wrap">
        <label>Von <input id="repFrom" type="date" class="input"></label>
        <label>Bis <input id="repTo" type="date" class="input"></label>
        <button class="btn" id="repRun">Aktualisieren</button>
      </div>
      <div class="table-wrap">
        <table class="resv">
          <thead><tr><th>Hotel</th><th>Buchungen</th><th>Umsatz</th><th>ADR</th></tr></thead>
          <tbody id="repBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="modal" id="modalSettings" role="dialog" aria-labelledby="setTitle" aria-modal="true">
    <header>
      <h3 id="setTitle" class="mono">Einstellungen</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="grid2">
        <label>Sprache
          <select id="setLang" class="input"><option value="de">Deutsch</option><option value="en">English</option></select>
        </label>
        <label>Farbton (Hue)
          <input id="setHue" type="range" min="160" max="200" value="180" />
        </label>
      </div>
      <p class="muted" style="margin-top:8px;">Einstellungen werden lokal gespeichert.</p>
    </div>
  </section>

  <section class="modal" id="modalSketch" role="dialog" aria-labelledby="sketchTitle" aria-modal="true">
    <header>
      <h3 id="sketchTitle" class="mono">Hotelskizze</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body"><div class="hotel-grid" id="sketchGrid"></div></div>
  </section>

  <!-- Supabase UMD + App JS (mit Cache-Buster) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.5/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script src="/src/app.js?v=3"></script>
</body>
</html>
