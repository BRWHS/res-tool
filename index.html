<!DOCTYPE html>
<html lang="de">
<head>
  <link rel="preload" as="image" href="/assets/hotel-placeholder.png">
  <link rel="preload" as="image" href="/assets/sketch-placeholder.png">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>res-tool — Dashboard</title>

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/src/styles.css" />
</head>
<body>
  <header class="topbar" role="banner">
    <div class="brand" aria-label="res-tool brand">
      <div class="logo" aria-hidden="true"></div>
      <h1 class="mono"><span>res</span>-tool<span class="cursor">_</span></h1>
    </div>

    <nav class="toolbar" aria-label="Aktionen">
      <div class="toolbar-left">
        <button class="btn primary" id="btnNew">Neue Reservierung</button>
        <button class="btn ghost"   id="btnAvail">Verfügbarkeit</button>
        <button class="btn ghost"   id="btnReporting">Reporting</button>
        <button class="btn ghost"   id="btnSettings">Einstellungen</button>
        <button class="btn ghost"   id="btnSketch">Hotelskizze</button>
      </div>

      <div class="toolbar-right mono">
        <div id="statusChips">
          <span class="pill" id="chipSb"  title="Supabase">SB</span>
          <span class="pill" id="chipHns" title="HotelNetSolutions">HNS</span>
        </div>
        <div class="clock">
          <span id="dateLocal">--.--.----</span>
          <span class="sep">·</span>
          <span id="clockLocal">--:--:--</span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Mini-Charts (YoY) -->
  <aside class="analytics-dock" aria-label="Mini-Charts">
    <div class="dock-head">
      <span class="mono">YoY - Daily</span>
      <button class="btn sm" id="dockToggle" title="Ein-/Ausblenden">–</button>
    </div>
    <div id="miniAnalyticsDock" class="dock-list"></div>
  </aside>

  <main class="container" aria-live="polite">
    <!-- KPIs -->
    <section class="grid hero" aria-label="Dashboard Übersicht">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">Performance - Heute</h3>
            <div class="select-wrap">
              <select id="kpiFilterToday" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="tBookings">—</div><div class="label">Buchungen (heute eingegangen)</div></div>
            <div class="kpi"><div class="value" id="tRevenue">— €</div><div class="label">Umsatz (heute)</div></div>
            <div class="kpi"><div class="value" id="tADR">— €</div><div class="label">ADR (heute)</div></div>
            <div class="kpi"><div class="value" id="tOcc">—%</div><div class="label">Auslastung (heute)</div></div>
          </div>
        </div>
      </article>

      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono">Performance - Nächste 7 Tage</h3>
            <div class="select-wrap">
              <select id="kpiFilterNext" class="input sm theme-select"></select>
            </div>
          </div>
          <div class="kpis big">
            <div class="kpi"><div class="value" id="nRevenue">— €</div><div class="label">Umsatz (Anreisen +1..+7)</div></div>
            <div class="kpi"><div class="value" id="nADR">— €</div><div class="label">WDR (+1..+7)</div></div>
            <div class="kpi"><div class="value" id="nOcc">—%</div><div class="label">Ø Auslastung (+1..+7)</div></div>
          </div>
        </div>
      </article>
    </section>

    <!-- Reservierungen -->
    <section style="margin-top:16px;" aria-label="Reservierungen">
      <article class="card scanlines">
        <div class="content">
          <div class="card-head">
            <h3 class="mono" style="margin:0">Reservierungen</h3>
            <span></span>
          </div>

          <div class="table-tools">
            <div class="row wrap">
              <input id="searchInput" class="input" placeholder="Gastname…" />
              <select id="filterHotel" class="input theme-select" style="width:220px;"></select>
              <select id="filterStatus" class="input theme-select" style="width:170px;">
                <option value="active">Status: Active (Zukunft)</option>
                <option value="done">Status: Done (Vergangenheit)</option>
                <option value="canceled">Status: Canceled</option>
                <option value="all">Status: Alle</option>
              </select>
              <input id="filterResNo" class="input" placeholder="Res.-Nr." style="width:150px;" />
              <input id="filterFrom" type="date" class="input" style="width:170px;" />
              <input id="filterTo"   type="date" class="input" style="width:170px;" />
              <button class="btn" id="btnRefresh">Refresh</button>
            </div>
          </div>

          <div class="table-wrap">
            <table class="resv" id="resTable">
              <thead>
                <tr>
                  <th>Res.-Nr.</th>
                  <th>Hotel</th>
                  <th>Gastname</th>
                  <th>Anreise</th>
                  <th>Abreise</th>
                  <th>Kategorie</th>
                  <th>Rate</th>
                  <th>Preis</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="resvBody"></tbody>
            </table>
            <div class="pagination">
              <button class="btn" id="prevPage">Zurück</button>
              <span class="muted" id="pageInfo">Seite 1</span>
              <button class="btn" id="nextPage">Weiter</button>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <!-- Quick links -->
  <aside class="quick-links" aria-label="Tracker Shortcuts">
    <a class="btn sm" href="https://noteforms.com/forms/hotel-booking-tracker-c83eba" target="_blank" rel="noopener">Buchungs-Tracker</a>
    <a class="btn sm" href="https://noteforms.com/forms/hotel-call-tracking-form-hw2hqj" target="_blank" rel="noopener">Telefon-Tracker</a>
    <a class="btn sm" href="https://www.notion.so/11a5a3d6427580fbbb4ac3a0dcd1e209?v=35809356ec4245718f85f4a470e066d6" target="_blank" rel="noopener">Handbuch</a>
  </aside>

  <!-- Backdrop + Modals -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true"></div>

  <!-- Neue Reservierung -->
  <!-- (unchanged) -->
  <!-- … ALLE anderen Modals oben bleiben unverändert … -->

  <!-- Reporting -->
  <!-- (unchanged) -->

  <!-- Einstellungen -->
  <section class="modal" id="modalSettings" role="dialog" aria-labelledby="setTitle" aria-modal="true">
    <header>
      <h3 id="setTitle" class="mono">
        <span class="set-logo" aria-hidden="true"></span> Einstellungen
      </h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <!-- oben: links Form / rechts Live-Systeminfo -->
      <div class="set-top">
        <div>
          <div class="set-grid">
            <label class="set-field">
              <span class="set-label">Sprache</span>
              <select id="selLang" class="input theme-select">
                <option value="de">Deutsch</option>
                <option value="en">English</option>
              </select>
            </label>

            <label class="set-field">
              <span class="set-label">Farbton (Hue) <span id="hueVal" class="muted">180°</span></span>
              <input id="rngHue" class="hue" type="range" min="0" max="359" step="1" />
            </label>
          </div>
        </div>

        <!-- Live-Systeminfo (nur Anzeige) -->
        <aside class="box set-sys" id="netBox">
          <h4 class="mono section" style="margin:0 0 6px">Live-Systeminfo (nur für dich)</h4>
          <div class="sys-grid">
            <div class="settings-row"><label>Öffentliche IP</label><span id="netIp">—</span></div>
            <div class="settings-row"><label>IPv4</label><span id="netIpv4">—</span></div>
            <div class="settings-row"><label>Standort</label><span id="netLoc">—</span></div>
            <div class="settings-row"><label>OS / Browser</label><span id="netOs">—</span></div>
          </div>
          <p class="muted tiny">Wird nur live angezeigt und nicht gespeichert.</p>
        </aside>
      </div>

      <!-- Mitte: 5 Kachel-Buttons -->
      <div class="set-tiles">
        <button class="btn tile" id="btnUserPrefs">Benutzereinstellungen</button>
        <button class="btn tile" id="btnChannel">Channel – Einstellungen</button>
        <button class="btn tile" id="btnLog">Log Activity</button>
        <button class="btn tile" id="btnRates">Rateneinstellungen</button>
        <button class="btn tile" id="btnHelp">Hilfe & FAQ</button>
      </div>

      <!-- unten rechts: Speichern -->
      <div class="set-footer">
        <button class="btn primary" id="btnSaveSettings" data-i18n="settings.save">Einstellungen speichern</button>
      </div>

      <p class="muted" id="setInfo"></p>
    </div>
  </section>

  <!-- Channel Settings -->
  <section class="modal" id="modalChannel" role="dialog" aria-labelledby="channelTitle" aria-modal="true">
    <header>
      <h3 id="channelTitle" class="mono">
        <span class="set-logo" aria-hidden="true"></span> Channel – Einstellungen
      </h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="box">
        <p class="muted">Platzhalter für die API-Verkabelung (HNS, PMS, Mapping, Secrets …).</p>
        <p class="muted">Dieses Fenster ist mit Admin-Passwort geschützt.</p>
      </div>
    </div>
  </section>

  <!-- Log Activity -->
  <section class="modal" id="modalLog" role="dialog" aria-labelledby="logTitle" aria-modal="true">
    <header>
      <h3 id="logTitle" class="mono">
        <span class="set-logo" aria-hidden="true"></span> Log Activity
      </h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="row wrap" style="margin-bottom:8px;">
        <input id="logSearch" class="input" placeholder="Suche… (Text/Meta)" style="width:220px;">
        <select id="logType" class="input theme-select" style="width:180px;">
          <option value="">Typ: Alle</option>
          <option value="settings">settings</option>
          <option value="reservation">reservation</option>
          <option value="channel">channel</option>
          <option value="system">system</option>
        </select>
        <label>Von <input id="logFrom" type="date" class="input" style="width:160px;"></label>
        <label>Bis <input id="logTo" type="date" class="input" style="width:160px;"></label>
        <button class="btn" id="logApply">Filter anwenden</button>
        <button class="btn ghost" id="logClear">Zurücksetzen</button>
      </div>
      <div class="table-wrap">
        <table class="table" id="logTable">
          <thead>
            <tr><th>Datum</th><th>Typ</th><th>Aktion</th><th>Details</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Benutzereinstellungen -->
  <section class="modal" id="modalUserPrefs" role="dialog" aria-labelledby="userPrefsTitle" aria-modal="true">
    <header>
      <h3 id="userPrefsTitle" class="mono">
        <span class="set-logo" aria-hidden="true"></span> Benutzereinstellungen
      </h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="box">
        <p class="muted">Platzhalter für persönliche Einstellungen (z. B. Standardhotel, Standardzeitraum, Shortcuts …).</p>
      </div>
    </div>
  </section>

  <!-- Rateneinstellungen -->
  <section class="modal" id="modalRates" role="dialog" aria-labelledby="ratesTitle" aria-modal="true">
    <header>
      <h3 id="ratesTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Rateneinstellungen</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="box">
        <p class="muted">Platzhalter für Raten-Policies, Inklusivleistungen, Default-Preise je Kategorie usw. (Mapping zu PMS/HNS folgt).</p>
        <div class="grid-compact">
          <label>Standardrate <input class="input" placeholder="z.B. Flex exkl. Frühstück"></label>
          <label>Frühstück-Aufpreis (€) <input class="input" type="number" step="1" placeholder="z.B. 15"></label>
          <label>Late-Cancel Policy <input class="input" placeholder="z.B. bis 18:00 Uhr Vortag kostenfrei"></label>
        </div>
      </div>
    </div>
  </section>

  <!-- Hilfe & FAQ -->
  <section class="modal" id="modalHelp" role="dialog" aria-labelledby="helpTitle" aria-modal="true">
    <header>
      <h3 id="helpTitle" class="mono"><span class="set-logo" aria-hidden="true"></span> Hilfe & FAQ</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div class="box">
        <h4 class="mono" style="margin:0 0 6px;">Schnelle Antworten</h4>
        <details class="box"><summary class="mono">Wie lege ich eine neue Reservierung an?</summary>
          <p class="tiny">Oben „Neue Reservierung“ → Schritt 1–4 durchklicken, dann „Reservierung abschicken“.</p>
        </details>
        <details class="box"><summary class="mono">Woher kommen Verfügbarkeiten?</summary>
          <p class="tiny">Aus der Tabelle <code>availability</code> (Supabase). HNS-Anbindung folgt.</p>
        </details>
        <details class="box"><summary class="mono">Werden Systeminfos gespeichert?</summary>
          <p class="tiny">Nein. IP/Standort/OS werden nur lokal angezeigt.</p>
        </details>
      </div>
    </div>
  </section>

  <!-- Hotelskizze -->
  <section class="modal" id="modalSketch" role="dialog" aria-labelledby="sketchTitle" aria-modal="true">
    <header>
      <h3 id="sketchTitle" class="mono">Hotelskizze</h3>
      <button class="btn" data-close>Schließen</button>
    </header>
    <div class="body">
      <div id="sketchStateList" class="row wrap"></div>
      <div id="sketchStateView" class="hidden">
        <div class="row wrap" style="margin-bottom:8px;">
          <button class="btn" id="sketchBack">← Zurück zur Auswahl</button>
          <div class="muted" id="sketchHotelLabel" style="margin-left:8px;"></div>
        </div>
        <div class="imgcard wide">
          <img id="sketchImage" alt="Hotelskizze" />
        </div>
      </div>
    </div>
  </section>

  <!-- Libs (einmalig, unten) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.5/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <script src="/src/app.js"></script>
</body>
</html>
